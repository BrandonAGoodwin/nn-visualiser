{"version":3,"sources":["contexts/ThemeContext.tsx","components/LossGraph.tsx","components/ComparePage.tsx","NeuralNet.ts","datasets.ts","visControl.ts","components/BackgroundCanvas.tsx","components/NNGraph.tsx","components/InfoButton.tsx","components/NNNode.tsx","components/Definitions.tsx","components/MouseTooltip.tsx","components/NeuralNetworkVis.tsx","components/InfoPanels/LossInfoPanel.tsx","components/ColourScale.tsx","NetworkController.ts","components/InfoPanels/DefaultInfoPanel.tsx","PositiveLink.png","NegativeLink.png","contexts/InfoPanelContext.tsx","DatasetGenerator.ts","components/SVGs/Sigmoid-function-2.svg","components/InfoPanels/NodeInfoPanel.tsx","components/InfoPanels/ActivationInfoPanel.tsx","components/InfoPanels/DatasetInfoPanel.tsx","components/InfoPanels/LearningRateInfoPanel.tsx","components/Slider.tsx","components/ConfigBar.tsx","components/ControlPanel.tsx","components/MainPage.tsx","components/UseEventListener.ts","App.tsx","index.tsx"],"names":["ThemeContext","createContext","background","minColour","minColourName","midColour","midColourName","maxColour","maxColourName","ThemeProvider","props","useState","Provider","value","children","LossGraph","d3Container","useRef","initialised","setInitialised","init","width","createGraph","useEffect","updateGraph","dataset","d3","currnet","attr","margin","height","svg","current","selectAll","remove","graph","append","x","range","domain","Math","max","length","comparisionData","minY","Number","MAX_VALUE","maxY","MIN_VALUE","forEach","d","y","min","call","datum","ref","ContainerSection","styled","ComparePage","id","currentState","lossData","savedState","Node","activationFunction","linksIn","linksOut","totalInput","bias","output","outputDerivative","inputDerivative","accInputDererivatives","numInputDerivatives","dw","db","this","i","weight","source","tanh","Infinity","e2x","exp","Activations","SIGMOID","derivative","RELU","TANH","Costs","SQUARE","cost","pow","Link","dest","startWeight","costDer","derAcc","noAccDers","random","forwardPropagate","network","inputs","numLayers","inputLayer","outputlayer","Error","layerNum","currentLayer","updateOutput","backPropagate","costFunction","outputNode","node","j","link","previousLayer","train","learningRate","averageWeightGradient","averageBiasGradient","forEachNode","f","ignoreInputs","getOutputNode","Dataset","normalDistribution","mean","variance","x1","x2","w","sqrt","log","shuffle","temporaryValue","randomIndex","currentIndex","floor","ACTIVATIONS","nn","INPUTS","GAUSSIAN_2","numSamples","noise","varianceScale","samples","generateGaussianData","cx1","cx2","push","GAUSSIAN_3","XOR","noiseScale","generateUniformData","x1Scale","x2Scale","label","sin","start","config","networkShape","outputActivationFunction","numlayers","inputIds","Object","keys","inputId","numNodes","isInputLayer","nodeId","toString","prevLayer","prevNode","console","constructInputs","constructedInputs","inputName","step","trainingData","batchSize","sample","getCost","data","totalCost","dataPoint","BackgroundCanvas","useContext","canvasRef","updateCanvas","decisionBoundary","discreetBoundary","Date","now","tmpScale","disabled","clamp","numShades","colors","map","a","color","canvas","context","getContext","imageData","createImageData","numCells","iter","c","r","g","b","putImageData","className","style","paddingLeft","padding","paddingRight","paddingTop","paddingBottom","NNGraph","scale","canvasWidth","marginLeft","marginRight","marginTop","marginBottom","addFormattedText","text","test","myArray","lastIndex","myRe","exec","prefix","sep","suffix","substring","tickValues","concat","ticks","xAxisText","yAxisText","filteredDataset","filter","p","enter","datapoint","colour","position","StyledIconButton","IconButton","HtmlTooltip","Tooltip","InfoButton","interactive","arrow","title","onClick","infoPanel","icon","Info","fontSize","NodeContainer","active","nodeWidth","NNNode","handleOnClick","onMouseOver","handleOnHover","StyledLink","DefinedTerm","definition","DefX1","Typography","variant","DefX2","HoverCardType","MouseTooltip","offsetX","offsetY","args","setPosition","mouseMoved","setMouseMoved","listenerActive","setListenerActive","addListener","removeListener","visible","getTooltipPosition","event","clientX","clientY","window","addEventListener","removeEventListener","display","top","left","HoverCard","PlusMinusButtonsContainer","GridContainer","Container","Layer","gridArea","LayerControls","FadeCanvas","NeuralNetworkVis","svgContainer","container","linksUpdated","setLinksUpdated","setNetwork","labelsDrawn","setLabelsDrawn","containerBox","setContainerBox","showHoverCard","setShowHoverCard","type","WEIGHT","hoverCardConfig","setHoverCardConfig","hoverTarget","setHoverTarget","updateContainerBox","document","getElementById","updateHovercard","targetId","target","indexOf","hideHoverCard","drawAllLinks","decisionBoundaries","nodeId2Node","BIAS","linkId2Link","node2Coord","getNodeCoords","drawLink","node2coord","nodeIds","nodeNotDrawnYet","cx","cy","drawLabels","delta","containerCurrent","offsetLeft","offsetTop","nodeElement","input","line","diagonal","linkConfig","weightToSize","size","generateLineConfig","on","transition","duration","ease","viewportOffset","getBoundingClientRect","nodeNum","linkId","splitId","split","fromNodeId","toNodeId","fromNode","overflow","pointerEvents","flexDirection","justifyContent","alignItems","StyledInfoButton","Fragment","removeLayer","addLayer","slice","layer","flexGrow","removeNode","addNode","toFixed","LossInfoPanel","ColourScale","d3ContainerRef","horizontal","createScale","colourScale","tickSize","imageWidth","imageHeight","select","defaultNetworkData","datasetType","defaultNetworkState","compareMode","useNetwork","defaultData","defaultState","nnConfig","setNNConfig","state","reset","generateNetwork","vis","setActivationFunction","prev","setLearningRate","setBatchSize","toggleInputNode","prevConfig","noActiveNodes","newNetworkShape","pop","prevNetwork","DefaultInfoPanel","src","alt","InfoPanelContext","InfoPanelProvider","defaultInfoPanelData","infoPanelData","setInfoPanelData","setInfoPanelWrapper","newInfoPanel","prevInfoPanelData","infoPanelHistory","infoPanelFuture","handleInfoPanelForward","shift","handleInfoPanelBackward","unshift","handleInfoPanelHome","GENERATORS","defaultDGConfig","useDatasetGenerator","defaultConfig","dgConfig","setDGConfig","setTrainingData","testData","setTestData","generateDataset","datasetGenerator","splitDataset","newTrainingData","newTestData","setDatasetType","setNoise","setNumSamples","testDataIndex","NodeInfoPanel","ActivationImg","ActivationInfoPanel","setInfoPanel","sigmoid","DatasetInfoPanel","href","LearningRateInfoPanel","float","tex","String","raw","StyledDiv","LabeledSlider","defaultValue","currentValue","setCurrentValue","gutterBottom","Slider","onChange","e","newValue","onChangeCommitted","StyledConfigBar","StyledFormControl","FormControl","StyledSelect","Select","ConfigBar","InputLabel","MenuItem","Divider","orientation","flexItem","appendValueToLabel","StyledControlPanel","StyledButton","Button","ControlPanel","training","handleStep","toggleAutoTrain","toggleDiscreetOutput","handleRegenerateDataset","handleReset","StyledLinkButton","LinksDiv","NetworkPanel","GraphPanel","StatsBar","InfoPanel","ColouredBox","MainPage","setDecisionBoundaries","setDecisionBoundary","loss","setLoss","epochs","setEpochs","setDiscreetBoundary","setLossData","setTraining","trainingInterval","setTrainingInterval","comparisonData","updateDecisionBoundary","updateDecisionBoundaries","density","xDomain","yDomain","boundaries","xScale","yScale","inputNodeIds","boundary","prevEpochs","clearInterval","setInterval","prevDiscreetBoundary","maxValue","minValue","midValue","networkWidth","networkHeight","right","ArrowBackIos","Home","ArrowForwardIos","GitHub","useEventListener","eventName","handler","element","useCapture","savedHandler","targetElement","capture","eventListener","StyledComparePage","StyledMargin","AuxContainer","TransitionButton","transitioning","App","mainContainer","createRef","pageState","setPageState","marginAdded","setMarginAdded","marginWidth","setMarginWidth","setTransitioning","setComparisonData","updateButtonPosition","setTimeout","updateContainerSize","maxMarginSize","mainPage","offsetWidth","newMarginWidth","minWidth","comparePage","button","containerRect","pageRect","styles","css","updateComparisionData","querySelectorAll","classList","toggle","ReactDOM","render","StrictMode","StylesProvider","injectFirst"],"mappings":"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","file":"static/js/main.5f94cc4f.chunk.js","sourcesContent":["import React, { useState, createContext } from \"react\";\r\n\r\nexport const ThemeContext = createContext({\r\n    background: \"linear-gradient(207deg, rgba(255,118,97,1) 0%, rgba(34,55,129,1) 100%)\",\r\n    minColour: \"#223781\",\r\n    minColourName: \"blue\",\r\n    midColour: \"#FFFFFF\",\r\n    midColourName: \"white\",\r\n    maxColour: \"#ff7661\",\r\n    maxColourName: \"orange\"\r\n});\r\n\r\ninterface ThemeProps {\r\n    children: React.ReactChild | React.ReactChild[];\r\n}\r\n\r\nexport const ThemeProvider = (props: ThemeProps) => {\r\n    const [theme, setTheme] = useState({\r\n        background: \"linear-gradient(207deg, rgba(255,118,97,1) 0%, rgba(34,55,129,1) 100%)\",\r\n        minColour: \"#223781\",\r\n        minColourName: \"blue\",\r\n        midColour: \"#FFFFFF\",\r\n        midColourName: \"white\",\r\n        maxColour: \"#ff7661\",\r\n        maxColourName: \"orange\"\r\n    })\r\n    \r\n    return(\r\n        <ThemeContext.Provider value={{\r\n            background: \"linear-gradient(207deg, rgba(255,118,97,1) 0%, rgba(34,55,129,1) 100%)\",\r\n            minColour: \"#223781\",\r\n            minColourName: \"blue\",\r\n            midColour: \"#FFFFFF\",\r\n            midColourName: \"white\",\r\n            maxColour: \"#ff7661\",\r\n            maxColourName: \"orange\"\r\n        }}>\r\n            {props.children}\r\n        </ThemeContext.Provider>\r\n    );\r\n}","import React, { useEffect, useState, useRef } from 'react';\r\nimport * as d3 from 'd3';\r\nimport { Datapoint2D } from '../datasets';\r\nimport BackgroundCanvas from './BackgroundCanvas';\r\n\r\nexport type LossData = {\r\n    epoch: number;\r\n    trainingLoss: number;\r\n}\r\n\r\ninterface GraphProps {\r\n    dataset: [number, number][];\r\n    comparisionData?: [number, number][];\r\n    width: number;\r\n    height: number;\r\n    margin: number;\r\n    // xDomain: number[];\r\n    // yDomain: number[];\r\n}\r\n\r\n\r\nfunction LossGraph(props: GraphProps) {\r\n\r\n    const d3Container: any = useRef<any>(null);\r\n    const [initialised, setInitialised] = useState<boolean>(false);\r\n\r\n    let scale = props.width / 16;\r\n\r\n\r\n    const init = () => {\r\n        // console.log(\"LossGraph init\")\r\n\r\n        createGraph();\r\n        setInitialised(true);\r\n    }\r\n\r\n    useEffect(() => {\r\n        init()\r\n    }, []);\r\n\r\n\r\n    useEffect(() => {\r\n        if (!initialised) {\r\n            init()\r\n        } else {\r\n            updateGraph()\r\n\r\n        }\r\n    }, [props.dataset]);\r\n\r\n\r\n    const createGraph = () => {\r\n        // console.log(\"Creating loss graph\")\r\n\r\n        let svg = d3.select(d3Container.currnet)\r\n\r\n        svg.attr('width', props.width + props.margin * 2)\r\n            .attr('height', props.height + props.margin * 2)\r\n\r\n    }\r\n\r\n    const updateGraph = () => {\r\n        // console.log(\"Updating loss graph\")\r\n        // console.log(props.dataset)\r\n        const svg = d3.select(d3Container.current)\r\n\r\n        svg.selectAll(`.loss-graph`).remove();\r\n\r\n        const graph = svg.append('g')\r\n            .attr(\"class\", `loss-graph`)\r\n            .attr('transform', `translate(${props.margin}, ${props.margin})`);\r\n\r\n        const x = d3.scaleLinear()\r\n            .range([0, props.width])\r\n            .domain([1, Math.max(props.dataset.length, props.comparisionData?.length || 0)]);\r\n\r\n        let minY = Number.MAX_VALUE;\r\n        let maxY = Number.MIN_VALUE;\r\n\r\n        props.dataset.forEach((d: [number, number]) => {\r\n            let y = d[1];\r\n            minY = Math.min(minY, y);\r\n            maxY = Math.max(maxY, y);\r\n        });\r\n\r\n        if (props.comparisionData) {\r\n            props.comparisionData.forEach((d: [number, number]) => {\r\n                let y = d[1];\r\n                minY = Math.min(minY, y);\r\n                maxY = Math.max(maxY, y);\r\n            });\r\n        }\r\n\r\n        const y = d3.scaleLinear()\r\n            .range([props.height, 0])\r\n            .domain([minY, maxY]);\r\n\r\n        graph.append('g')\r\n            .attr(\"class\", `axis`)\r\n            .attr('transform', `translate(0,${props.height})`)\r\n            .call(d3.axisBottom(x));\r\n\r\n        graph.append('g')\r\n            .attr(\"class\", `axis`)\r\n            .call(d3.axisLeft(y));\r\n\r\n\r\n        let index = 1;\r\n        graph.append(\"path\")\r\n            .datum(props.dataset)\r\n            .attr(\"fill\", \"none\")\r\n            .attr(\"stroke\", \"#606060\")\r\n            .attr(\"stroke-width\", 1.5)\r\n            .attr(\"d\", d3.line()\r\n                .x((d: [number, number]) => x(d[0]) || 0)\r\n                .y((d: [number, number]) => y(d[1]) || 0))\r\n\r\n        if (props.comparisionData) {\r\n            graph.append(\"path\")\r\n                .datum(props.comparisionData)\r\n                .attr(\"fill\", \"none\")\r\n                .attr(\"stroke\", \"red\")\r\n                .attr(\"stroke-width\", 1.5)\r\n                .attr(\"d\", d3.line()\r\n                    .x((d: [number, number]) => x(d[0]) || 0)\r\n                    .y((d: [number, number]) => y(d[1]) || 0))\r\n        }\r\n    }\r\n\r\n    return (\r\n        <svg\r\n            ref={d3Container}\r\n            width={props.width + props.margin * 2}\r\n            height={props.height + props.margin * 2}\r\n        //style={{ position: \"absolute\" }}\r\n        />\r\n    );\r\n}\r\n\r\nexport default LossGraph;","import styled from \"@emotion/styled\";\r\nimport React from \"react\";\r\nimport LossGraph from \"./LossGraph\";\r\nimport { NetworkState } from \"./MainPage\";\r\n\r\n\r\nconst ContainerSection = styled(\"div\")`\r\n    -webkit-box-sizing: border-box; /* Safari/Chrome, other WebKit */\r\n    -moz-box-sizing: border-box;    /* Firefox, other Gecko */\r\n    box-sizing: border-box; \r\n    background-color: white;\r\n    margin: 30px auto;\r\n    min-width: 800px;\r\n    width: auto;\r\n    max-width: 80vw;\r\n    height: 80vh;\r\n    padding: 30px;\r\n    border-radius: 30px;\r\n    border: 2px solid #bdbdbd;\r\n    display: flex;\r\n    flex-direction: row;\r\n    justify-content: center;\r\n`;\r\n\r\ninterface PageProps {\r\n    savedState?: NetworkState;\r\n    currentState?: NetworkState;\r\n}\r\n\r\nfunction ComparePage(props: PageProps) {\r\n\r\n    return(\r\n        <ContainerSection id=\"compare-page\">\r\n\r\n            {props.currentState && <LossGraph\r\n                height={60}\r\n                width={170}\r\n                margin={5}\r\n                dataset={props.currentState.lossData}\r\n                comparisionData={props.savedState?.lossData}/> }\r\n        </ContainerSection>\r\n    );\r\n}\r\n\r\nexport default ComparePage;","\r\n/** Represents a node in the neural network. */\r\nexport class Node {\r\n\r\n    // Standardise no and num usage\r\n\r\n    // Refactor to init variables in the constructor\r\n\r\n    id: string;\r\n    /** AKA phi(x) */\r\n    activationFunction: ActivationFunction;\r\n\r\n    linksIn: Link[] = [];\r\n    linksOut: Link[] = [];\r\n\r\n    /** AKA z = phi(a) */\r\n    totalInput: number = 0.0;\r\n\r\n    /** AKA b */\r\n    bias: number = 0.1;\r\n    /** AKA a */\r\n    output: number = 0.0;\r\n\r\n    /** AKA dc/da */\r\n    outputDerivative: number = 0.0;\r\n    /** AKA delta */\r\n    inputDerivative: number = 0.0;\r\n\r\n    /** Sum of input derivatives over multiple backpropagation iterations to be used for avarage\r\n     * when carring out gradient decent\r\n     */\r\n    accInputDererivatives: number = 0.0;\r\n    /** Number of derivatives accumulated, used to calculate average dc/db for gradient decent */\r\n    numInputDerivatives: number = 0.0;\r\n\r\n    /** AKA dc/dw = delta^l . a^l-1 */\r\n    dw: number = 0;\r\n    /** AKA dc/db =  delta^l */\r\n    db: number = 0;\r\n\r\n    constructor(id: string, activationFunction: ActivationFunction) {\r\n        this.id = id;\r\n        this.activationFunction = activationFunction;\r\n    }\r\n\r\n    // Figure out what happens for input layer (maybe make sure this doesn't get called)\r\n    updateOutput(): number {\r\n        //let prevOutput = this.output;\r\n        this.totalInput = this.bias;\r\n        for (let i = 0; i < this.linksIn.length; i++) {\r\n            this.totalInput += this.linksIn[i].weight * this.linksIn[i].source.output;\r\n        }\r\n\r\n        this.output = this.activationFunction.output(this.totalInput);\r\n        //(console.log(`Node ${this.id}: Updated output from ${prevOutput} to ${this.output} diff = ${this.output - prevOutput}`))\r\n        return this.output;\r\n    }\r\n}\r\n\r\nexport interface ActivationFunction {\r\n    output: (x: number) => number;\r\n    derivative: (input: number) => number;\r\n}\r\n\r\n/** Also known as an error or loss function. */\r\nexport interface CostFunction {\r\n    cost: (output: number, y: number) => number;\r\n    derivative: (output: number, y: number) => number;\r\n}\r\n\r\n/** Polyfill for TANH */\r\n(Math as any).tanh = (Math as any).tanh || function (x: number) {\r\n    if (x === Infinity) {\r\n        return 1;\r\n    } else if (x === -Infinity) {\r\n        return -1;\r\n    } else {\r\n        let e2x = Math.exp(2 * x);\r\n        return (e2x - 1) / (e2x + 1);\r\n    }\r\n};\r\n\r\n\r\n/** Built in activation functions */\r\nexport class Activations {\r\n    public static SIGMOID: ActivationFunction = {\r\n        output: (x: number) => 1.0 / (1.0 + Math.exp(-x)), // Check that this evaluates to higher than 1 d.p.\r\n        derivative: (x: number) => {\r\n            let output = Activations.SIGMOID.output(x);\r\n            return output * (1.0 - output)\r\n        }\r\n    };\r\n    public static RELU: ActivationFunction = {\r\n        output: (x: number) => Math.max(0, x),\r\n        derivative: (x: number) => x > 0 ? 1 : 0\r\n    };\r\n    // Might need to polyfill not TANH implementation for +/- inf values if Math.tah doesn't exist\r\n    public static TANH: ActivationFunction = {\r\n        // output: (x: number) => Math.tanh(x),\r\n        output: (x: number) => (Math as any).tanh(x),\r\n        derivative: (x: number) => {\r\n            let output = Activations.TANH.output(x);\r\n            return 1 - output * output;\r\n        }\r\n    }\r\n}\r\n\r\n/** Built in cost functions (Only using SQUARE for now) */\r\nexport class Costs {\r\n    public static SQUARE: CostFunction = {\r\n        cost: (output: number, y: number) => 0.5 * Math.pow(output - y, 2),\r\n        derivative: (output: number, y: number) => output - y\r\n    }\r\n}\r\n\r\n/** \r\n * Links Nodes together and carries the weight associated with the connected nodes\r\n * (for now weights are initialised to 0)\r\n */\r\nexport class Link {\r\n    /** Linked node in the previous layer. */\r\n    source: Node;\r\n    /** Linked node in the next layer. */\r\n    dest: Node;\r\n\r\n    /** Weight associated to this link.\r\n     *  AKA w\r\n     */\r\n    weight: number;\r\n    /** current cost derivative */\r\n    costDer: number;\r\n    /** Accumulated derivatives */\r\n    derAcc: number;\r\n    /** Number of accumulated derivatives */\r\n    noAccDers: number;\r\n\r\n    // Careful of copying a network while acc values aren't zero\r\n    constructor(source: Node, dest: Node, startWeight?: number) {\r\n        this.source = source;\r\n        this.dest = dest;\r\n        this.weight = startWeight ? startWeight : Math.random() - 0.5;\r\n        this.costDer = 0.0;\r\n        this.derAcc = 0.0;\r\n        this.noAccDers = 0.0;\r\n    }\r\n}\r\n\r\n/**\r\n * Builds a neural network. \r\n * (Currently without any differing output activation or regularization)\r\n * @param networkShape The shape of a network where each value in the list\r\n *      represents the number of neurons in the respective layer.\r\n * @param activationFunction The activation function for the ouput of each node.\r\n * @param inputIds List of ids for the input nodes.\r\n */\r\nexport function generateNetwork(\r\n    networkShape: number[],\r\n    activationFunction: ActivationFunction,\r\n    outputActivationFunction: ActivationFunction,\r\n    inputs: { [id: string]: boolean },\r\n): Node[][] {\r\n    let numlayers = networkShape.length;\r\n    let network: Node[][] = [];\r\n\r\n    let inputIds: string[] = [];\r\n    Object.keys(inputs).forEach((inputId) => {\r\n        if (inputs[inputId]) inputIds.push(inputId);\r\n    });\r\n\r\n    let id = 1;\r\n    // console.log(inputIds)\r\n    for (let layerNum = 0; layerNum < numlayers; layerNum++) {\r\n        let currentLayer: Node[] = [];\r\n\r\n        network.push(currentLayer);\r\n\r\n        let numNodes = networkShape[layerNum];\r\n        let isInputLayer = layerNum === 0;\r\n\r\n        for (let i = 0; i < numNodes; i++) {\r\n            let nodeId = isInputLayer ? inputIds[i] : (id++).toString();\r\n            let isOutputNode = layerNum === numlayers - 1 && i === 0;\r\n            let node = new Node(nodeId, isOutputNode ? outputActivationFunction : activationFunction);\r\n            currentLayer.push(node);\r\n\r\n            if (!isInputLayer) {\r\n                // Link nodes from previous layer\r\n                let prevLayer = network[layerNum - 1]\r\n                for (let j = 0; j < prevLayer.length; j++) {\r\n                    let prevNode = prevLayer[j];\r\n                    let link = new Link(prevNode, node);\r\n                    prevNode.linksOut.push(link);\r\n                    node.linksIn.push(link);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    return network;\r\n}\r\n\r\nexport function forwardPropagate(network: Node[][], inputs: number[]): number {\r\n    let numLayers = network.length;\r\n    let inputLayer = network[0];\r\n    let outputlayer = network[numLayers - 1];\r\n\r\n    if (inputLayer.length !== inputs.length) {\r\n        // Check the number of inputs is equal to the number of nodes in the first layer\r\n        throw new Error(\"Then number of inputs should equal the number of input neurons\");\r\n    }\r\n\r\n    for (let i = 0; i < inputLayer.length; i++) {\r\n        let node = inputLayer[i];\r\n        node.output = inputs[i];\r\n    }\r\n\r\n    for (let layerNum = 1; layerNum < numLayers; layerNum++) {\r\n        let currentLayer = network[layerNum];\r\n        for (let i = 0; i < currentLayer.length; i++) {\r\n            let node = currentLayer[i];\r\n            node.updateOutput();\r\n        }\r\n    }\r\n\r\n    return outputlayer[0].output;\r\n}\r\n\r\n/**\r\n * Back propagation algorithm.\r\n * @param network The neural network to run backprogation on.\r\n * @param costFunction The cost function used to determing how well the neural network performs.\r\n * @param y The expected out put of the neural network.\r\n */\r\nexport function backPropagate(network: Node[][], costFunction: CostFunction, y: number): void {\r\n\r\n    // Special Case: Last Layer (Single output node) /////////////////////////////////////////\r\n\r\n    let outputNode = network[network.length - 1][0];\r\n\r\n    // outputDerivative = dc/da\r\n    outputNode.outputDerivative = costFunction.derivative(outputNode.output, y);\r\n\r\n    // General Case: Hidden Layers //////////////////////////////////////////////////////////\r\n\r\n    for (let layerNum = network.length - 1; layerNum > 0; layerNum--) {\r\n        let currentLayer = network[layerNum];\r\n\r\n        // Parse through nodes and calculate input derivatives\r\n        for (let i = 0; i < currentLayer.length; i++) {\r\n            let node = currentLayer[i];\r\n\r\n            // Calculate input derivative for current node\r\n            // inputDerivative = dc/dz = dc/da . phi_d(z)\r\n            node.inputDerivative = node.outputDerivative * node.activationFunction.derivative(node.totalInput);\r\n\r\n            // For average in gradient decent\r\n            // dc/db for the bias on the current node\r\n            node.accInputDererivatives += node.inputDerivative;\r\n            node.numInputDerivatives++;\r\n\r\n        }\r\n\r\n        // Parse through nodes again to calculate weight derivative for link\r\n        for (let i = 0; i < currentLayer.length; i++) {\r\n            let node = currentLayer[i];\r\n            // dc/dw for each weight comming in\r\n            for (let j = 0; j < node.linksIn.length; j++) {\r\n                let link = node.linksIn[j];\r\n\r\n                link.costDer = link.source.output * node.inputDerivative;\r\n                link.derAcc += link.costDer;\r\n                link.noAccDers++;\r\n            }\r\n        }\r\n\r\n        // Don't bother computing ouput derivatives for input nodes (Saves on compuiation)\r\n        if (layerNum === 1) continue;\r\n\r\n        // Parse through the previous layer and calculate output derivative all the nodes\r\n        let previousLayer = network[layerNum - 1];\r\n        for (let i = 0; i < previousLayer.length; i++) {\r\n            let node = previousLayer[i];\r\n            // Compute the error derivative with respect to each node's output.\r\n            node.outputDerivative = 0;\r\n            for (let j = 0; j < node.linksOut.length; j++) {\r\n                let link = node.linksOut[j];\r\n                node.outputDerivative += link.dest.inputDerivative * link.weight;\r\n            }\r\n        }\r\n    }\r\n\r\n}\r\n\r\n/**\r\n * \r\n * @param network \r\n * @param trainingData \r\n * @param costFunction \r\n * @param learningRate The hyperparameter that determines how much weights a biases change on each iteration (AKA epsilon)\r\n */\r\nexport function train(network: Node[][], learningRate: number) {\r\n\r\n    for (let layerNum = 1; layerNum < network.length; layerNum++) {\r\n\r\n        let currentLayer = network[layerNum];\r\n\r\n        for (let i = 0; i < currentLayer.length; i++) {\r\n            let node = currentLayer[i];\r\n\r\n            for (let j = 0; j < node.linksIn.length; j++) {\r\n                let link = node.linksIn[j];\r\n\r\n                if (link.noAccDers > 0) {\r\n                    let averageWeightGradient = link.derAcc / link.noAccDers;\r\n                    link.weight = link.weight - (learningRate * averageWeightGradient);\r\n\r\n                    link.derAcc = 0;\r\n                    link.noAccDers = 0;\r\n                }\r\n            }\r\n            if (node.numInputDerivatives > 0) {\r\n                let averageBiasGradient = node.accInputDererivatives / node.numInputDerivatives;\r\n\r\n                node.bias = node.bias - (learningRate * averageBiasGradient);\r\n\r\n                node.accInputDererivatives = 0;\r\n                node.numInputDerivatives = 0;\r\n            }\r\n\r\n        }\r\n    }\r\n}\r\n\r\nexport function forEachNode(network: Node[][], f: (node: Node) => void, ignoreInputs?: boolean): void {\r\n    for (let layerNum = ignoreInputs ? 1 : 0; layerNum < network.length; layerNum++) {\r\n        let currentLayer = network[layerNum];\r\n        for (let i = 0; i < currentLayer.length; i++) {\r\n            f(currentLayer[i]);\r\n        }\r\n    }\r\n}\r\n\r\nexport function getOutputNode(network: Node[][]): Node {\r\n    return network[network.length - 1][0];\r\n}\r\n\r\nexport function copyNetwork(network: Node[][]): Node[][] {\r\n    let networkCopy: Node[][] = [];\r\n    \r\n    for (let layerNum = 0; layerNum < network.length; layerNum++) {\r\n        let currentLayerCopy: Node[] = [];\r\n\r\n        networkCopy.push(currentLayerCopy);\r\n\r\n        let isInputLayer = layerNum === 0;\r\n\r\n        for (let i = 0; i < network[layerNum].length; i++) {\r\n            let nodeOriginal = network[layerNum][i];\r\n            let nodeCopy = new Node(nodeOriginal.id, nodeOriginal.activationFunction);\r\n            currentLayerCopy.push(nodeCopy);\r\n\r\n            if (!isInputLayer) {\r\n                let prevLayerCopy = networkCopy[layerNum - 1]\r\n                for (let j = 0; j < prevLayerCopy.length; j++) {\r\n                    let prevNodeCopy = prevLayerCopy[j];\r\n\r\n                    let linkOriginal = nodeOriginal.linksIn[j];\r\n\r\n                    let linkCopy = new Link(prevNodeCopy, nodeCopy, linkOriginal.weight);\r\n                    prevNodeCopy.linksOut.push(linkCopy);\r\n                    nodeCopy.linksIn.push(linkCopy);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    return networkCopy;\r\n}","import * as d3 from \"d3\";\r\n\r\n// Maybe refactor to Datapoint\r\nexport type Datapoint2D = {\r\n    x1: number,\r\n    x2: number,\r\n    y: number\r\n};\r\n\r\nexport type DatasetGenerator = (numSamples: number, noise: number) => Datapoint2D[];\r\n\r\n\r\nexport class Dataset {\r\n\r\n    public static GAUSSIAN_2: DatasetGenerator = (numSamples, noise) => {\r\n        // When noise = 0, variance = 0.5 and when noise = 1, variance = 8\r\n        let varianceScale = d3.scaleLinear().domain([0, .5]).range([0.5, 4]); // Arbitrary\r\n        let variance = varianceScale(noise) || 0;\r\n        let samples: Datapoint2D[] = [];\r\n\r\n        /**\r\n         * Generate a gaussian dataset with centre point (/mean) at cx, cy\r\n         * @param cx Mean of distribution along x\r\n         * @param cy Mean of distribution along y\r\n         * @param variance Variance of distribution\r\n         */\r\n        function generateGaussianData(cx1: number, cx2: number, y: number) {\r\n            // Workiung with an -8, 8 grid non-variable for the forseeable future\r\n            for (let i = 0; i < numSamples / 2; i++) {\r\n                let x1 = normalDistribution(cx1, variance);\r\n                let x2 = normalDistribution(cx2, variance);\r\n                samples.push({ x1: x1, x2: x2, y: y });\r\n            }\r\n        }\r\n\r\n        // Generate two sets of gauss distributed data with mean at points (-3, -3) and (3, 3) each with \r\n        generateGaussianData(-3, -3, -1);\r\n        generateGaussianData(3, 3, 1);\r\n\r\n        return shuffle(samples);\r\n    }\r\n\r\n    public static GAUSSIAN_3: DatasetGenerator = (numSamples, noise) => {\r\n        let varianceScale = d3.scaleLinear().domain([0, .5]).range([0.5, 4]); // Arbitrary\r\n        let variance = varianceScale(noise) || 0;\r\n        let samples: Datapoint2D[] = [];\r\n\r\n        /**\r\n         * Generate a gaussian dataset with centre point (/mean) at cx, cy\r\n         * @param cx Mean of distribution along x\r\n         * @param cy Mean of distribution along y\r\n         * @param variance Variance of distribution\r\n         */\r\n        function generateGaussianData(cx1: number, cx2: number, y: number) {\r\n            // Workiung with an -8, 8 grid non-variable for the forseeable future\r\n            for (let i = 0; i < numSamples / 3; i++) {\r\n                let x1 = normalDistribution(cx1, variance);\r\n                let x2 = normalDistribution(cx2, variance);\r\n                samples.push({ x1: x1, x2: x2, y: y });\r\n            }\r\n        }\r\n\r\n        // Generate two sets of gauss distributed data with mean at points (-3, -3) and (3, 3) each with \r\n        generateGaussianData(-4, -4, -1);\r\n        generateGaussianData(0, 0, 1);\r\n        generateGaussianData(4, 4, -1);\r\n\r\n        return shuffle(samples);\r\n    }\r\n\r\n    public static XOR: DatasetGenerator = (numSamples, noise) => {\r\n        let noiseScale = d3.scaleLinear().domain([0, 1]).range([-0.5, 0.5]);\r\n        let samples: Datapoint2D[] = [];\r\n        function generateUniformData(cx1: number, cx2: number, width: number, height: number, y: number) {\r\n            let x1Scale = d3.scaleLinear().domain([0, 1]).range([cx1 - (width / 2), cx1 + (width / 2)]);\r\n            let x2Scale = d3.scaleLinear().domain([0, 1]).range([cx2 - (height / 2), cx2 + (height / 2)]);\r\n            for (let i = 0; i < numSamples / 4; i++) {\r\n                let x1 = x1Scale(Math.random() + (noiseScale(Math.random()) || 0) * noise) || 0;\r\n                let x2 = x2Scale(Math.random() + (noiseScale(Math.random()) || 0) * noise) || 0;\r\n                samples.push({ x1: x1, x2: x2, y: y });\r\n            }\r\n        }\r\n\r\n        generateUniformData(-8 / 2, 8 / 2, 8, 8, 1);     // Top left +1\r\n        generateUniformData(8 / 2, 8 / 2, 8, 8, -1);     // Top right -1\r\n        generateUniformData(-8 / 2, -8 / 2, 8, 8, -1);   // Bottom left -1\r\n        generateUniformData(8 / 2, -8 / 2, 8, 8, 1);     // Bottom right +1\r\n\r\n        return shuffle(samples);\r\n    }\r\n}\r\n\r\n\r\n/**\r\n * Function to randomly generate a point in the normal distribution described by\r\n * the mean and variance parameters, using the Box-Muller transform\r\n * @param mean the mean or mu to describe the normal(/gaussian) distribution\r\n * @param variance The variance or sigma squared to describe the normal(/gaussian) distribution\r\n */\r\nfunction normalDistribution(mean: number, variance: number): number {\r\n    let x1, x2, y, w: number;\r\n\r\n    mean = mean || 0;\r\n    variance = variance || 1;\r\n\r\n    do {\r\n        x1 = 2 * Math.random() - 1;\r\n        x2 = 2 * Math.random() - 1;\r\n        w = x1 * x1 + x2 * x2;\r\n    } while (w > 1);\r\n\r\n    y = Math.sqrt(-2 * Math.log(w) / w) * x1;\r\n\r\n    return mean + Math.sqrt(variance) * y;\r\n}\r\n\r\nfunction shuffle(dataset: Datapoint2D[]): Datapoint2D[] {\r\n    var currentIndex = dataset.length, temporaryValue, randomIndex;\r\n  \r\n    // While there remain elements to shuffle...\r\n    while (0 !== currentIndex) {\r\n  \r\n      // Pick a remaining element...\r\n      randomIndex = Math.floor(Math.random() * currentIndex);\r\n      currentIndex -= 1;\r\n  \r\n      // And swap it with the current element.\r\n      temporaryValue = dataset[currentIndex];\r\n      dataset[currentIndex] = dataset[randomIndex];\r\n      dataset[randomIndex] = temporaryValue;\r\n    }\r\n  \r\n    return dataset;\r\n  }","import * as nn from \"./NeuralNet\";\r\nimport { Datapoint2D, DatasetGenerator, Dataset } from \"./datasets\";\r\nimport * as d3 from \"d3\";\r\nimport seedrandom from \"seedrandom\";\r\nimport { NNConfig } from \"./NetworkController\";\r\n\r\n\r\ninterface InputFunc {\r\n    f: (x: number, y: number) => number;\r\n    label: string;\r\n}\r\n\r\nlet ACTIVATIONS: { [name: string]: nn.ActivationFunction } = {\r\n    \"Tanh\": nn.Activations.TANH,\r\n    \"ReLU\": nn.Activations.RELU,\r\n    \"Sigmoid\": nn.Activations.SIGMOID,\r\n}\r\n\r\nlet GENERATORS: { [datasetType: string]: DatasetGenerator } = {\r\n    \"Gaussian2\": Dataset.GAUSSIAN_2,\r\n    \"Gaussian3\": Dataset.GAUSSIAN_3,\r\n    \"XOR\": Dataset.XOR,\r\n}\r\n\r\n\r\nexport let INPUTS: { [name: string]: InputFunc } = {\r\n    \"x\": { f: (x, y) => x, label: \"X_1\" },\r\n    \"y\": { f: (x, y) => y, label: \"X_2\" },\r\n    \"xSquared\": { f: (x, y) => x * x, label: \"X_1^2\" },\r\n    \"ySquared\": { f: (x, y) => y * y, label: \"X_2^2\" },\r\n    \"xTimesY\": { f: (x, y) => x * y, label: \"X_1X_2\" },\r\n    \"sinX\": { f: (x, y) => Math.sin(x), label: \"sin(X_1)\" },\r\n    \"sinY\": { f: (x, y) => Math.sin(y), label: \"sin(X_2)\" },\r\n};\r\n\r\n\r\nexport function start(config: NNConfig): nn.Node[][] {\r\n    let network = nn.generateNetwork(config.networkShape, ACTIVATIONS[config.activationFunction], nn.Activations.TANH, config.inputs);\r\n    console.log(network);\r\n\r\n    return network;\r\n}\r\n\r\nexport function getDataset(datasetType: string, numSamples: number, noise: number) {\r\n    let datasetGenerator = GENERATORS[datasetType];\r\n    let dataset = datasetGenerator(numSamples, noise);\r\n    // console.log(dataset);\r\n    return dataset;\r\n}\r\n\r\nexport function constructInputs(x: number, y: number, inputs: { [key: string]: boolean }): number[] {\r\n    let constructedInputs: number[] = [];\r\n    for (let inputName in INPUTS) {\r\n        if (inputs[inputName]) constructedInputs.push(INPUTS[inputName].f(x, y))\r\n    }\r\n    // console.log(\"X:\" + x + \" Y:\"+ y)\r\n    // console.log(constructedInputs)\r\n    return constructedInputs;\r\n\r\n}\r\n\r\nexport function step(network: nn.Node[][], trainingData: Datapoint2D[], learningRate: number, inputs: { [key: string]: boolean }, batchSize: number): nn.Node[][] {\r\n    for (let i = 0; i < trainingData.length; i++) {\r\n        let sample = trainingData[i];\r\n        nn.forwardPropagate(network, constructInputs(sample.x1, sample.x2, inputs));\r\n        nn.backPropagate(network, nn.Costs.SQUARE, sample.y);\r\n        if ((i + 1) % batchSize === 0) nn.train(network, learningRate);\r\n    }\r\n    return network;\r\n}\r\n\r\nexport function getCost(network: nn.Node[][], data: Datapoint2D[], inputs: { [key: string]: boolean }/* , costFunction: nn.CostFunction */): number {\r\n    let totalCost = 0;\r\n    for (let i = 0; i < data.length; i++) {\r\n        let dataPoint = data[i];\r\n        totalCost += nn.Costs.SQUARE.cost(nn.forwardPropagate(network, constructInputs(dataPoint.x1, dataPoint.x2, inputs)), dataPoint.y);\r\n    }\r\n\r\n    return totalCost / data.length;\r\n}\r\n\r\nexport function copyNetwork(network: nn.Node[][]): nn.Node[][] {\r\n    return nn.copyNetwork(network);\r\n}\r\n\r\nexport function getOutputDecisionBoundary(network: nn.Node[][], density: number, xDomain: number[], yDomain: number[], inputs: { [key: string]: boolean }): Datapoint2D[] {\r\n\r\n    let xScale = d3.scaleLinear().domain([0, density]).range(xDomain);\r\n    let yScale = d3.scaleLinear().domain([density, 0]).range(yDomain);\r\n    let boundary: Datapoint2D[] = [];\r\n\r\n    for (let i = 0; i < density; i++) {\r\n        for (let j = 0; j < density; j++) {\r\n            let x = xScale(j);\r\n            let y = yScale(i);\r\n\r\n            let input = constructInputs(x || 0, y || 0, inputs);\r\n            nn.forwardPropagate(network, input);\r\n\r\n            let dataPoint: Datapoint2D = { x1: x || 0, x2: y || 0, y: nn.getOutputNode(network).output }\r\n\r\n            boundary.push(dataPoint);\r\n        }\r\n    }\r\n\r\n    return boundary;\r\n}\r\n\r\nexport function getOutputDecisionBoundary1D(network: nn.Node[][], density: number, xDomain: number[], yDomain: number[], inputs: { [key: string]: boolean }): number[] {\r\n\r\n    let xScale = d3.scaleLinear().domain([0, density]).range(xDomain);\r\n    let yScale = d3.scaleLinear().domain([density, 0]).range(yDomain);\r\n    let boundary: number[] = [];\r\n    let iter = 0;\r\n\r\n    for (let i = 0; i < density; i++) {\r\n        for (let j = 0; j < density; j++) {\r\n            let x = xScale(j);\r\n            let y = yScale(i);\r\n\r\n            let input = constructInputs(x || 0, y || 0, inputs);\r\n            nn.forwardPropagate(network, input);\r\n\r\n            boundary[iter++] = nn.getOutputNode(network).output;\r\n        }\r\n    }\r\n\r\n    return boundary;\r\n}\r\n\r\nexport function getAllDecisionBoundaries(network: nn.Node[][], density: number, xDomain: number[], yDomain: number[], inputs: { [key: string]: boolean }): { [nodeId: string]: number[] } {\r\n    let boundaries: { [nodeId: string]: number[] } = {};\r\n\r\n    let xScale = d3.scaleLinear().domain([0, density]).range(xDomain);\r\n    let yScale = d3.scaleLinear().domain([density, 0]).range(yDomain);\r\n    let iter = 0;\r\n\r\n    let inputNodeIds = Object.keys(INPUTS);\r\n\r\n    for (let i = 0; i < density; i++) {\r\n        for (let j = 0; j < density; j++) {\r\n            let x = xScale(j);\r\n            let y = yScale(i);\r\n\r\n            let input = constructInputs(x || 0, y || 0, inputs);\r\n            nn.forwardPropagate(network, input);\r\n            nn.forEachNode(network, (node: nn.Node) => {\r\n                if (!boundaries[node.id]) boundaries[node.id] = [];\r\n                boundaries[node.id][iter] = node.output;\r\n            })\r\n            inputNodeIds.forEach((nodeId) => {\r\n                if (!boundaries[nodeId]) boundaries[nodeId] = [];\r\n                boundaries[nodeId][iter] = INPUTS[nodeId].f(x || 0, y || 0);\r\n            })\r\n            iter++;\r\n            //boundary[iter++] = nn.getOutputNode(network).output;\r\n        }\r\n    }\r\n\r\n    return boundaries;\r\n\r\n}\r\n\r\n","import * as d3 from \"d3\";\r\nimport React, { useContext, useEffect, useRef } from \"react\";\r\nimport { ThemeContext } from \"../contexts/ThemeContext\";\r\n\r\n\r\ninterface CanvasProps {\r\n    id?: string;\r\n    width: number;\r\n    height: number;\r\n    numCells: number;\r\n    numShades?: number;\r\n    padding: boolean;\r\n    decisionBoundary?: number[];\r\n    discreetBoundary: boolean;\r\n    disabled: boolean;\r\n    paddingLeft?: number;\r\n    paddingRight?: number;\r\n    paddingTop?: number;\r\n    paddingBottom?: number;\r\n}\r\n\r\n\r\nfunction BackgroundCanvas(props: CanvasProps) {\r\n    const {minColour, midColour, maxColour} = useContext(ThemeContext);\r\n\r\n    const canvasRef = useRef<HTMLCanvasElement>(null);\r\n\r\n    useEffect(() => {\r\n        //console.log(`BackgroundCanvas decisionBoundary useEffect`);\r\n        updateCanvas();\r\n    }, [props.decisionBoundary, props.discreetBoundary]);\r\n    \r\n    const updateCanvas = () => {\r\n\r\n        //console.log(\"Update canvas\");\r\n\r\n        let start = Date.now();\r\n\r\n        let tmpScale = d3.scaleLinear<string, number>()\r\n            .domain([0, 0.5, 1])\r\n            .range(props.disabled ? [\"#606060\", \"#FFFFFF\", \"#202020\" ] : [minColour, midColour, maxColour])\r\n            .clamp(true);\r\n\r\n        let numShades = props.numShades || 100;\r\n\r\n        let colors = d3.range(0, 1 + 1E-9, 1 / numShades).map(a => {\r\n            return tmpScale(a) || 0;\r\n        });\r\n\r\n        let color: any = d3.scaleQuantize()\r\n            .domain([-1, 1])\r\n            .range(colors);\r\n\r\n        const canvas = canvasRef.current;\r\n        const context = canvas?.getContext(\"2d\");\r\n        if(!props.decisionBoundary || !context) return;\r\n        let imageData = context.createImageData(props.numCells, props.numCells);\r\n\r\n        if(!imageData) return;\r\n\r\n        const data = imageData.data;\r\n        let iter = -1;\r\n\r\n        for(let i = 0; i < props.decisionBoundary.length; i++) {\r\n            let value: number = props.decisionBoundary[i];\r\n            if(props.discreetBoundary) value = value > 0 ? 1 : -1;\r\n            let c = d3.rgb(color(value));\r\n            data[++iter] = c.r;\r\n            data[++iter] = c.g;\r\n            data[++iter] = c.b;\r\n            data[++iter] = 200;\r\n        }\r\n        context.putImageData(imageData, 0, 0);\r\n\r\n        let delta = Date.now() - start;\r\n        //console.log(`Finsihed updating canvas (Duration: ${delta}ms)`);\r\n    };\r\n\r\n    return (\r\n        <canvas\r\n            ref={canvasRef}\r\n            id={props.id}\r\n            className=\"background\"\r\n            width={props.numCells}\r\n            height={props.numCells}\r\n            style={{\r\n                width: `${props.width}px`,\r\n                height: `${props.height}px`,\r\n                paddingLeft: `${props.padding && props.paddingLeft ? props.paddingLeft : \"0\"}px`,\r\n                paddingRight: `${props.padding && props.paddingRight ? props.paddingRight : \"0\"}px`,\r\n                paddingTop: `${props.padding && props.paddingTop ? props.paddingTop: \"0\"}px`,\r\n                paddingBottom: `${props.padding && props.paddingBottom ? props.paddingBottom : \"0\"}px`,\r\n            }}\r\n        />);\r\n}\r\n\r\nexport default BackgroundCanvas;","import React, { useEffect, useState, useRef, useContext } from \"react\";\r\nimport * as d3 from \"d3\";\r\nimport { Datapoint2D } from \"../datasets\";\r\nimport BackgroundCanvas from \"./BackgroundCanvas\";\r\nimport { ThemeContext } from \"../contexts/ThemeContext\";\r\n\r\ninterface GraphProps  {\r\n    dataset: Datapoint2D[];\r\n    density: number;\r\n    canvasWidth: number;\r\n\r\n    marginLeft: number;\r\n    marginRight: number;\r\n    marginTop: number;\r\n    marginBottom: number;\r\n    numCells: number;\r\n    xDomain: number[];\r\n    yDomain: number[];\r\n    decisionBoundary?: number[];\r\n    discreetBoundary: boolean;\r\n}\r\n\r\n\r\nfunction NNGraph(props: GraphProps): JSX.Element {\r\n\r\n    const {minColour, maxColour} = useContext(ThemeContext);\r\n\r\n    const d3Container: any = useRef<any>(null);\r\n\r\n    const [initialised, setInitialised] = useState<boolean>(false);\r\n\r\n    let scale = props.canvasWidth / 16;\r\n\r\n\r\n    const init = () => {\r\n        console.log(\"NNGraph init\")\r\n\r\n        createGraph();\r\n        setInitialised(true);\r\n    }\r\n\r\n    useEffect(() => {\r\n        console.log(\"NNGraph inital useEffect\")\r\n        init()\r\n    }, []);\r\n\r\n\r\n    useEffect(() => {\r\n        console.log(\"props and props.decisionboundary NNGraph useEffect\")\r\n        if (!initialised) {\r\n            init()\r\n        } else {\r\n            updateGraph()\r\n        }\r\n    }, [props.decisionBoundary, props.dataset]);\r\n\r\n\r\n    const createGraph = () => {\r\n        console.log(\"Creating graph\");\r\n\r\n        d3.select(d3Container.currnet)\r\n            .attr(\"width\", props.canvasWidth + props.marginLeft + props.marginRight)\r\n            .attr(\"height\", props.canvasWidth + props.marginTop + props.marginBottom);\r\n\r\n    }\r\n\r\n    const addFormattedText = (label: string, text: d3.Selection<SVGTextElement, unknown, null, undefined>) => {\r\n        if (/[_^]/.test(label)) {\r\n            let myRe = /(.*?)([_^])(.)/g;\r\n            let myArray;\r\n            let lastIndex;\r\n            while ((myArray = myRe.exec(label)) != null) {\r\n                lastIndex = myRe.lastIndex;\r\n                let prefix = myArray[1];\r\n                let sep = myArray[2];\r\n                let suffix = myArray[3];\r\n                if (prefix) {\r\n                    text.append(\"tspan\").text(prefix);\r\n                }\r\n                text.append(\"tspan\")\r\n                    .attr(\"baseline-shift\", sep === \"_\" ? \"sub\" : \"super\")\r\n                    .style(\"font-size\", \"9px\")\r\n                    .text(suffix);\r\n            }\r\n            if (lastIndex && label.substring(lastIndex)) {\r\n                text.append(\"tspan\").text(label.substring(lastIndex));\r\n            }\r\n        } else {\r\n            text.append(\"tspan\").text(label);\r\n        }\r\n    }\r\n\r\n    const updateGraph = () => {\r\n        console.log(\"Updating graph\");\r\n\r\n        const svg = d3.select(d3Container.current);\r\n\r\n        svg.selectAll(`.graph`).remove();\r\n\r\n        const graph = svg.append(\"g\")\r\n            .attr(\"class\", \"graph\")\r\n            .attr(\"transform\", `translate(${props.marginLeft}, ${props.marginTop})`);\r\n\r\n        const x = d3.scaleLinear().range([0, props.canvasWidth]);\r\n        const y = d3.scaleLinear().range([props.canvasWidth, 0]);\r\n\r\n        x.domain([-8, 8]);\r\n        y.domain([-8, 8]);\r\n\r\n        graph.append(\"g\")\r\n            .attr(\"class\", `axis`)\r\n            .attr(\"transform\", `translate(0,${props.canvasWidth})`)\r\n            .call(d3.axisBottom(x).tickValues([0].concat(x.ticks())));\r\n\r\n        graph.append(\"g\")\r\n            .attr(\"class\", `axis`)\r\n            .call(d3.axisLeft(y).tickValues([0].concat(y.ticks())));\r\n\r\n        graph.append(\"g\")\r\n            .attr(\"class\", `axis`)\r\n            .attr(\"transform\", `translate(${props.canvasWidth},0)`)\r\n            .call(d3.axisRight(y).tickValues([0].concat(y.ticks())));\r\n\r\n        graph.append(\"g\")\r\n            .attr(\"class\", `axis`)\r\n            .call(d3.axisTop(x).tickValues([0].concat(x.ticks())));\r\n\r\n        let xAxisLabel = \"X_1\";\r\n        let yAxisLabel = \"X_2\";\r\n\r\n        let xAxisText = graph.append(\"text\")\r\n            .attr(\"class\", `axis`)\r\n            .attr(\"x\", props.canvasWidth / 2)\r\n            .attr(\"y\", props.canvasWidth + props.marginBottom - 7)\r\n            .attr(\"text-anchor\", \"middle\")\r\n            .attr(\"alignment-baseline\", \"bottom\");\r\n\r\n        addFormattedText(xAxisLabel, xAxisText);\r\n\r\n        let yAxisText = graph.append(\"text\")\r\n            .attr(\"class\", `axis`)\r\n            .attr(\"y\", props.canvasWidth / 2)\r\n            .attr(\"x\", -props.marginLeft)\r\n            .attr(\"text-anchor\", \"left\")\r\n            .attr(\"alignment-baseline\", \"middle\")     \r\n        \r\n\r\n        addFormattedText(yAxisLabel, yAxisText);\r\n\r\n        let filteredDataset = props.dataset.filter((p: Datapoint2D) => {\r\n            return p.x1 >= x.domain()[0] && p.x1 <= x.domain()[1]\r\n              && p.x2 >= y.domain()[0] && p.x2 <= y.domain()[1];\r\n          });\r\n\r\n        graph.selectAll(`.circle`)\r\n            .data(filteredDataset)\r\n            .enter().append(\"circle\")\r\n            .attr(\"class\", `circle`)\r\n            .attr(\"r\", scale / 7)\r\n            .attr(\"fill\", function (datapoint: Datapoint2D): string {\r\n                let colour = \"black\";\r\n                if (datapoint.y === 1) colour = maxColour;\r\n                if (datapoint.y === -1) colour = minColour;\r\n\r\n                return colour;\r\n            })\r\n            .style(\"stroke\", \"black\")\r\n            .attr(\"cx\", (datapoint: Datapoint2D) => (datapoint.x1 * scale) + (props.canvasWidth / 2))\r\n            .attr(\"cy\", (datapoint: Datapoint2D) => -(datapoint.x2 * scale) + (props.canvasWidth / 2));\r\n    \r\n\r\n        }\r\n\r\n    return (\r\n        <>\r\n            <div style={{ position: \"relative\"}}>\r\n                <svg\r\n                    ref={d3Container}\r\n                    width={props.canvasWidth + props.marginLeft + props.marginRight}\r\n                    height={props.canvasWidth + props.marginTop + props.marginBottom}\r\n                    style={{ position: \"absolute\"}}\r\n                />\r\n                <BackgroundCanvas\r\n                    width={props.canvasWidth}\r\n                    height={props.canvasWidth}\r\n                    numCells={props.numCells}\r\n                    paddingLeft={props.marginLeft}\r\n                    paddingRight={props.marginRight}\r\n                    paddingTop={props.marginTop}\r\n                    paddingBottom={props.marginBottom}\r\n                    disabled={false}\r\n                    padding={true}\r\n                    decisionBoundary={props.decisionBoundary}\r\n                    discreetBoundary={props.discreetBoundary}\r\n                />\r\n            </div>\r\n        </>\r\n    );\r\n}\r\n\r\nexport default NNGraph;","import styled from \"@emotion/styled\";\r\nimport { IconButton, Tooltip } from \"@material-ui/core\";\r\nimport { Info } from \"@material-ui/icons\";\r\nimport React from \"react\";\r\n\r\nconst StyledIconButton = styled(IconButton)`\r\n    -webkit-box-sizing: border-box; /* Safari/Chrome, other WebKit */\r\n    -moz-box-sizing: border-box;    /* Firefox, other Gecko */\r\n    box-sizing: border-box; \r\n    width: 20px;\r\n    height: 20px;\r\n    color: #505050;\r\n    padding: 10px;\r\n    \r\n    margin: auto 0px;\r\n    border-radius: 100%;\r\n    &:hover {\r\n        background-color: inherit;\r\n    }\r\n\r\n`\r\n\r\nconst HtmlTooltip = styled(Tooltip)`\r\n    -webkit-box-sizing: border-box; /* Safari/Chrome, other WebKit */\r\n    -moz-box-sizing: border-box;    /* Firefox, other Gecko */\r\n    box-sizing: border-box; \r\n\r\n    margin-right: ${(props: { marginLeft: number, marginRight: number }) => `${props.marginRight}px`};\r\n    margin-left: ${(props: { marginLeft: number, marginRight: number }) => `${props.marginLeft}px`};\r\n\r\n`\r\n\r\ninterface InfoButtonProps {\r\n    title: string;\r\n    children?: React.ReactElement;\r\n    onClick?: (panel: JSX.Element) => void;\r\n    infoPanel?: JSX.Element;\r\n    icon?: React.ReactElement;\r\n    fontSize?: \"small\" | \"inherit\" | \"default\" | \"large\" | undefined;\r\n    marginLeft?: number;\r\n    marginRight?: number;\r\n}\r\n\r\nconst InfoButton: React.FC<InfoButtonProps> = ({\r\n    marginLeft = 10,\r\n    marginRight = 10,\r\n    ...props\r\n}) => {\r\n\r\n    return (\r\n        <HtmlTooltip interactive arrow\r\n            title={props.children || props.title}\r\n            onClick={() => props.onClick && props.infoPanel && props.onClick(props.infoPanel)}\r\n            marginLeft={marginLeft}\r\n            marginRight={marginRight}\r\n        >\r\n            <StyledIconButton>\r\n                {props.icon || <Info fontSize={props.fontSize} />}\r\n            </StyledIconButton>\r\n        </HtmlTooltip>\r\n    );\r\n}\r\n\r\nexport default InfoButton;","import styled from \"@emotion/styled\";\r\nimport React, { useEffect, useState } from \"react\";\r\nimport BackgroundCanvas from \"./BackgroundCanvas\";\r\n\r\ninterface NNNodeProps {\r\n    nodeWidth: number;\r\n    id: string;\r\n    nodeId?: string;\r\n    decisionBoundary?: number[];\r\n    discreetBoundary: boolean;\r\n    numCells: number;\r\n    handleOnClick?: (nodeId: string, active: boolean) => any;\r\n    handleOnHover?: (nodeId: string, active: boolean) => any;\r\n    active: boolean;\r\n}\r\n\r\ninterface ContainerProps {\r\n    nodeWidth: number;\r\n    active: boolean;\r\n}\r\n\r\nconst NodeContainer = styled(\"div\") <ContainerProps>`\r\n    -webkit-box-sizing: border-box; /* Safari/Chrome, other WebKit */\r\n    -moz-box-sizing: border-box;    /* Firefox, other Gecko */\r\n    box-sizing: border-box;\r\n    //border: 2px solid ${props => props.active ?\"#000000\" : \"#505050\"};\r\n    border: 2px solid black;\r\n    //background-color: black;\r\n    background-color: white;\r\n    border-radius: 3px;\r\n    max-height: ${props => props.nodeWidth + 2 * 2}px;\r\n    cursor: pointer;\r\n`;\r\n\r\n\r\nfunction NNNode(props: NNNodeProps) {\r\n\r\n    return (\r\n        <NodeContainer id={`${props.id}`}\r\n            nodeWidth={props.nodeWidth}\r\n            active={props.active}\r\n            onClick={() => (props.handleOnClick && props.nodeId && props.handleOnClick(props.nodeId, props.active))}\r\n            onMouseOver={() => (props.handleOnHover && props.nodeId && props.handleOnHover(props.nodeId, props.active))}\r\n        >\r\n            <BackgroundCanvas\r\n                width={props.nodeWidth}\r\n                height={props.nodeWidth}\r\n                numCells={props.numCells}\r\n                padding={false}\r\n                disabled={!props.active}\r\n                decisionBoundary={props.decisionBoundary}\r\n                discreetBoundary={props.discreetBoundary}\r\n            />\r\n        </NodeContainer>\r\n    );\r\n}\r\n\r\nexport default NNNode;","import styled from \"@emotion/styled\";\r\nimport { createStyles, IconButton, makeStyles, Theme, Tooltip, Typography } from \"@material-ui/core\";\r\nimport React from \"react\";\r\n\r\nconst HtmlTooltip = styled(Tooltip)`\r\n    -webkit-box-sizing: border-box; /* Safari/Chrome, other WebKit */\r\n    -moz-box-sizing: border-box;    /* Firefox, other Gecko */\r\n    box-sizing: border-box; \r\n\r\n`\r\n\r\nconst StyledLink = styled(\"a\")`\r\n    text-decoration: underline;\r\n    color: blue;\r\n    cursor: pointer;\r\n`\r\nexport interface DefinedTermProps {\r\n    children: React.ReactChild | React.ReactChild[];\r\n    definition: React.ReactChild | React.ReactChild[];\r\n    onClick?: (panel: JSX.Element) => void;\r\n    infoPanel?: JSX.Element;\r\n}\r\n\r\nexport function DefinedTerm(props: DefinedTermProps) {\r\n    return (\r\n        <HtmlTooltip interactive arrow\r\n            title={props.definition}\r\n            onClick={() => props.onClick && props.infoPanel && props.onClick(props.infoPanel)}\r\n        ><StyledLink>{props.children}</StyledLink></HtmlTooltip>\r\n    );\r\n}\r\n\r\nexport function DefX1() {\r\n    return (\r\n        <Typography variant=\"body2\">\r\n            X<sub>1</sub> represents the first feature of a datapoint that is being entered into the neural network\r\n            (shown on the X axis of the nodes in the neural network and the output graph).<br />\r\n            Domain of X<sub>1</sub> shown in the neural network is -8 to +8.\r\n        </Typography>\r\n    );\r\n}\r\n\r\nexport function DefX2() {\r\n    return (\r\n        <Typography variant=\"body2\">\r\n            X<sub>2</sub> represents the second feature of a datapoint that is being entered into the neural network\r\n            (shown on the Y axis of the nodes in the neural network and the output graph).<br />\r\n            Domain of X<sub>2</sub> shown in the neural network is -8 to +8.\r\n        </Typography>\r\n    );\r\n}\r\n\r\nexport function DefNode() {\r\n    return (\r\n        <Typography variant=\"body2\">\r\n           Nodes are the individual functions that make up the neural network and are connected to nodes in adjacent layers by links.<br/>\r\n           <u>Click the icon to get more information</u>\r\n        </Typography>\r\n    );\r\n}\r\n\r\nexport function DefLink() {\r\n    return (\r\n        <Typography variant=\"body2\">\r\n\r\n        </Typography>\r\n    )\r\n}\r\n","import React, { useEffect, useState } from 'react';\r\n// import PropTypes from 'prop-types';\r\n\r\ninterface Point2D {\r\n    x: number;\r\n    y: number;\r\n}\r\n\r\ninterface TooltipProps {\r\n    className?: string;\r\n    visible: boolean;\r\n    offsetX?: number;\r\n    offsetY?: number;\r\n    style?: object;\r\n}\r\n\r\nconst MouseTooltip: React.FC<TooltipProps> = ({\r\n    offsetX = 0,\r\n    offsetY = 0,\r\n    ...args\r\n}) => {\r\n    const props = { offsetX, offsetY, ...args };\r\n    //   static defaultProps = {\r\n    //     visible: true,\r\n    //     offsetX: 0,\r\n    //     offsetY: 0,\r\n    //   };\r\n\r\n    //   state = {\r\n    //     xPosition: 0,\r\n    //     yPosition: 0,\r\n    //     mouseMoved: false,\r\n    //     listenerActive: false,\r\n    //   };\r\n\r\n    //   const [xPosition, setXPosition] = useState<number>(0);\r\n    //   const [yPositionm, setYPosition] = useState<number>(0);\r\n    const [position, setPosition] = useState<Point2D>({ x: 0, y: 0 });\r\n    const [mouseMoved, setMouseMoved] = useState<boolean>(false);\r\n    const [listenerActive, setListenerActive] = useState<boolean>(false);\r\n\r\n\r\n    useEffect(() => {\r\n        // window.addEventListener('mousemove', getTooltipPosition);\r\n        // setListenerActive(true);\r\n        addListener();\r\n        return () => {\r\n            // window.removeEventListener('mousemove', getTooltipPosition);\r\n            // setListenerActive(false);\r\n            removeListener();\r\n        }\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        if (!listenerActive && props.visible) {\r\n            addListener();\r\n        }\r\n\r\n        if (listenerActive && !props.visible) {\r\n            removeListener();\r\n        }\r\n    }, [props.visible, mouseMoved]);\r\n\r\n    //   componentDidMount() {\r\n    //     this.addListener();\r\n    //   }\r\n\r\n    //   componentDidUpdate() {\r\n    //     this.updateListener();\r\n    //   }\r\n\r\n    //   componentWillUnmount() {\r\n    //     this.removeListener();\r\n    //   }\r\n\r\n    const getTooltipPosition = (event: MouseEvent) => {\r\n        setPosition({ x: event.clientX, y: event.clientY });\r\n        setMouseMoved(true);\r\n        // Maybe have one state object\r\n        // this.setState({\r\n        //   xPosition,\r\n        //   yPosition,\r\n        //   mouseMoved: true,\r\n        // });\r\n    };\r\n\r\n    //   addListener = () => {\r\n    //     window.addEventListener('mousemove', this.getTooltipPosition);\r\n    //     this.setState({ listenerActive: true });\r\n    //   };\r\n\r\n      const addListener = () => {\r\n        window.addEventListener('mousemove', getTooltipPosition);\r\n        setListenerActive(true);\r\n      };\r\n\r\n    //   removeListener = () => {\r\n    //     window.removeEventListener('mousemove', this.getTooltipPosition);\r\n    //     this.setState({ listenerActive: false });\r\n    //   };\r\n\r\n      const removeListener = () => {\r\n        window.removeEventListener('mousemove', getTooltipPosition);\r\n            setListenerActive(false);\r\n      };\r\n\r\n    //   updateListener = () => {\r\n    //     if (!this.state.listenerActive && this.props.visible) {\r\n    //       this.addListener();\r\n    //     }\r\n\r\n    //     if (this.state.listenerActive && !this.props.visible) {\r\n    //       this.removeListener();\r\n    //     }\r\n    //   };\r\n\r\n    return (\r\n        <div\r\n            className={props.className}\r\n            style={{\r\n                display: props.visible && mouseMoved ? 'block' : 'none',\r\n                position: 'fixed',\r\n                top: position.y + props.offsetY,\r\n                left: position.x + props.offsetX,\r\n                ...props.style,\r\n            }}\r\n        >\r\n            {props.children}\r\n        </div>\r\n    );\r\n}\r\n\r\n// MouseTooltip.propTypes = {\r\n//   visible: PropTypes.bool,\r\n//   children: PropTypes.node.isRequired,\r\n//   offsetX: PropTypes.number,\r\n//   offsetY: PropTypes.number,\r\n//   className: PropTypes.string,\r\n//   style: PropTypes.object, // eslint-disable-line react/forbid-prop-types\r\n// };\r\n\r\nexport default MouseTooltip;","import * as nn from \"../NeuralNet\";\r\nimport styled from \"@emotion/styled\";\r\nimport React, { useContext, useEffect, useRef, useState } from \"react\";\r\nimport * as d3 from \"d3\";\r\nimport NNNode from \"./NNNode\";\r\nimport { INPUTS } from \"../visControl\"\r\nimport AddCircleIcon from '@material-ui/icons/AddCircle';\r\nimport RemoveCircleIcon from '@material-ui/icons/RemoveCircle';\r\nimport { IconButton, Typography } from \"@material-ui/core\";\r\nimport { StyledInfoButton } from \"./MainPage\";\r\nimport { DefinedTerm, DefX1, DefX2 } from \"./Definitions\";\r\nimport MouseTooltip from \"./MouseTooltip\";\r\nimport ResizeSensor from \"css-element-queries\";\r\nimport useEventListener from \"./UseEventListener\";\r\nimport { ThemeContext } from \"../contexts/ThemeContext\";\r\nimport { NNConfig } from \"../NetworkController\";\r\n\r\ninterface ContainerBox {\r\n    top: number;\r\n    left: number;\r\n    x: number;\r\n    y: number;\r\n    width: number;\r\n    height: number;\r\n}\r\n\r\nenum HoverCardType {\r\n    BIAS,\r\n    WEIGHT\r\n}\r\n\r\ninterface HoverCardConfig {\r\n    type: HoverCardType;\r\n    value: number;\r\n}\r\n\r\nconst HoverCard = styled(\"div\")`\r\n    -webkit-box-sizing: border-box; /* Safari/Chrome, other WebKit */\r\n    -moz-box-sizing: border-box;    /* Firefox, other Gecko */\r\n    box-sizing: border-box; \r\n    background-color: white;\r\n    margin: auto auto;\r\n    border-radius: 10px;\r\n    border: 2px solid #bdbdbd;\r\n    //border: 2px solid #353a3c;\r\n    width: 120px;\r\n    height: 60px;\r\n    display: flex;\r\n    flex-direction: row;\r\n    justify-content: center;\r\n    z-index: 10000;\r\n    /* position: absolute; */\r\n    /* position: static; */\r\n`\r\n\r\nconst PlusMinusButtonsContainer = styled(\"div\")`\r\n    display: flex;\r\n    justify-content: center;\r\n    align-items: center;\r\n    align-self: flex-start;\r\n`\r\n\r\nconst GridContainer = styled(\"div\")`\r\n    position: relative;\r\n    display: grid;\r\n    height: 100%;\r\n    width: 50vw;\r\n    /* max-width: 40vw; */\r\n    min-width: 550px;\r\n    grid-template-columns: auto 1fr auto;\r\n    grid-template-rows: auto 1fr 48px;\r\n    grid-gap: 0px;\r\n    grid-template-areas: \r\n        \"inputs-label layer-controls .\"\r\n        \"inputs-layer hidden-layers output\"\r\n        \". hidden-layers .\"\r\n        ;\r\n`\r\n\r\nconst Container = styled(\"div\")`\r\n    -webkit-box-sizing: border-box; /* Safari/Chrome, other WebKit */\r\n    -moz-box-sizing: border-box;    /* Firefox, other Gecko */\r\n    box-sizing: border-box;\r\n    display: flex;\r\n    flex-direction: row;\r\n    justify-content: space-between;\r\n    padding-left: 50px;\r\n    padding-right: 0px;\r\n    width: 100%;\r\n    height: inherit;\r\n`;\r\n\r\nconst Layer = styled(\"div\")`\r\n    display: flex;\r\n    flex-direction: column;\r\n    justify-content: space-around;\r\n    align-items: center;\r\n`;\r\n\r\nconst ContainerSection = styled(\"div\")`\r\n    grid-area: ${(props: { gridArea: string }) => (props.gridArea)};\r\n`\r\n\r\nconst LayerControls = styled((props: any) => <ContainerSection gridArea=\"layer-controls\" {...props} />)`\r\n    display: flex;\r\n    flex-direction: row;\r\n    justify-content: space-around;\r\n    align-items: center;\r\n`\r\n\r\ninterface CanvasProps {\r\n    visible: boolean;\r\n}\r\nconst FadeCanvas = styled(\"canvas\") <CanvasProps>`\r\n    position: absolute;\r\n    background-color: white;\r\n    border-radius: 30px;\r\n\r\n    ${({ visible }) => visible && `\r\n    transition: opacity 1.1s;\r\n    `}\r\n    ${({ visible }) => !visible && `\r\n    transition: opacity 0.1s;\r\n    `}\r\n`;\r\n\r\n// export function generateLineConfig (link: nn.Link, minColour:string, maxColour: string) {\r\n//     let weightToSize = d3.scaleLinear()\r\n//         .domain([-1, 0, 1])\r\n//         .range([6, 1.5, 6])\r\n//         .clamp(true);\r\n//     return {\r\n//         color: (link.weight > 0 ? maxColour : minColour),\r\n//         size: weightToSize(link.weight),\r\n//     }\r\n// }\r\n\r\n// export function drawLink(\r\n//     input: nn.Link, node2coord: { [id: string]: { cx: number, cy: number } },\r\n//     index: number, length: number, nodeWidth: number, minColour: string, maxColour: string, container: any) {\r\n//     let line = d3.select(container.current).append(\"path\");\r\n//     let source = node2coord[input.source.id];\r\n//     let dest = node2coord[input.dest.id];\r\n//     if (!(dest && source)) return;\r\n\r\n//     // Check X and Ys are reversed properlly\r\n//     let datum: any = {\r\n//         source:\r\n//             [source.cx + nodeWidth / 2 + 2, source.cy]\r\n//         ,\r\n//         target: [dest.cx - nodeWidth / 2, dest.cy]\r\n//     };\r\n\r\n//     let diagonal = d3.linkHorizontal()\r\n//         .x(function (d: any) {\r\n//             return d[0];\r\n//         }).y(function (d: any) { return d[1]; })\r\n//     let d = diagonal(datum);\r\n\r\n//     let linkConfig = generateLineConfig(input, minColour,  maxColour);\r\n\r\n//     d && line.attr(\"marker-start\", \"url(#markerArrow)\")\r\n//         .attr(\"class\", \"link\")\r\n//         .attr(\"id\", `link-${input.source.id}-${input.dest.id}`)\r\n//         .attr(\"d\", d)\r\n//         .attr(\"fill\", \"transparent\")\r\n//         .attr(\"pointer-events\", \"all\")\r\n//         .attr(\"stroke\", linkConfig.color)\r\n//         .attr(\"stroke-width\", linkConfig.size || 0)\r\n//         .attr(\"stroke-dasharray\", \"10,2\")\r\n//         .on(\"mouseover\", function (d, i) {\r\n//             d3.select(this).transition()\r\n//                 .duration(100000)\r\n//                 .ease(d3.easeLinear)\r\n//                 .attr(\"stroke-dashoffset\", -8000)\r\n//         })\r\n//         .on(\"mouseout\", function (d, i) {\r\n//             d3.select(this)\r\n//                 .transition();\r\n//         })\r\n//     return line;\r\n// }\r\n\r\n// function drawLink2() {\r\n\r\n// }\r\n\r\ninterface NetworkProps {\r\n    network: nn.Node[][];\r\n    decisionBoundaries: { [nodeId: string]: number[] };\r\n    discreetBoundary: boolean;\r\n    networkWidth: number;\r\n    networkHeight: number;\r\n    handleOnClick: any;\r\n    inputs: { [inputId: string]: boolean };\r\n    config: NNConfig;\r\n    addNode: (layer: number) => void;\r\n    removeNode: (layer: number) => void;\r\n    addLayer: () => void;\r\n    removeLayer: () => void;\r\n    setInfoPanel: any;\r\n}\r\n\r\n// Could remove the output node and point straight to the graph\r\nfunction NeuralNetworkVis(props: NetworkProps) {\r\n    const { minColour, maxColour } = useContext(ThemeContext);\r\n\r\n    const svgContainer: any = useRef<any>(null);\r\n    const container: any = useRef<any>(null);\r\n    const nodeWidth = 30;\r\n    const [linksUpdated, setLinksUpdated] = useState<boolean>(false);\r\n    const [network, setNetwork] = useState<nn.Node[][]>();\r\n    const [labelsDrawn, setLabelsDrawn] = useState<boolean>(false);\r\n    const [containerBox, setContainerBox] = useState<ContainerBox>({ top: 0, left: 0, x: 0, y: 0, width: 0, height: 0 });\r\n    const [showHoverCard, setShowHoverCard] = useState<boolean>(false);\r\n    const [hoverCardConfig, setHoverCardConfig] = useState<HoverCardConfig>({ type: HoverCardType.WEIGHT, value: 0 });\r\n    const [hoverTarget, setHoverTarget] = useState<string>(\"\");\r\n\r\n\r\n    useEffect(() => {\r\n\r\n        updateContainerBox();\r\n\r\n        let container = document.getElementById(\"main-container\");\r\n\r\n        if (container) {\r\n            window.addEventListener('resize', updateContainerBox);\r\n            container.addEventListener('scroll', updateContainerBox);\r\n        }\r\n        return () => {\r\n            if (container) {\r\n                window.removeEventListener('resize', updateContainerBox);\r\n                container.removeEventListener('scroll', updateContainerBox);\r\n            }\r\n        }\r\n    }, [])\r\n\r\n    const updateHovercard = (event: any) => {\r\n        let targetId = event.target.id;\r\n\r\n        if (targetId\r\n            && (targetId.indexOf(\"link\") !== -1 || targetId.indexOf(\"node\") !== -1)\r\n            && !(targetId.substring(5) in props.inputs)) {\r\n\r\n            setHoverTarget(targetId);\r\n            setShowHoverCard(true);\r\n\r\n        }\r\n    }\r\n\r\n    const hideHoverCard = (event: any) => {\r\n        let targetId = event.target.id;\r\n        if (!targetId || (targetId.indexOf(\"link\") === -1 && targetId.indexOf(\"node\") === -1)) return;\r\n        setHoverTarget(\"\");\r\n        setShowHoverCard(false);\r\n    }\r\n\r\n    // useEventListener(\"mouseenter\", updateHovercard, undefined, true);\r\n    // useEventListener(\"mouseleave\", hideHoverCard, undefined, true);\r\n\r\n    useEffect(() => {\r\n        setLinksUpdated(false);\r\n        setNetwork(props.network);\r\n\r\n        document.addEventListener('mouseenter', updateHovercard, true);\r\n        document.addEventListener('mouseleave', hideHoverCard, true);\r\n\r\n        return () => {\r\n            document.removeEventListener('mouseenter', updateHovercard, true);\r\n            document.removeEventListener('mouseleave', hideHoverCard, true);\r\n        }\r\n    }, [props.network, props.inputs]);\r\n\r\n\r\n    useEffect(() => {\r\n        drawAllLinks(props.network);\r\n        updateContainerBox();\r\n    }, [props.decisionBoundaries]);\r\n\r\n    useEffect(() => {\r\n        // At this point this means links are always drawn twice\r\n        drawAllLinks(props.network);\r\n    }, [containerBox]);\r\n\r\n    useEffect(() => {\r\n        if (hoverTarget !== \"\") {\r\n            if (hoverTarget.indexOf(\"link\") === -1) {\r\n                // If a node\r\n                let node = nodeId2Node(hoverTarget);\r\n                if (node) setHoverCardConfig({ type: HoverCardType.BIAS, value: node.bias });\r\n\r\n            } else {\r\n                // If a link\r\n                let link = linkId2Link(hoverTarget);\r\n                if (link) setHoverCardConfig({ type: HoverCardType.WEIGHT, value: link.weight });\r\n            }\r\n        }\r\n    }, [hoverTarget, props.decisionBoundaries]);\r\n\r\n\r\n    const drawAllLinks = (network: nn.Node[][]) => {\r\n        console.log(\"Draw Links\");\r\n        let start = Date.now();\r\n\r\n        d3.selectAll(\".link\").remove();\r\n\r\n        let node2Coord = getNodeCoords(network);\r\n        if (!node2Coord) return;\r\n\r\n        let iter = 0;\r\n        for (let layerNum = 0; layerNum < network.length; layerNum++) {\r\n            let currentLayer = network[layerNum];\r\n            for (let i = 0; i < currentLayer.length; i++) {\r\n                let node: nn.Node = currentLayer[i];\r\n                // Instead store node positions in a dictionary to reduce elementSearches and increase speed\r\n                for (let j = 0; j < node.linksOut.length; j++) {\r\n                    let link: nn.Link = node.linksOut[j];\r\n\r\n                    drawLink(link, node2Coord);\r\n\r\n                    iter++;\r\n                }\r\n\r\n            }\r\n        }\r\n\r\n        if (!labelsDrawn) drawLabels(node2Coord);\r\n\r\n        setLinksUpdated(true);\r\n        let delta = Date.now() - start;\r\n        console.log(`Finished drawing links (Links Drawn: ${iter}) (Duration: ${delta}ms)`);\r\n\r\n    }\r\n\r\n    const getNodeCoords = (network: nn.Node[][]) => {\r\n\r\n        let containerCurrent = container.current;\r\n        if (!network || !containerCurrent) return null;\r\n        let node2Coord: { [id: string]: { cx: number, cy: number } } = {}\r\n        let containerLeft = containerCurrent.offsetLeft;\r\n        let containerTop = containerCurrent.offsetTop;\r\n\r\n        for (let layerNum = 0; layerNum < network.length; layerNum++) {\r\n            let currentLayer = network[layerNum];\r\n            if (layerNum === 0) {\r\n                let iter = 0;\r\n                Object.keys(INPUTS).forEach((nodeId) => {\r\n\r\n                    let nodeElement = document.getElementById(`node-${nodeId}`);\r\n                    // Right now they aren't actually the centre\r\n                    if (nodeElement) node2Coord[nodeId] = { cx: nodeElement.offsetLeft + nodeWidth / 2, cy: nodeElement.offsetTop + nodeWidth / 2 }\r\n                })\r\n            } else {\r\n                for (let i = 0; i < currentLayer.length; i++) {\r\n                    let node: nn.Node = currentLayer[i];\r\n                    let nodeElement = document.getElementById(`node-${node.id}`);\r\n                    // Right now they aren't actually the centre\r\n                    if (nodeElement) node2Coord[node.id] = { cx: nodeElement.offsetLeft + nodeWidth / 2, cy: nodeElement.offsetTop + nodeWidth / 2 }\r\n                }\r\n            }\r\n        }\r\n        return node2Coord;\r\n    }\r\n\r\n    // Implement something so that the distributed widths are proportional to each other\r\n    // or\r\n    // Set a max width\r\n    const generateLineConfig = (link: nn.Link) => {\r\n        let weightToSize = d3.scaleLinear()\r\n            .domain([-1, 0, 1])\r\n            .range([6, 1.5, 6])\r\n            .clamp(true);\r\n        return {\r\n            color: (link.weight > 0 ? maxColour : minColour),\r\n            size: weightToSize(link.weight),\r\n        }\r\n    }\r\n\r\n    function drawLink(\r\n        input: nn.Link, node2coord: { [id: string]: { cx: number, cy: number } }) {\r\n        let line = d3.select(svgContainer.current).append(\"path\");\r\n        let source = node2coord[input.source.id];\r\n        let dest = node2coord[input.dest.id];\r\n        if (!(dest && source)) return;\r\n\r\n        // Check X and Ys are reversed properlly\r\n        let datum: any = {\r\n            source:\r\n                [source.cx + nodeWidth / 2 + 2, source.cy]\r\n            ,\r\n            target: [dest.cx - nodeWidth / 2, dest.cy]\r\n        };\r\n\r\n        let diagonal = d3.linkHorizontal()\r\n            .x(function (d: any) {\r\n                return d[0];\r\n            }).y(function (d: any) { return d[1]; })\r\n        let d = diagonal(datum);\r\n\r\n        let linkConfig = generateLineConfig(input);\r\n\r\n        d && line.attr(\"marker-start\", \"url(#markerArrow)\")\r\n            .attr(\"class\", \"link\")\r\n            .attr(\"id\", `link-${input.source.id}-${input.dest.id}`)\r\n            .attr(\"d\", d)\r\n            .attr(\"fill\", \"transparent\")\r\n            .attr(\"pointer-events\", \"all\")\r\n            .attr(\"stroke\", linkConfig.color)\r\n            .attr(\"stroke-width\", linkConfig.size || 0)\r\n            .attr(\"stroke-dasharray\", \"10,2\")\r\n            .on(\"mouseover\", function (d, i) {\r\n                d3.select(this).transition()\r\n                    .duration(100000)\r\n                    .ease(d3.easeLinear)\r\n                    .attr(\"stroke-dashoffset\", -8000)\r\n            })\r\n            .on(\"mouseout\", function (d, i) {\r\n                d3.select(this)\r\n                    .transition();\r\n            })\r\n        return line;\r\n    }\r\n\r\n    function drawLabels(node2coord: { [id: string]: { cx: number, cy: number } }) {\r\n        console.log(\"Draw Labels\");\r\n        let nodeIds = Object.keys(INPUTS);\r\n        let nodeNotDrawnYet = false;\r\n        let svg = d3.select(svgContainer.current);\r\n\r\n        svg.selectAll(\".input-label\").remove();\r\n\r\n        nodeIds.forEach((nodeId) => {\r\n            let source = node2coord[nodeId];\r\n            if (!source) {\r\n                nodeNotDrawnYet = true;\r\n                return;\r\n            }\r\n\r\n            let label = INPUTS[nodeId].label != null ? INPUTS[nodeId].label : nodeId;\r\n\r\n            let text = svg.append(\"text\")\r\n                .attr(\"class\", \"input-label\")\r\n                .attr(\"x\", source.cx - (nodeWidth / 2 + 2))\r\n                .attr(\"y\", source.cy + (nodeWidth / 4))\r\n                .attr(\"text-anchor\", \"end\")\r\n                .attr(\"alignment-baseline\", \"middle\")\r\n            if (/[_^]/.test(label)) {\r\n                let myRe = /(.*?)([_^])(.)/g;\r\n                let myArray;\r\n                let lastIndex;\r\n                while ((myArray = myRe.exec(label)) != null) {\r\n                    lastIndex = myRe.lastIndex;\r\n                    let prefix = myArray[1];\r\n                    let sep = myArray[2];\r\n                    let suffix = myArray[3];\r\n                    if (prefix) {\r\n                        text.append(\"tspan\").text(prefix);\r\n                    }\r\n                    text.append(\"tspan\")\r\n                        .attr(\"baseline-shift\", sep === \"_\" ? \"sub\" : \"super\")\r\n                        .style(\"font-size\", \"9px\")\r\n                        .text(suffix);\r\n                }\r\n                if (lastIndex && label.substring(lastIndex)) {\r\n                    text.append(\"tspan\").text(label.substring(lastIndex));\r\n                }\r\n            } else {\r\n                text.append(\"tspan\").text(label);\r\n            }\r\n\r\n        })\r\n        if (!nodeNotDrawnYet) setLabelsDrawn(true);\r\n    }\r\n\r\n    const updateContainerBox = () => {\r\n        let containerCurrent = container.current;\r\n        if (!containerCurrent) return;\r\n        // console.log(\"updating container box\");\r\n        let viewportOffset = containerCurrent.getBoundingClientRect();\r\n        // console.log(containerCurrent.offsetTop);\r\n        // console.log(viewportOffset)\r\n        setContainerBox({\r\n            left: -viewportOffset.x,\r\n            top: -viewportOffset.y,\r\n            x: viewportOffset.x,\r\n            y: viewportOffset.y,\r\n            width: viewportOffset.width,\r\n            height: viewportOffset.height\r\n        });\r\n\r\n    }\r\n\r\n    const nodeId2Node = (nodeId: string) => {\r\n        if (!props.network) return null;\r\n        let id = nodeId.substring(5);\r\n        for (let layerNum = 0; layerNum < props.network.length; layerNum++) {\r\n            for (let nodeNum = 0; nodeNum < props.network[layerNum].length; nodeNum++) {\r\n                let node = props.network[layerNum][nodeNum];\r\n                if (node.id === id) return node;\r\n            }\r\n        }\r\n    }\r\n\r\n    const linkId2Link = (linkId: string) => {\r\n        // console.log(props.network)\r\n        if (!props.network) return null;\r\n        let splitId = linkId.split(\"-\");\r\n        // console.log(splitId)\r\n        let fromNodeId = splitId[1];\r\n        let toNodeId = splitId[2];\r\n        let fromNode = nodeId2Node(\"node-\" + fromNodeId);\r\n        // console.log(fromNode)\r\n        if (!fromNode) return null;\r\n        for (let i = 0; i < fromNode.linksOut.length; i++) {\r\n            let link = fromNode.linksOut[i];\r\n            if (link.dest.id === toNodeId) return link;\r\n        }\r\n        return null;\r\n    }\r\n\r\n    return (\r\n        <>\r\n            <GridContainer style={{ overflow: \"hidden\" }} ref={container}>\r\n                <svg\r\n                    ref={svgContainer}\r\n                    width={containerBox.width}\r\n                    height={containerBox.height}\r\n                    style={{ position: \"absolute\", pointerEvents: \"none\" }}\r\n                    id={'lines-container'}\r\n                />\r\n                {!network || !linksUpdated && <FadeCanvas visible={true} width={containerBox.width} height={containerBox.height} />}\r\n                <div style={{ paddingTop: \"10px\", paddingLeft: \"30px\", display: \"flex\", flexDirection: \"column\", justifyContent: \"center\", alignItems: \"center\", gridArea: \"inputs-label\" }}>\r\n                    <Typography>Inputs</Typography>\r\n                    <StyledInfoButton title=\"Inputs Tooltip\" fontSize=\"small\" marginRight={0} marginLeft={5}>\r\n                        <React.Fragment>\r\n                            <Typography color=\"inherit\">Inputs</Typography>\r\n                            <Typography variant=\"body2\">\r\n                                The inputs determine the data that is input into the neural network from the data set.\r\n                                Each input is a function of <DefinedTerm definition={DefX1()}>X<sub>1</sub></DefinedTerm> and/or <DefinedTerm definition={DefX2()}>X<sub>2</sub></DefinedTerm>.\r\n                            </Typography>\r\n                            {/* <br /><u>Click the icon to get more information</u> */}\r\n                        </React.Fragment>\r\n                    </StyledInfoButton>\r\n                </div>\r\n                <LayerControls>\r\n                    <IconButton onClick={props.removeLayer}>\r\n                        <RemoveCircleIcon />\r\n                    </IconButton>\r\n                    <Typography> Hidden Layers: {props.config.networkShape.length - 2}</Typography>\r\n                    <IconButton onClick={props.addLayer}>\r\n                        <AddCircleIcon />\r\n                    </IconButton>\r\n                </LayerControls>\r\n                <Container style={{ gridArea: \"inputs-layer\", paddingLeft: \"60px\" }}>\r\n                    <Layer>\r\n                        {network && Object.keys(INPUTS).map(nodeId =>\r\n                            <NNNode\r\n                                id={`node-${nodeId}`}\r\n                                nodeId={nodeId}\r\n                                active={props.inputs[nodeId]}\r\n                                nodeWidth={nodeWidth}\r\n                                numCells={20}\r\n                                decisionBoundary={props.decisionBoundaries[nodeId]}\r\n                                discreetBoundary={props.discreetBoundary}\r\n                                handleOnClick={props.handleOnClick}\r\n                            />\r\n                        )}\r\n                    </Layer>\r\n                </Container>\r\n                <Container style={{ width: \"100%\", height: \"100%\", paddingLeft: \"0px\", justifyContent: \"space-around\", gridArea: \"hidden-layers\" }}>\r\n                    {network && network.slice(1, network.length - 1).map((layer, layerNum) =>\r\n                        <div style={{ display: \"flex\", flexDirection: \"column\" }}>\r\n                            <Layer style={{ flexGrow: 1 }}>\r\n                                {layer.map(node => <NNNode\r\n                                    id={`node-${node.id}`}\r\n                                    nodeWidth={nodeWidth}\r\n                                    numCells={20}\r\n                                    active={true}\r\n                                    decisionBoundary={props.decisionBoundaries[node.id]}\r\n                                    discreetBoundary={props.discreetBoundary}\r\n                                />)}\r\n                            </Layer>\r\n                            {(layerNum !== network.length - 2) && <PlusMinusButtonsContainer style={{ flexGrow: 0 }}>\r\n                                <IconButton onClick={() => props.removeNode(layerNum + 1)}>\r\n                                    <RemoveCircleIcon />\r\n                                </IconButton>\r\n                                <IconButton onClick={() => props.addNode(layerNum + 1)}>\r\n                                    <AddCircleIcon />\r\n                                </IconButton>\r\n                            </PlusMinusButtonsContainer>}\r\n                        </div>)}\r\n                </Container>\r\n                <Container style={{ width: \"100%\", height: \"100%\", paddingLeft: \"0px\", gridArea: \"output\", paddingRight: \"10px\" }}>\r\n                    {network && network.slice(network.length - 1).map((layer, layerNum) =>\r\n                        <div style={{ display: \"flex\", flexDirection: \"column\" }}>\r\n                            <Layer style={{ flexGrow: 1 }}>\r\n                                {layer.map(node => <NNNode\r\n                                    id={`node-${node.id}`}\r\n                                    nodeWidth={nodeWidth}\r\n                                    numCells={20}\r\n                                    active={true}\r\n                                    decisionBoundary={props.decisionBoundaries[node.id]}\r\n                                    discreetBoundary={props.discreetBoundary}\r\n                                />)}\r\n                            </Layer>\r\n                        </div>)}\r\n                </Container>\r\n                {/* <svg\r\n                    ref={svgContainer}\r\n                    width={containerBox.width}\r\n                    height={containerBox.height}\r\n                    style={{ position: \"absolute\", pointerEvents: \"none\" }}\r\n                    id={'lines-container'}\r\n                    className={\"testg\"}\r\n                /> */}\r\n            </GridContainer>\r\n            <MouseTooltip\r\n                visible={showHoverCard}\r\n                // offsetX={containerBox.left}\r\n                // offsetY={containerBox.top}\r\n                style={{ /* position: \"absolute\"  ,*/ pointerEvents: \"none\" }}\r\n            >\r\n                <HoverCard>\r\n                    {(hoverCardConfig.type === HoverCardType.WEIGHT) && <p>Weight: {hoverCardConfig.value.toFixed(3)}</p>}\r\n                    {(hoverCardConfig.type === HoverCardType.BIAS) && <p>Bias: {hoverCardConfig.value.toFixed(3)}</p>}\r\n                </HoverCard>\r\n            </MouseTooltip>\r\n        </>\r\n    );\r\n}\r\n\r\nexport default NeuralNetworkVis;","import React from \"react\";\r\nimport { NNConfig } from \"../../NetworkController\";\r\n\r\nfunction LossInfoPanel(props: NNConfig) {\r\n\r\n    return (\r\n        <div>\r\n            <h1>Loss</h1>\r\n            <p></p>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default LossInfoPanel;","import * as  d3 from \"d3\";\r\nimport React, { useEffect, useRef, useState } from \"react\";\r\n\r\ninterface ColourScaleProps {\r\n    width: number;\r\n    height: number;\r\n    minColour: string;\r\n    midColour: string;\r\n    maxColour: string;\r\n    minValue: number;\r\n    midValue: number;\r\n    maxValue: number;\r\n    numShades: number;\r\n    horizontal: boolean;\r\n}\r\n\r\nfunction ColourScale(props: ColourScaleProps) {\r\n\r\n    const d3ContainerRef: any = useRef<any>(null);\r\n    const canvasRef: any = useRef<any>(null);\r\n\r\n    const marginTop = 4;\r\n    const marginLeft = props.horizontal ? 8 : 20;\r\n    const marginBottom = props.horizontal ? 20 : 4;\r\n    const marginRight = 8;\r\n\r\n    useEffect(() => {\r\n        createScale();\r\n    }, [])\r\n\r\n    const createScale = () => {\r\n        const svg = d3.select(d3ContainerRef.current)\r\n            .attr(\"width\", props.width + marginLeft + marginRight)\r\n            .attr(\"height\", props.height + marginBottom + marginTop);\r\n\r\n        svg.selectAll(\"*\").remove();\r\n\r\n        const scale = d3.scaleLinear()\r\n            .domain([-1, 1])\r\n            .range(props.horizontal ? [0, props.width -1] : [props.height -1, 0]);\r\n\r\n        const colourScale = svg.append(\"g\")\r\n            .attr(\"transform\", `translate(${marginLeft}, ${marginTop})`);\r\n\r\n        colourScale.append(\"g\")\r\n            .attr(\"transform\", `translate(0,${props.horizontal ? props.height : 0})`)\r\n            .call((props.horizontal ? d3.axisBottom(scale) : d3.axisLeft(scale)).tickValues([0].concat(scale.ticks(2))).tickSize(3));\r\n\r\n        let tmpScale = d3.scaleLinear<string, number>()\r\n            .domain([0, 0.5, 1])\r\n            .range([props.minColour, props.midColour, props.maxColour])\r\n            .clamp(true);\r\n\r\n        let numShades = props.numShades || 100;\r\n\r\n        let colors = d3.range(0, 1 + 1E-9, 1 / numShades).map(a => {\r\n            return tmpScale(a) || 0;\r\n        });\r\n\r\n        let color: any = d3.scaleQuantize()\r\n            .domain(props.horizontal ? [0,props.width] : [0, props.height])\r\n            .range(colors);\r\n\r\n        const canvas = canvasRef.current;\r\n        const context = canvas?.getContext(\"2d\");\r\n        if (!context) return;\r\n        let imageWidth = props.horizontal ? props.width : 1;\r\n        let imageHeight = props.horizontal ? 1 : props.height;\r\n        let imageData = context.createImageData(imageWidth, imageHeight);\r\n\r\n        if (!imageData) return;\r\n\r\n        const data = imageData.data;\r\n        let iter = -1;\r\n\r\n        for (let i = (props.horizontal ? 0 : props.height); props.horizontal ? i <= props.width : i >= 0; props.horizontal ? i++ : i--) {\r\n            // let value: number = props.decisionBoundary[i];\r\n            // if(props.discreetBoundary) value = value > 0 ? 1 : -1;\r\n            let c = d3.rgb(color(i));\r\n            data[++iter] = c.r;\r\n            data[++iter] = c.g;\r\n            data[++iter] = c.b;\r\n            data[++iter] = 200;\r\n        }\r\n        context.putImageData(imageData, 0, 0);\r\n\r\n        colourScale.select(\".domain\")\r\n            .attr(\"opacity\", \"0\");\r\n        \r\n        // let delta = Date.now() - start;\r\n    }\r\n\r\n\r\n    return (\r\n        <div style={{ position: \"relative\" }}>\r\n            <svg\r\n                ref={d3ContainerRef}\r\n                width={props.width + marginLeft}\r\n                height={props.height + marginBottom + marginTop}\r\n                style={{ position: \"absolute\" }}\r\n            />\r\n            <canvas\r\n                ref={canvasRef}\r\n                // id={props.id}\r\n                // className=\"background\"\r\n                width={props.horizontal ? props.width : 1}\r\n                height={props.horizontal ? 1 : props.height}\r\n                style={{\r\n                    width: `${props.width}px`,\r\n                    height: `${props.height}px`,\r\n                    paddingLeft: `${marginLeft}px`,\r\n                    paddingTop: `${marginTop}px`,\r\n                    paddingRight: `${marginRight}px`,\r\n                    paddingBottom: `${marginBottom}px`,\r\n                    // paddingRight: `${props.padding && props.paddingRight ? props.paddingRight : \"0\"}px`,\r\n                    // paddingTop: `${props.padding && props.paddingTop ? props.paddingTop: \"0\"}px`,\r\n                    // paddingBottom: `${props.padding && props.paddingBottom ? props.paddingBottom : \"0\"}px`,\r\n                }}\r\n            />\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default ColourScale;","import { ThreeDRotationSharp } from \"@material-ui/icons\";\r\nimport { useEffect, useState } from \"react\";\r\nimport { Dataset, Datapoint2D, DatasetGenerator } from \"./datasets\";\r\nimport * as nn from \"./NeuralNet\";\r\nimport * as vis from \"./visControl\";\r\n\r\ninterface InputFunc {\r\n    f: (x: number, y: number) => number;\r\n    label: string;\r\n}\r\n\r\nlet ACTIVATIONS: { [name: string]: nn.ActivationFunction } = {\r\n    \"Tanh\": nn.Activations.TANH,\r\n    \"ReLU\": nn.Activations.RELU,\r\n    \"Sigmoid\": nn.Activations.SIGMOID,\r\n}\r\n\r\nlet GENERATORS: { [datasetType: string]: DatasetGenerator } = {\r\n    \"Gaussian2\": Dataset.GAUSSIAN_2,\r\n    \"Gaussian3\": Dataset.GAUSSIAN_3,\r\n    \"XOR\": Dataset.XOR,\r\n}\r\n\r\n\r\nexport let INPUTS: { [name: string]: InputFunc } = {\r\n    \"x\": { f: (x, y) => x, label: \"X_1\" },\r\n    \"y\": { f: (x, y) => y, label: \"X_2\" },\r\n    \"xSquared\": { f: (x, y) => x * x, label: \"X_1^2\" },\r\n    \"ySquared\": { f: (x, y) => y * y, label: \"X_2^2\" },\r\n    \"xTimesY\": { f: (x, y) => x * y, label: \"X_1X_2\" },\r\n    \"sinX\": { f: (x, y) => Math.sin(x), label: \"sin(X_1)\" },\r\n    \"sinY\": { f: (x, y) => Math.sin(y), label: \"sin(X_2)\" },\r\n};\r\n\r\n\r\n/** Stores network and network configuration state and actions. */\r\nexport interface NNConfig {\r\n    networkShape: number[];\r\n    activationFunction: string;\r\n    learningRate: number;\r\n    inputs: { [key: string]: boolean };\r\n    batchSize: number;\r\n    noise: number;\r\n    datasetType: string;\r\n    // dataset: Datapoint2D[];\r\n    // decisionBoundaries: { [nodeId: string]: number[] };\r\n    // decisionBoundary: number[];\r\n    // loss: number;\r\n    // epochs: number;\r\n    // lossData: [number, number][]; // Maybe loss data shouldn't be dealt with inside of NetworkController (Maybe have a whole data storage and analysis class/controller)\r\n    numSamples: number;\r\n}\r\n\r\n// Maybe there should only be one input \r\n// Maybe rename or split this up differently\r\n// Or split this up into properties that are needed to define a network and ones that are generated by the network\r\nexport interface NetworkState {\r\n    noise: number;\r\n    datasetType: string;\r\n    dataset: Datapoint2D[];\r\n    config: NNConfig;\r\n    decisionBoundaries: { [nodeId: string]: number[] };\r\n    decisionBoundary: number[];\r\n    loss: number;\r\n    epochs: number;\r\n    lossData: [number, number][];\r\n}\r\n\r\n// Maybe each saved state should have it's own controller\r\n\r\n// export class NetworkController {\r\n\r\n//     network: nn.Node[][];\r\n//     dataset: Datapoint2D[];\r\n\r\n//     // Maybe instead extract config for easier access\r\n//     // config: NNConfig;\r\n\r\n//     compareMode: boolean;\r\n\r\n//     trainingData: Datapoint2D[];\r\n//     testData: Datapoint2D[];\r\n\r\n//     networkShape: number[];\r\n//     activationFunction: string;\r\n//     learningRate: number;\r\n//     inputs: { [key: string]: boolean };\r\n//     batchSize: number;\r\n//     noise: number;\r\n//     datasetType: string;\r\n//     // dataset: Datapoint2D[];\r\n//     decisionBoundaries: { [nodeId: string]: number[] };\r\n//     decisionBoundary: number[];\r\n//     loss: number;\r\n//     epochs: number;\r\n//     lossData: [number, number][]; // Maybe loss data shouldn't be dealt with inside of NetworkController (Maybe have a whole data storage and analysis class/controller)\r\n//     numSamples: number;\r\n\r\n//     // REFACTOR: Maybe split this up differently\r\n//     // networkProperties: NetworkState;\r\n\r\n//     // constructor(config: NNConfig/* , temp: NetworkController */) {\r\n//     //     console.log(\"Constructing NetworkController\");\r\n//     //     this.config = config;\r\n//     //     /* networkProperties = temp; */\r\n//     //     this.network = nn.generateNetwork(config.networkShape, ACTIVATIONS[config.activationFunction], nn.Activations.TANH, config.inputs);\r\n//     //     this.dataset = this.getDataset(config.datasetType, config.numSamples, config.noise);\r\n//     //     [this.trainingData, this.testData] = this.splitDataset(this.dataset);\r\n\r\n//     //     this.compareMode = false;\r\n\r\n//     //     console.log(this.network);\r\n//     //     // this.generateNetwork();\r\n//     // }\r\n\r\n//     constructor(config: NNConfig/* , temp: NetworkController */) {\r\n//         console.log(\"Constructing NetworkController\");\r\n\r\n//         this.networkShape = config.networkShape;\r\n//         this.activationFunction = config.activationFunction;\r\n//         this.learningRate = config.learningRate;\r\n//         this.inputs = config.inputs;\r\n//         this.batchSize = config.batchSize;\r\n//         this.noise = config.noise;\r\n//         this.datasetType = config.datasetType;\r\n//         // this.decisionBoundaries = config.decisionBoundaries;\r\n//         // this.decisionBoundary = config.decisionBoundary;\r\n//         // this.loss = config.loss;\r\n//         // this.epochs = config.epochs;\r\n//         // this.lossData = config.lossData;\r\n//         this.numSamples = config.numSamples;\r\n//         // remove all constant default values (e.g. loss will always default to 0)\r\n\r\n//         this.network = nn.generateNetwork(this.networkShape, ACTIVATIONS[this.activationFunction], nn.Activations.TANH, this.inputs);\r\n//         this.dataset = this.getDataset(this.datasetType, this.numSamples, this.noise);\r\n//         [this.trainingData, this.testData] = this.splitDataset(this.dataset);\r\n\r\n//         this.decisionBoundaries = {};\r\n//         this.decisionBoundary = [];\r\n//         this.loss = 0;\r\n//         this.epochs = 0;\r\n//         this.lossData = [];\r\n//         this.compareMode = false;\r\n\r\n//         console.log(this.network);\r\n//         // this.generateNetwork();\r\n//     }\r\n\r\n//     // export function start(config: NNConfig): nn.Node[][] {\r\n//     //     let network = nn.generateNetwork(config.networkShape, ACTIVATIONS[config.activationFunction], nn.Activations.TANH, config.inputs);\r\n//     //     console.log(network);\r\n\r\n//     //     return network;\r\n//     // }\r\n\r\n//     private getDataset(datasetType: string, numSamples: number, noise: number) {\r\n//         let datasetGenerator = GENERATORS[datasetType];\r\n//         let dataset = datasetGenerator(numSamples, noise);\r\n//         // console.log(dataset);\r\n//         return dataset;\r\n//     }\r\n\r\n//     private constructInputs(x: number, y: number, inputs: { [key: string]: boolean }): number[] {\r\n//         let constructedInputs: number[] = [];\r\n//         for (let inputName in INPUTS) {\r\n//             if (inputs[inputName]) constructedInputs.push(INPUTS[inputName].f(x, y))\r\n//         }\r\n//         // console.log(\"X:\" + x + \" Y:\"+ y)\r\n//         // console.log(constructedInputs)\r\n//         return constructedInputs;\r\n//     }\r\n\r\n//     private splitDataset(dataset: Datapoint2D[]) {\r\n//         let testDataIndex = Math.floor(dataset.length * 0.8);\r\n//         let trainingData = dataset.slice(0, testDataIndex);\r\n//         let testData = dataset.slice(testDataIndex, dataset.length);\r\n//         return [trainingData, testData];\r\n//     }\r\n\r\n//     //    step(network: nn.Node[][], trainingData: Datapoint2D[], learningRate: number, inputs: { [key: string]: boolean }, batchSize: number): void {\r\n//     //         for (let i = 0; i < trainingData.length; i++) {\r\n//     //             let sample = trainingData[i];\r\n//     //             nn.forwardPropagate(network, constructInputs(sample.x1, sample.x2, inputs));\r\n//     //             nn.backPropagate(network, nn.Costs.SQUARE, sample.y);\r\n//     //             if ((i + 1) % batchSize === 0) nn.train(network, learningRate);\r\n//     //         }\r\n\r\n//     //     }\r\n\r\n//     //\r\n//     step(): void {\r\n//         for (let i = 0; i < this.trainingData.length; i++) {\r\n//             let sample = this.trainingData[i];\r\n//             nn.forwardPropagate(this.network, this.constructInputs(sample.x1, sample.x2, this.inputs));\r\n//             nn.backPropagate(this.network, nn.Costs.SQUARE, sample.y);\r\n//             if ((i + 1) % this.batchSize === 0) nn.train(this.network, this.learningRate); // Passing by reference/value here might cause issues\r\n//         }\r\n//     }\r\n\r\n//     // getCost(network: nn.Node[][], data: Datapoint2D[], inputs: { [key: string]: boolean }/* , costFunction: nn.CostFunction */): number {\r\n//     //     let totalCost = 0;\r\n//     //     for (let i = 0; i < data.length; i++) {\r\n//     //         let dataPoint = data[i];\r\n//     //         totalCost += nn.Costs.SQUARE.cost(nn.forwardPropagate(network, constructInputs(dataPoint.x1, dataPoint.x2, inputs)), dataPoint.y);\r\n//     //     }\r\n\r\n//     //     return totalCost / data.length;\r\n//     // }\r\n\r\n//     // Maybe this should be private\r\n//     getCost(dataset: Datapoint2D[]): number {\r\n//         let totalCost = 0;\r\n//         for (let i = 0; i < dataset.length; i++) {\r\n//             let dataPoint = dataset[i];\r\n//             totalCost += nn.Costs.SQUARE.cost(nn.forwardPropagate(this.network, this.constructInputs(dataPoint.x1, dataPoint.x2, this.inputs)), dataPoint.y);\r\n//         }\r\n//         return totalCost / dataset.length;\r\n//     }\r\n\r\n//     // Careful about each of these changes inside the function triggering useEffect multiple times\r\n//     // Could be fixed if I find a pass by value implementation\r\n//     addLayer(): void {\r\n//         console.log(\"Running addLayer\");\r\n//         if (this.networkShape.length < 6) { // Maybe make constants for these constant values (magic numbers)\r\n//             let networkShape = this.networkShape;\r\n//             networkShape.pop();\r\n//             networkShape.push(networkShape[networkShape.length - 1]);\r\n//             networkShape.push(1);\r\n//             // console.log(networkShape);\r\n//             this.networkShape = networkShape;\r\n//         }\r\n//     }\r\n\r\n//     removeLayer(): void {\r\n//         console.log(\"Running removeLayer\");\r\n//         if (this.networkShape.length > 2) {\r\n//             let networkShape = this.networkShape;\r\n//             networkShape.pop();\r\n//             networkShape.pop();\r\n//             networkShape.push(1);\r\n//             // console.log(newNetworkShape);\r\n//             this.networkShape = networkShape;\r\n//         }\r\n//     }\r\n\r\n\r\n\r\n//     addNode(layerNum: number): void {\r\n//         console.log(\"Running addNode\");\r\n//         if (this.networkShape[layerNum] < 5) this.networkShape[layerNum] = this.networkShape[layerNum] + 1;\r\n//     }\r\n\r\n//     removeNode(layerNum: number): void {\r\n//         console.log(\"Running removeNode\");\r\n//         if (this.networkShape[layerNum] > 1) this.networkShape[layerNum] = this.networkShape[layerNum] - 1;\r\n//     }\r\n\r\n//     // export function copyNetwork(network: nn.Node[][]): nn.Node[][] {\r\n//     //     return nn.copyNetwork(network);\r\n//     // }\r\n\r\n//     // export function getOutputDecisionBoundary(network: nn.Node[][], density: number, xDomain: number[], yDomain: number[], inputs: { [key: string]: boolean }): Datapoint2D[] {\r\n\r\n//     //     let xScale = d3.scaleLinear().domain([0, density]).range(xDomain);\r\n//     //     let yScale = d3.scaleLinear().domain([density, 0]).range(yDomain);\r\n//     //     let boundary: Datapoint2D[] = [];\r\n\r\n//     //     for (let i = 0; i < density; i++) {\r\n//     //         for (let j = 0; j < density; j++) {\r\n//     //             let x = xScale(j);\r\n//     //             let y = yScale(i);\r\n\r\n//     //             let input = constructInputs(x || 0, y || 0, inputs);\r\n//     //             nn.forwardPropagate(network, input);\r\n\r\n//     //             let dataPoint: Datapoint2D = { x1: x || 0, x2: y || 0, y: nn.getOutputNode(network).output }\r\n\r\n//     //             boundary.push(dataPoint);\r\n//     //         }\r\n//     //     }\r\n\r\n//     //     return boundary;\r\n//     // }\r\n\r\n//     // Maybe this should be private and replace get with generate\r\n//     // getOutputDecisionBoundary(): Datapoint2D[] {\r\n\r\n//     //     let xScale = d3.scaleLinear().domain([0, density]).range(xDomain);\r\n//     //     let yScale = d3.scaleLinear().domain([density, 0]).range(yDomain);\r\n//     //     let boundary: Datapoint2D[] = [];\r\n\r\n//     //     for (let i = 0; i < density; i++) {\r\n//     //         for (let j = 0; j < density; j++) {\r\n//     //             let x = xScale(j);\r\n//     //             let y = yScale(i);\r\n\r\n//     //             let input = constructInputs(x || 0, y || 0, inputs);\r\n//     //             nn.forwardPropagate(network, input);\r\n\r\n//     //             let dataPoint: Datapoint2D = { x1: x || 0, x2: y || 0, y: nn.getOutputNode(network).output }\r\n\r\n//     //             boundary.push(dataPoint);\r\n//     //         }\r\n//     //     }\r\n\r\n\r\n//     //     return boundary;\r\n//     // }\r\n\r\n//     // export function getOutputDecisionBoundary1D(network: nn.Node[][], density: number, xDomain: number[], yDomain: number[], inputs: { [key: string]: boolean }): number[] {\r\n\r\n//     //     let xScale = d3.scaleLinear().domain([0, density]).range(xDomain);\r\n//     //     let yScale = d3.scaleLinear().domain([density, 0]).range(yDomain);\r\n//     //     let boundary: number[] = [];\r\n//     //     let iter = 0;\r\n\r\n//     //     for (let i = 0; i < density; i++) {\r\n//     //         for (let j = 0; j < density; j++) {\r\n//     //             let x = xScale(j);\r\n//     //             let y = yScale(i);\r\n\r\n//     //             let input = constructInputs(x || 0, y || 0, inputs);\r\n//     //             nn.forwardPropagate(network, input);\r\n\r\n//     //             boundary[iter++] = nn.getOutputNode(network).output;\r\n//     //         }\r\n//     //     }\r\n\r\n//     //     return boundary;\r\n//     // }\r\n\r\n//     // export function getAllDecisionBoundaries(network: nn.Node[][], density: number, xDomain: number[], yDomain: number[], inputs: { [key: string]: boolean }): { [nodeId: string]: number[] } {\r\n//     //     let boundaries: { [nodeId: string]: number[] } = {};\r\n\r\n//     //     let xScale = d3.scaleLinear().domain([0, density]).range(xDomain);\r\n//     //     let yScale = d3.scaleLinear().domain([density, 0]).range(yDomain);\r\n//     //     let iter = 0;\r\n\r\n//     //     let inputNodeIds = Object.keys(INPUTS);\r\n\r\n//     //     for (let i = 0; i < density; i++) {\r\n//     //         for (let j = 0; j < density; j++) {\r\n//     //             let x = xScale(j);\r\n//     //             let y = yScale(i);\r\n\r\n//     //             let input = constructInputs(x || 0, y || 0, inputs);\r\n//     //             nn.forwardPropagate(network, input);\r\n//     //             nn.forEachNode(network, (node: nn.Node) => {\r\n//     //                 if (!boundaries[node.id]) boundaries[node.id] = [];\r\n//     //                 boundaries[node.id][iter] = node.output;\r\n//     //             })\r\n//     //             inputNodeIds.forEach((nodeId) => {\r\n//     //                 if (!boundaries[nodeId]) boundaries[nodeId] = [];\r\n//     //                 boundaries[nodeId][iter] = INPUTS[nodeId].f(x || 0, y || 0);\r\n//     //             })\r\n//     //             iter++;\r\n//     //             //boundary[iter++] = nn.getOutputNode(network).output;\r\n//     //         }\r\n//     //     }\r\n\r\n//     //     return boundaries;\r\n\r\n//     // }\r\n\r\n\r\n\r\n//     generateNetwork(): void {\r\n//         // this.net\r\n//     }\r\n\r\n//     generateDataset(): void {\r\n\r\n//     }\r\n\r\n//     reset(): void {\r\n//         this.network = nn.generateNetwork(this.networkShape, ACTIVATIONS[this.activationFunction], nn.Activations.TANH, this.inputs);\r\n//         this.dataset = this.getDataset(this.datasetType, this.numSamples, this.noise);\r\n//         [this.trainingData, this.testData] = this.splitDataset(this.dataset);\r\n//     }\r\n\r\n\r\n// }\r\n\r\n// function useNetworkController(defaultData) {\r\n//     const [networkController, setNetworkController] = useState<NetworkController>(defaultData);\r\n\r\n//     const addNode = () => {\r\n//         setNetworkController(())\r\n//     }\r\n\r\n//     return {\r\n//         config,\r\n//         addNode,\r\n//     }\r\n// }\r\n\r\n\r\n//Change NNConfig to NetworkConfig or NetworkState to NNState\r\nexport interface NNState {\r\n    compareMode: boolean;\r\n    decisionBoundaries: { [nodeId: string]: number[] };\r\n    decisionBoundary: number[];\r\n}\r\n\r\nconst defaultNetworkData = {\r\n    networkShape: [2, 2, 2, 1],\r\n    activationFunction: \"Tanh\",\r\n    learningRate: 0.03,\r\n    inputs: {\r\n        \"x\": true,\r\n        \"y\": true,\r\n        \"xSquared\": false,\r\n        \"ySquared\": false,\r\n        \"xTimesY\": false,\r\n        \"sinX\": false,\r\n        \"sinY\": false\r\n    },\r\n    batchSize: 10,\r\n    datasetType: \"Gaussian2\",\r\n    numSamples: 100,\r\n    noise: 0.2\r\n};\r\n\r\nconst defaultNetworkState = {\r\n    compareMode: false,\r\n    decisionBoundaries: {}, // Maybe remove decision boundary stuff outside of useNetwork\r\n    decisionBoundary: []\r\n}\r\n\r\n// GAME PLAN\r\n// - INSTEAD JUST COPY AND PASTE ALL NN FUNCTIONALITY FROM MAINPAGE TO NEW USENETWORK HOOK\r\n// - CREATE THE HOOK IN THE APP AND PUT IT INTO A CONTEXT SO THAT ONLY NECESSARY FUNCTIONS HAVE TO BE MANUALLY PASSED DOWN THE COMPONENT TREE\r\n// - REFACTOR MAIN PAGE SO THAT EACH PANEL IN THE GRID IS IT'S OWN COMPONENT\r\n// - USE USETRACKED TO ACCESS CONTEXT IN EACH CHILD COMPONENT\r\n// - CUSTOM HOOK JUST FOR CONFIG\r\n\r\n\r\n// Maybe remove dataset related stuff from this\r\nexport function useNetwork(\r\n    defaultData: NNConfig = defaultNetworkData,\r\n    defaultState: NNState = defaultNetworkState\r\n) {\r\n    const [nnConfig, setNNConfig] = useState<NNConfig>(defaultData);\r\n    const [network, setNetwork] = useState<nn.Node[][]>();\r\n    const [state, setState] = useState<NNState>(defaultState); // Maybe refactor to networkState or something else\r\n    const [init, setInit] = useState<boolean>(false);\r\n\r\n    // useEffect(() => {\r\n    //     setConfig(defaultData);\r\n    //     setState()\r\n    // }, []);\r\n\r\n    useEffect(() => {\r\n        console.log(\"Config change useEffect\");\r\n        // if (training) toggleAutoTrain();\r\n        // setState(defaultState);\r\n        reset();\r\n        // generateNetwork();\r\n        // generateDataset();\r\n    }, [nnConfig]);\r\n\r\n\r\n\r\n    // useEffect(() => {\r\n    //     setNetworkController(new NetworkController(config));\r\n    // }, [config]);\r\n\r\n    // useEffect(() => {\r\n    //     updateDecisionBoundary();\r\n    // }, [decisionBoundaries]);\r\n\r\n    // useEffect(() => {\r\n    //     console.log(\"Config change useEffect\");\r\n    //     updateDecisionBoundaries();\r\n    // }, [network]);\r\n\r\n    // const updateDecisionBoundaries = () => {\r\n    //     // console.log(\"Updating decision boundaries\");\r\n    //     if (network) {\r\n    //         // Don't like numcells having to be the same\r\n    //         setDecisionBoundaries(vis.getAllDecisionBoundaries(network, 20, props.xDomain, props.yDomain, config.inputs));\r\n    //         dataset && setLoss(vis.getCost(network, dataset, config.inputs));\r\n    //     }\r\n    // }\r\n\r\n    // const updateDecisionBoundary = () => {\r\n    //     // console.log(\"Updating decision boundary\");\r\n    //     network && setDecisionBoundary(vis.getOutputDecisionBoundary1D(network, props.numCells, props.xDomain, props.yDomain, config.inputs));\r\n    // }\r\n\r\n\r\n    // const generateDataset = () => {\r\n    //     console.log(\"Generating dataset\");\r\n    //     setDataset(vis.getDataset(datasetType, numSamples, noise));\r\n    // }\r\n\r\n    const generateNetwork = () => {\r\n        console.log(\"Generating network\");\r\n\r\n        setNetwork(vis.start(nnConfig)); // maybe move this from vis into network controller\r\n\r\n        // if (!state.compareMode) {\r\n        //     let newNetwork = vis.start(config);\r\n        //     setNetwork(newNetwork);\r\n        //     let newNetworkCopy = vis.copyNetwork(newNetwork);\r\n        //     console.log(newNetworkCopy);\r\n        //     setNetworkOriginalState(newNetworkCopy);\r\n        // } else {\r\n        //     console.log(\"Loading network original state\");\r\n        //     if (networkOriginalState) {\r\n        //         console.log(networkOriginalState);\r\n        //         setNetwork(vis.copyNetwork(networkOriginalState));\r\n        //     }\r\n        // }\r\n        // setEpochs(0);\r\n        // setLossData([]);\r\n    }\r\n\r\n    const setActivationFunction = (activationFunction: string) => {\r\n        setNNConfig((prev) => ({ ...prev, activationFunction: activationFunction }));\r\n    }\r\n\r\n    const setLearningRate = (learningRate: number) => {\r\n        setNNConfig((prev) => ({ ...prev, learningRate: learningRate }));\r\n    }\r\n\r\n    // const setInputs = ()\r\n\r\n    const setBatchSize = ((batchSize: number) => {\r\n        setNNConfig((prev) => ({ ...prev, batchSize: batchSize }));\r\n    })\r\n\r\n    const toggleInputNode = (nodeId: string, active: boolean) => {\r\n        setNNConfig((prevConfig) => {\r\n            let inputs = prevConfig.inputs;\r\n            let networkShape = prevConfig.networkShape;\r\n\r\n            if (active) {\r\n                let noActiveNodes = 0;\r\n                Object.keys(nnConfig.inputs).forEach((inputId) => { if (nnConfig.inputs[inputId]) noActiveNodes++; });\r\n                if (noActiveNodes > 1) {\r\n                    inputs[nodeId] = false;\r\n                    networkShape[0] = networkShape[0] - 1;\r\n                } else {\r\n                    return prevConfig;\r\n                }\r\n            } else {\r\n                inputs[nodeId] = true;\r\n                networkShape[0] = networkShape[0] + 1;\r\n            }\r\n\r\n            return { ...prevConfig, inputs: inputs, networkShape: networkShape };\r\n        });\r\n    }\r\n\r\n\r\n    const addNode = (layerNum: number) => {\r\n        console.log(\"Running addNode\");\r\n        setNNConfig((prevConfig) => {\r\n            let newNetworkShape = prevConfig.networkShape;\r\n            if (prevConfig.networkShape[layerNum] < 5) {\r\n                let newNetworkShape = prevConfig.networkShape;\r\n                newNetworkShape[layerNum] = prevConfig.networkShape[layerNum] + 1;\r\n                // setConfig({ ...config, networkShape: newNetworkShape });\r\n            }\r\n            //return {...data, networkShape: newNetworkShape};\r\n            return { ...prevConfig, networkShape: newNetworkShape };\r\n        });\r\n    }\r\n\r\n    const removeNode = (layerNum: number) => {\r\n        console.log(\"Running removeNode\");\r\n        setNNConfig((prevConfig) => {\r\n            if (nnConfig.networkShape[layerNum] > 1) {\r\n                prevConfig.networkShape[layerNum] = prevConfig.networkShape[layerNum] - 1;\r\n                // setConfig({ ...config, networkShape: newNetworkShape });\r\n            }\r\n            return { ...prevConfig, networkShape: prevConfig.networkShape }; // Probably only remove node or add node will work\r\n        });\r\n    }\r\n\r\n    const addLayer = () => {\r\n        console.log(\"Running addLayer\");\r\n        setNNConfig((prevConfig) => {\r\n            let newNetworkShape = prevConfig.networkShape;\r\n            if (newNetworkShape.length < 6) {\r\n                newNetworkShape.pop();\r\n                newNetworkShape.push(newNetworkShape[newNetworkShape.length - 1]);\r\n                newNetworkShape.push(1);\r\n                // console.log(newNetworkShape);\r\n                // setConfig({ ...config, networkShape: newNetworkShape });\r\n            }\r\n            return { ...prevConfig, networkShape: newNetworkShape };\r\n        });\r\n    }\r\n\r\n    const removeLayer = () => {\r\n        console.log(\"Running removeLayer\");\r\n        setNNConfig((prevConfig) => {\r\n            let newNetworkShape = prevConfig.networkShape;\r\n            if (newNetworkShape.length > 2) {\r\n                newNetworkShape.pop();\r\n                newNetworkShape.pop();\r\n                newNetworkShape.push(1);\r\n                // console.log(newNetworkShape);\r\n                // setConfig({ ...config, networkShape: newNetworkShape });\r\n            }\r\n            return { ...prevConfig, networkShape: newNetworkShape };\r\n        });\r\n    }\r\n\r\n    // Might not work because config values aren't aquired from setConfig function call\r\n    const step = (dataset: Datapoint2D[]) => {\r\n        setNetwork((prevNetwork) => {\r\n            console.log(\"Running step insid netowrk controller\")\r\n            console.log(prevNetwork)\r\n            if (prevNetwork) {\r\n                console.log(\"here\");\r\n                return vis.step(prevNetwork, dataset, nnConfig.learningRate, nnConfig.inputs, nnConfig.batchSize); // maybe move step from vis to here\r\n                // let network = vis.step(prevNetwork, dataset, config.learningRate, config.inputs, config.batchSize)\r\n                // return [...network];\r\n            } else {\r\n                return prevNetwork;\r\n            }\r\n        });\r\n    }\r\n\r\n    const reset = () => {\r\n        generateNetwork();\r\n        // setState((prevState) => ({ ...defaultNetworkState, compareMode: prevState.compareMode }));\r\n    }\r\n\r\n    return {\r\n        nnConfig,\r\n        state,\r\n        network,\r\n        setActivationFunction,\r\n        setLearningRate,\r\n        // setInputs,\r\n        setBatchSize,\r\n        step,\r\n        reset,\r\n        toggleInputNode,\r\n        addNode,\r\n        removeNode,\r\n        addLayer,\r\n        removeLayer,\r\n        // discreet\r\n    }\r\n}","import React, { useContext, useRef } from \"react\";\r\nimport { NNConfig } from \"../../NetworkController\";\r\nimport positiveLink from \"../../PositiveLink.png\";\r\nimport negativeLink from \"../../NegativeLink.png\";\r\nimport { ThemeContext } from \"../../contexts/ThemeContext\";\r\n\r\nfunction DefaultInfoPanel() {\r\n    // const linkSvgContainer: any = useRef<any>(null);\r\n    // const drawDemoLink = () => {\r\n\r\n    // }\r\n    const { minColourName, maxColourName } = useContext(ThemeContext);\r\n\r\n    return (\r\n        <div>\r\n            <h1>How To Get Started</h1>\r\n            <p>This is a tool that lets you play with a simple neural network implementation. Below are instructions on how to get started designing your own neural network and test it's performance.</p>\r\n            <h2>Neural Network</h2>\r\n            <h3>Links</h3>\r\n            {/* Maths font w? */}\r\n            {/* Defined Term or google link for Gradient Decent*/}\r\n            <p>Links (or edges) connect neurons in adjacent layers, each link has a weight value w that is updated by training the network using Gradient Decent.</p>\r\n            {/* <svg\r\n                ref={linkSvgContainer}\r\n                width={100}\r\n                height={40}\r\n                style={{pointerEvents: \"none\" }}\r\n                // id={'lines-container'}\r\n            /> */}\r\n            <h4>Magnitude</h4>\r\n            <p>The width of a link corresponds to the absolute magnitude of it's weight. Wider links have greater absolute weight values (and therefore have a stronger influence in the destination node) than narrower links.</p>\r\n            <h4>Positive Value Link</h4>\r\n            <img src={positiveLink} alt=\"Positive link\" width={100}/>\r\n            <p>Links with a weight value &gt; 0 are {maxColourName}.</p>\r\n            <h4>Negative Value Link</h4>\r\n            <img src={negativeLink} alt=\"Negative link\" width={100}/>\r\n            <p>Links with a weight value &lt; 0 are {minColourName}.</p>\r\n            <ul>\r\n                <li>Fix history functionality</li>\r\n                <li>Node representation</li>\r\n                <li>Link representation</li>\r\n                <li>Inputs</li>\r\n                <li>Data set</li>\r\n                <li>Building network</li>\r\n                <li>Training</li>\r\n                <li>Comparision func</li>\r\n                <li>Tool tips</li>\r\n            </ul>\r\n            <p></p>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default DefaultInfoPanel;","export default \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAT8AAAA1CAYAAAA3Sux5AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAFtSURBVHhe7d2xTcNAGIbhM5sABQxCzwxQwAZhBtgACmaAGragIUVAyiLGRieBrODyYvQ9T5Nz98t3eiVLJ6XrBwUgzEH9BYgifkAk8QMiiR8QSfyASOIHRBI/IJL4AZHED4gkfkAk8QMiiR8QSfyASOIHRBI/IJL4AZHED4gkfkAk8QMiiR8QSfyASF3/8tT+39vOzuti4vW5Lho7PCnl+LQ+/LKveZb2fswzb9c8m/dSPtf1obH/MM9oz/vV9auL9vG7fayLiZvLumjsarU7fvd3pXwMh6a1pb0f8/ztaDg318P5mRpj8zCcn9aWNs9oofvlsxeIJH5AJPEDIokfEEn8gEjiB0QSPyCSS84jl5znmWfernlccv6x0P3q+sH3CiCIz14gkvgBkcQPiCR+QCTxAyKJHxBJ/IBI4gdEEj8gkvgBkcQPiCR+QCTxAyKJHxBJ/IBI4gdEEj8gkvgBkcQPyLPdiB8QaP1WvgBj/FW9pIttHAAAAABJRU5ErkJggg==\"","export default \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAUEAAAAuCAYAAAC226sKAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAFcSURBVHhe7dwxSsRAGIbh0YsoeIMtZDvvoWBlZaE3sPAGWlhZCR7EbrXYGwh6Es1mZwnIJmUS+Z6n2STVz0x4ITDswU+jAIQ6rL8AkUQQiCaCQDQRBKKJIBBNBIFoIghEE0EgmggC0UQQiCaCQDQRBKKJIBBNBIFoIghEE0EgmggC0dp/ln58fqu34zpdHJXl4rjedaaaZ+Pm6qxedcyzNbf9Ms+wfe/Oav1VPtbf9W5cc92vNoLn1y/lvVmcsb0+Xe5dlKnmuW1emr7oPEywUX3z2K+t/zLPyfK+Xo3rc3VXrzqbCF406zOFua3Pbh6fw0A0EQSiiSAQTQSBaCIIRBNBIJoIAtEclv7DYel+DicPm9s8DksP283TRrA+A4jjcxiIJoJANBEEookgEE0EgWgiCEQTQSCaCALRRBCIJoJANBEEookgEE0EgWgiCEQTQSCaCALRRBAIVsov/YKARCqVXtEAAAAASUVORK5CYII=\"","import React, { useState, createContext } from \"react\";\r\nimport DefaultInfoPanel from \"../components/InfoPanels/DefaultInfoPanel\";\r\n\r\n// If possble change any\r\nexport const InfoPanelContext = createContext<any>({});\r\n\r\ninterface InfoPanelProps {\r\n    children: React.ReactChild | React.ReactChild[];\r\n}\r\n\r\nexport const InfoPanelProvider = (props: InfoPanelProps) => {\r\n    const [infoPanelData, setInfoPanelData] = useState<InfoPanelData>(defaultInfoPanelData);\r\n    // const [infoPanel, setInfoPanel] = useState<JSX.Element>(<DefaultInfoPanel />);\r\n    // const [infoPanelHistory, setInfoPanelHistory] = useState<JSX.Element[]>([]);\r\n    // const [infoPanelFuture, setInfoPanelFuture] = useState<JSX.Element[]>([]);\r\n\r\n    const setInfoPanelWrapper = (newInfoPanel: JSX.Element) => {\r\n        // console.log(newInfoPanel);\r\n        setInfoPanelData((prevInfoPanelData) => {\r\n            let { infoPanel, infoPanelHistory } = prevInfoPanelData;\r\n            infoPanelHistory.push(infoPanel);\r\n            // console.log(newInfoPanelHistory);\r\n            // console.log(infoPanel)\r\n\r\n            // setInfoPanelHistory(newInfoPanelHistory);\r\n            return { infoPanel: newInfoPanel, infoPanelHistory: infoPanelHistory, infoPanelFuture: [] };\r\n        })\r\n    }\r\n\r\n    const handleInfoPanelForward = () => {\r\n        setInfoPanelData((prevInfoPanelData) => {\r\n            let { infoPanel, infoPanelHistory, infoPanelFuture } = prevInfoPanelData;\r\n            let newInfoPanel: JSX.Element | undefined;\r\n            if (infoPanelFuture.length !== 0) {\r\n                newInfoPanel = infoPanelFuture.shift();\r\n                infoPanelHistory.push(infoPanel);\r\n                // setInfoPanelHistory(newInfoPanelHistory);\r\n                // setInfoPanelFuture(newInfoPanelFuture);\r\n                // if (newPanel) setInfoPanel(newPanel);\r\n            }\r\n            if (newInfoPanel) {\r\n                return { infoPanel: newInfoPanel, infoPanelHistory: infoPanelHistory, infoPanelFuture: infoPanelFuture };\r\n            } else {\r\n                return prevInfoPanelData;\r\n            }\r\n        })\r\n    }\r\n\r\n    const handleInfoPanelBackward = () => {\r\n        setInfoPanelData((prevInfoPanelData) => {\r\n            let { infoPanel, infoPanelHistory, infoPanelFuture } = prevInfoPanelData;\r\n            let newInfoPanel: JSX.Element | undefined;\r\n            if (infoPanelHistory.length !== 0) {\r\n                // let newInfoPanelHistory = infoPanelHistory;\r\n                // let newInfoPanelFuture = infoPanelFuture;\r\n                newInfoPanel = infoPanelHistory.pop();\r\n\r\n                infoPanelFuture.unshift(infoPanel);\r\n\r\n                // setInfoPanelHistory(newInfoPanelHistory);\r\n                // setInfoPanelFuture(newInfoPanelFuture);\r\n                // if (newPanel) setInfoPanel(newPanel);\r\n            }\r\n            if (newInfoPanel) {\r\n                return { infoPanel: newInfoPanel, infoPanelHistory: infoPanelHistory, infoPanelFuture: infoPanelFuture };\r\n            } else {\r\n                return prevInfoPanelData;\r\n            }\r\n        })\r\n\r\n    }\r\n\r\n    const handleInfoPanelHome = () => {\r\n        setInfoPanelWrapper(<DefaultInfoPanel />);\r\n    }\r\n\r\n    return (\r\n        <InfoPanelContext.Provider value={{\r\n            infoPanelData,\r\n            setInfoPanelWrapper,\r\n            handleInfoPanelForward,\r\n            handleInfoPanelBackward,\r\n            handleInfoPanelHome\r\n        }}\r\n        >\r\n            {props.children}\r\n        </InfoPanelContext.Provider>\r\n    );\r\n}\r\n\r\n\r\n\r\nconst defaultInfoPanelData = {\r\n    infoPanel: <DefaultInfoPanel />,\r\n    infoPanelHistory: [],\r\n    infoPanelFuture: []\r\n};\r\n\r\nexport interface InfoPanelData {\r\n    infoPanel: JSX.Element;\r\n    infoPanelHistory: JSX.Element[];\r\n    infoPanelFuture: JSX.Element[];\r\n}\r\n// export function useInfoPanel(defaultData: InfoPanelData = defaultInfoPanelData) {\r\n//     const [infoPanel, setInfoPanel] = useState<JSX.Element>(<DefaultInfoPanel />);\r\n//     const [infoPanelHistory, setInfoPanelHistory] = useState<JSX.Element[]>([]);\r\n//     const [infoPanelFuture, setInfoPanelFuture] = useState<JSX.Element[]>([]);\r\n\r\n\r\n//     const setInfoPanelWrapper = (newInfoPanel: JSX.Element) => {\r\n//         console.log(newInfoPanel);\r\n//         let newInfoPanelHistory = infoPanelHistory;\r\n//         newInfoPanelHistory.push(infoPanel);\r\n//         console.log(newInfoPanelHistory);\r\n//         console.log(infoPanel)\r\n//         setInfoPanel(newInfoPanel);\r\n//         setInfoPanelHistory(newInfoPanelHistory);\r\n//         setInfoPanelFuture([]);\r\n//     }\r\n\r\n//     const handleInfoPanelForward = () => {\r\n//         if (infoPanelFuture.length !== 0) {\r\n//             let newInfoPanelHistory = infoPanelHistory;\r\n//             let newInfoPanelFuture = infoPanelFuture;\r\n//             let newPanel = newInfoPanelFuture.shift();\r\n\r\n//             newInfoPanelHistory.push(infoPanel);\r\n\r\n//             setInfoPanelHistory(newInfoPanelHistory);\r\n//             setInfoPanelFuture(newInfoPanelFuture);\r\n//             if (newPanel) setInfoPanel(newPanel);\r\n//         }\r\n//     }\r\n\r\n//     const handleInfoPanelBackward = () => {\r\n//         if (infoPanelHistory.length !== 0) {\r\n//             let newInfoPanelHistory = infoPanelHistory;\r\n//             let newInfoPanelFuture = infoPanelFuture;\r\n//             let newPanel = newInfoPanelHistory.pop();\r\n\r\n//             newInfoPanelFuture.unshift(infoPanel);\r\n\r\n//             setInfoPanelHistory(newInfoPanelHistory);\r\n//             setInfoPanelFuture(newInfoPanelFuture);\r\n//             if (newPanel) setInfoPanel(newPanel);\r\n//         }\r\n//     }\r\n\r\n//     const handleInfoPanelHome = () => {\r\n//         setInfoPanelWrapper(<DefaultInfoPanel{...config} />);\r\n//     }\r\n// }","import { useEffect, useState } from \"react\"\r\nimport { Dataset, Datapoint2D, DatasetGenerator } from \"./datasets\";\r\n\r\nlet GENERATORS: { [datasetType: string]: DatasetGenerator } = {\r\n    \"Gaussian2\": Dataset.GAUSSIAN_2,\r\n    \"Gaussian3\": Dataset.GAUSSIAN_3,\r\n    \"XOR\": Dataset.XOR,\r\n}\r\n\r\nconst defaultDGConfig = {\r\n    datasetType: \"Gaussian2\", // Possibly change to use genertor type\r\n    noise: 0.2,\r\n    numSamples: 100\r\n}\r\n\r\nexport interface DGConfig {\r\n    datasetType: string;\r\n    noise: number;\r\n    numSamples: number;\r\n}\r\n\r\nexport function useDatasetGenerator(defaultConfig: DGConfig = defaultDGConfig) {\r\n    const [dgConfig, setDGConfig] = useState<DGConfig>(defaultConfig);\r\n    // const [dataset, setDataset] = useState<Datapoint2D[]>([]);\r\n    const [trainingData, setTrainingData] = useState<Datapoint2D[]>([]);\r\n    const [testData, setTestData] = useState<Datapoint2D[]>([]);\r\n\r\n    useEffect(() => {\r\n        generateDataset();\r\n    }, [dgConfig]);\r\n\r\n\r\n    const generateDataset = () => {\r\n        console.log(\"Generating dataset\");\r\n        let { datasetType, numSamples, noise } = dgConfig;\r\n        let datasetGenerator = GENERATORS[datasetType];\r\n        let dataset = datasetGenerator(numSamples, noise);\r\n        let [newTrainingData, newTestData] = splitDataset(dataset);\r\n        setTrainingData(newTrainingData);\r\n        setTestData(newTestData);\r\n        // setDataset(dataset)\r\n        // console.log(dataset);\r\n        // return dataset;\r\n    }\r\n\r\n    const setDatasetType = (datasetType: string) => {\r\n        setDGConfig((prevConfig) => ({ ...prevConfig, datasetType: datasetType }));\r\n    }\r\n\r\n    const setNoise = (noise: number) => {\r\n        setDGConfig((prevConfig) => ({ ...prevConfig, noise: noise }));\r\n    }\r\n\r\n    const setNumSamples = (numSamples: number) => {\r\n        setDGConfig((prevConfig) => ({ ...prevConfig, numSamples: numSamples }));\r\n    }\r\n\r\n    const splitDataset = (dataset: Datapoint2D[]) => {\r\n        let testDataIndex = Math.floor(dataset.length * 0.8);\r\n        let trainingData = dataset.slice(0, testDataIndex);\r\n        let testData = dataset.slice(testDataIndex, dataset.length);\r\n        return [trainingData, testData];\r\n    }\r\n\r\n    return {\r\n        dgConfig,\r\n        generateDataset,\r\n        trainingData,\r\n        testData,\r\n        setDatasetType,\r\n        setNoise,\r\n        setNumSamples\r\n    }\r\n}","export default __webpack_public_path__ + \"static/media/Sigmoid-function-2.8e7151dc.svg\";","import React from \"react\";\r\nimport { NNConfig } from \"../../NetworkController\";\r\nimport { MathComponent } from \"mathjax-react\";\r\n\r\nfunction NodeInfoPanel(props: NNConfig) {\r\n\r\n    return (\r\n        <div>\r\n            <h1>Nodes</h1>\r\n            <p>Nodes are the individual functions that make up the neural network and are connected to nodes in adjacent layers by links.</p>\r\n            <h2>Usage</h2>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default NodeInfoPanel;","import styled from \"@emotion/styled\";\r\nimport React from \"react\";\r\nimport { DefinedTerm, DefNode } from \"../Definitions\";\r\nimport { NNConfig } from \"../../NetworkController\";\r\nimport sigmoid from \"../SVGs/Sigmoid-function-2.svg\";\r\nimport NodeInfoPanel from \"./NodeInfoPanel\";\r\n\r\n\r\nconst ActivationImg = styled(\"img\")`\r\n    width: 600px;\r\n`;\r\n\r\nfunction ActivationInfoPanel(props: {config: NNConfig, setInfoPanel: (infoPanel: JSX.Element) => void}) {\r\n\r\n    return (\r\n        <div>\r\n            <h1>Activation Functions (&Phi;)</h1>\r\n            <p>Activation function of a <DefinedTerm definition={DefNode()} onClick={props.setInfoPanel} infoPanel={<NodeInfoPanel {...props.config} />}>node</DefinedTerm></p>\r\n            <h2>Sigmoid</h2>\r\n            <ActivationImg src={sigmoid} alt=\"Sigmoid Function\" />\r\n            <p></p>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default ActivationInfoPanel;","import React from \"react\";\r\nimport { DefinedTerm, DefX1, DefX2 } from \"../Definitions\";\r\nimport { NNConfig } from \"../../NetworkController\";\r\n\r\nfunction DatasetInfoPanel(props: NNConfig) {\r\n\r\n    return (\r\n        <div>\r\n            <h1>Datasets</h1>\r\n            <p>These are the data sets you can use to train and test your network. All the points in the data sets have 2 features (<DefinedTerm definition={DefX1()}>X<sub>1</sub></DefinedTerm> and <DefinedTerm definition={DefX2()}>X<sub>2</sub></DefinedTerm>) and fall under one of two classifications (-1 or +1).</p>\r\n            <h2>Gaussian 2</h2>\r\n            <p>This data set is comprised of two 2-Dimensional Gaussian (or Normal) distributed sets of points, one for each class.<br/>\r\n            <a href=\"https://en.wikipedia.org/wiki/Normal_distribution\" target=\"_blank\">Read more here (Wiki)</a></p>\r\n            <h2>Gaussian 3</h2>\r\n            <p>This data set is comprised of three 2-Dimensional Gaussian (or Normal) distributed sets of points, one group of +1 points and two groups of -1 points.</p>\r\n            <h2>XOR</h2>\r\n            <p>This data set represents an XOR distributed set of points which cannot be classified using a straight line.<br/>\r\n            <a href=\"https://www.google.com/search?q=XOR\" target=\"_blank\">Read more here (Google)</a></p>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default DatasetInfoPanel;","import React from \"react\";\r\nimport { NNConfig } from \"../../NetworkController\";\r\nimport { MathComponent } from \"mathjax-react\";\r\n\r\nfunction LearningRateInfoPanel(props: NNConfig) {\r\n\r\n    return (\r\n        <div style={{ float: \"left\"}}>\r\n            <h1>Learning Rate (&epsilon;)</h1>\r\n            <p>The learning rate affects the rate at which the weights and biases change each epoch when training the neural network.</p>\r\n            <h2>Usage</h2>\r\n            <MathComponent tex={String.raw`w'=w-\\epsilon\\Delta J(x)`} />\r\n           <h2>Observations</h2>\r\n            <p>\r\n                We observe that <b>smaller</b> learning rates lead to <b>slower learning</b> but <b>more precise decision boundaries </b>\r\n                and <b>less fluctuating</b> around the local optima and conversely <b>larger</b> learning rates lead to <b>faster learning </b>\r\n                but <b>less precise decision boundaries</b> and <b>more fluctuating</b> around local minima.\r\n            </p>\r\n            <h3>Exercise</h3>\r\n            <p>Try different different learning rates and see how much the loss is reduced on average after 3 epochs.</p>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default LearningRateInfoPanel;","import styled from \"@emotion/styled\";\r\nimport { Typography } from \"@material-ui/core\";\r\nimport Slider from \"@material-ui/core/Slider\";\r\nimport Tooltip from \"@material-ui/core/Tooltip\";\r\nimport React, { useState } from \"react\";\r\n\r\ninterface Props {\r\n    children: React.ReactElement;\r\n    open: boolean;\r\n    value: number;\r\n}\r\n\r\nconst StyledDiv = styled(\"div\")`\r\n    width: 110px;\r\n    padding-left: 10px;\r\n    padding-right: 10px;\r\n`\r\n\r\nfunction ValueLabelComponent(props: Props) {\r\n    const { children, open, value } = props;\r\n\r\n    return (\r\n        <Tooltip open={open} enterTouchDelay={0} placement=\"top\" title={value}>\r\n            {children}\r\n        </Tooltip>\r\n    );\r\n}\r\n\r\n\r\ninterface sliderProps {\r\n    label?: string;\r\n    defaultValue: number;\r\n    onChange: (e: React.ChangeEvent<{}>, value: number | number[]) => void;\r\n    valueLabelDisplay?: \"on\" | \"off\" | \"auto\" | undefined;\r\n    step: number;\r\n    min: number;\r\n    max: number;\r\n    appendValueToLabel: boolean;\r\n}\r\n\r\nfunction LabeledSlider(props: sliderProps) {\r\n    const [currentValue, setCurrentValue] = useState<number>(props.defaultValue);\r\n\r\n\r\n    const handleOnChange = (e: any, newValue: number | number[]) => {\r\n        setCurrentValue(newValue as number);\r\n    }\r\n    return (\r\n        <StyledDiv>\r\n            <Typography gutterBottom>{props.label + \": \" + currentValue}</Typography>\r\n            <Slider\r\n                // ValueLabelComponent={ValueLabelComponent}\r\n                //aria-label=\"custom thumb label\"\r\n                defaultValue={props.defaultValue}\r\n                step={props.step}\r\n                min={props.min}\r\n                max={props.max}\r\n                onChange={handleOnChange}\r\n                onChangeCommitted={props.onChange}\r\n                // valueLabelDisplay={props.valueLabelDisplay || \"auto\"}\r\n            />\r\n        </StyledDiv>\r\n    );\r\n}\r\n\r\nexport default LabeledSlider;","import styled from \"@emotion/styled\";\r\nimport { Divider, FormControl, InputLabel, MenuItem, Select, Typography } from \"@material-ui/core\";\r\nimport React, { useContext } from \"react\";\r\nimport { InfoPanelContext } from \"../contexts/InfoPanelContext\";\r\nimport { DGConfig } from \"../DatasetGenerator\";\r\nimport { NNConfig } from \"../NetworkController\";\r\nimport ActivationInfoPanel from \"./InfoPanels/ActivationInfoPanel\";\r\nimport DatasetInfoPanel from \"./InfoPanels/DatasetInfoPanel\";\r\nimport LearningRateInfoPanel from \"./InfoPanels/LearningRateInfoPanel\";\r\nimport { ContainerSection, StyledInfoButton } from \"./MainPage\";\r\nimport LabeledSlider from \"./Slider\";\r\n\r\nconst StyledConfigBar = styled((props: any) => <ContainerSection gridArea=\"config-bar\" {...props} />)`\r\n    display: flex;\r\n    flex-direction: row;\r\n    justify-content: left;\r\n    padding-left: 30px;\r\n    padding-top: 10px;\r\n`;\r\n\r\nconst StyledFormControl = styled(FormControl)`\r\n    margin-left: 10px;\r\n    min-width: 130px;\r\n    background-color: inherit;\r\n`;\r\n\r\nconst StyledSelect = styled(Select)`\r\n    background-color: inherit;\r\n`;\r\n\r\ninterface ConfigBarProps {\r\n    nnConfig: NNConfig;\r\n    dgConfig: DGConfig;\r\n    setActivationFunction: (activationFunction: string) => void;\r\n    setLearningRate: (learningRate: number) => void;\r\n    setDatasetType: (datasetType: string) => void;\r\n    setNoise: (noise: number) => void;\r\n    setNumSamples: (numSamples: number) => void;\r\n    setBatchSize: (batchSize: number) => void;\r\n}\r\n\r\nfunction ConfigBar(props: ConfigBarProps) {\r\n    const { setInfoPanelWrapper } = useContext(InfoPanelContext);\r\n    const {\r\n        nnConfig,\r\n        dgConfig,\r\n        setActivationFunction,\r\n        setLearningRate,\r\n        setDatasetType,\r\n        setNoise,\r\n        setNumSamples,\r\n        setBatchSize\r\n    } = props;\r\n\r\n    const handleActivationChange = (e: React.ChangeEvent<{ value: unknown }>) => {\r\n        setActivationFunction(e.target.value as string);\r\n    };\r\n\r\n    const handleLearningRateChange = (e: React.ChangeEvent<{ value: unknown }>) => {\r\n        setLearningRate(e.target.value as number);\r\n    };\r\n\r\n    const handleDatasetChange = (e: React.ChangeEvent<{ value: unknown }>) => {\r\n        setDatasetType(e.target.value as string);\r\n    };\r\n\r\n    const handleNoiseChange = (e: any, newValue: number | number[]) => {\r\n        setNoise(newValue as number);\r\n    };\r\n\r\n    const handleNumSamplesChange = (e: any, newValue: number | number[]) => {\r\n        setNumSamples(newValue as number);\r\n    }\r\n\r\n    const handleBatchSizeChange = (e: any, newValue: number | number[]) => {\r\n        // setConfig({ ...config, batchSize: newValue as number });\r\n        setBatchSize(newValue as number);\r\n    }\r\n\r\n    return (\r\n        <StyledConfigBar>\r\n            <StyledFormControl variant=\"filled\">\r\n                <InputLabel>Activation</InputLabel>\r\n                <StyledSelect\r\n                    value={nnConfig.activationFunction}\r\n                    onChange={handleActivationChange}\r\n                >\r\n                    <MenuItem value=\"Tanh\">Tanh</MenuItem>\r\n                    <MenuItem value=\"ReLU\">ReLU</MenuItem>\r\n                    <MenuItem value=\"Sigmoid\">Sigmoid</MenuItem>\r\n                </StyledSelect>\r\n            </StyledFormControl>\r\n            <StyledInfoButton title=\"Activation Tooltip\" onClick={setInfoPanelWrapper} infoPanel={<ActivationInfoPanel config={nnConfig} setInfoPanel={setInfoPanelWrapper} />}>\r\n                <React.Fragment>\r\n                    <Typography color=\"inherit\">Activation Function (&Phi;)</Typography>\r\n                    <Typography variant=\"body2\">The activation defines the output of a neuron (node).</Typography><br />\r\n                    <u>Click the icon to get more information</u>\r\n                </React.Fragment>\r\n            </StyledInfoButton>\r\n            <Divider orientation=\"vertical\" flexItem />\r\n            <StyledFormControl variant=\"filled\">\r\n                <InputLabel>Learning Rate</InputLabel>\r\n                <StyledSelect\r\n                    value={nnConfig.learningRate}\r\n                    onChange={handleLearningRateChange}\r\n                >\r\n                    <MenuItem value=\"0.03\">0.03</MenuItem>\r\n                    <MenuItem value=\"0.005\">0.005</MenuItem>\r\n                </StyledSelect>\r\n            </StyledFormControl>\r\n            <StyledInfoButton title=\"Learning Rate Tooltip\" onClick={setInfoPanelWrapper} infoPanel={<LearningRateInfoPanel {...nnConfig} />}>\r\n                <React.Fragment>\r\n                    <Typography color=\"inherit\">Learning Rate (&epsilon;)</Typography>\r\n                    <Typography variant=\"body2\">This affects the rate at which the weights and biases change when training the neural network.</Typography><br />\r\n                    <u>Click the icon to get more information</u>\r\n                </React.Fragment>\r\n            </StyledInfoButton>\r\n            <Divider orientation=\"vertical\" flexItem />\r\n            <StyledFormControl variant=\"filled\">\r\n                <InputLabel>Dataset</InputLabel>\r\n                <StyledSelect\r\n                    value={dgConfig.datasetType}\r\n                    onChange={handleDatasetChange}\r\n                >\r\n                    <MenuItem value=\"Gaussian2\">2 Gaussian</MenuItem>\r\n                    <MenuItem value=\"Gaussian3\">3 Gaussian</MenuItem>\r\n                    <MenuItem value=\"XOR\">XOR</MenuItem>\r\n                </StyledSelect>\r\n            </StyledFormControl>\r\n            <StyledInfoButton title=\"Dataset Tooltip\" onClick={setInfoPanelWrapper} infoPanel={<DatasetInfoPanel {...nnConfig} />}>\r\n                <React.Fragment>\r\n                    <Typography color=\"inherit\">Datasets</Typography>\r\n                    <Typography variant=\"body2\">Defines the shape of the dataset we want our neural network to solve.</Typography><br />\r\n                    <u>Click the icon to get more information</u>\r\n                </React.Fragment>\r\n            </StyledInfoButton>\r\n            <Divider orientation=\"vertical\" flexItem />\r\n            <LabeledSlider\r\n                label=\"Dataset Size\"\r\n                min={10}\r\n                step={10}\r\n                max={500}\r\n                defaultValue={dgConfig.numSamples}\r\n                onChange={handleNumSamplesChange}\r\n                appendValueToLabel={true}\r\n            />\r\n            <StyledInfoButton title=\"Sample Size Tooltip\">\r\n                <React.Fragment>\r\n                    {<Typography color=\"inherit\">Noise</Typography>}\r\n                    <Typography variant=\"body2\">Changes the number of samples in the dataset. <br />(Training is done using 80% of the samples and the remaining 20% are used as the test dataset. </Typography>\r\n                </React.Fragment>\r\n            </StyledInfoButton>\r\n            <Divider orientation=\"vertical\" flexItem />\r\n            <LabeledSlider\r\n                label=\"Noise\"\r\n                min={0}\r\n                step={0.1}\r\n                max={1}\r\n                defaultValue={dgConfig.noise}\r\n                onChange={handleNoiseChange}\r\n                appendValueToLabel={true}\r\n            />\r\n            <StyledInfoButton title=\"Noise Tooltip\">\r\n                <React.Fragment>\r\n                    <Typography color=\"inherit\">Noise</Typography>\r\n                    <Typography variant=\"body2\">This sets the noise in the generated data set. The more noise the greater the variance in the generated data.</Typography>\r\n                </React.Fragment>\r\n            </StyledInfoButton>\r\n            <Divider orientation=\"vertical\" flexItem />\r\n            <LabeledSlider\r\n                label={\"Batch Size\"}\r\n                min={1}\r\n                step={1}\r\n                max={10}\r\n                defaultValue={nnConfig.batchSize}\r\n                onChange={handleBatchSizeChange}\r\n                appendValueToLabel={true}\r\n            />\r\n            <StyledInfoButton title=\"Batch Size Tooltip\">\r\n                <React.Fragment>\r\n                    <Typography color=\"inherit\">Batch Size</Typography>\r\n                    {/* Could create an info panel for Stochastic Gradient Decent*/}\r\n                    <Typography variant=\"body2\">Specifies the number of training samples used in each epoch of <a href=\"https://www.google.com/search?q=mini+batch+gradient+descent\" target=\"_blank\">Mini-Batch Gradient Decent</a>.<br />(When batch size = 1, this is equivalent to <a href=\"https://www.google.com/search?q=stochastic+gradient+descent\" target=\"_blank\">Stochastic Gradient Decent</a>) </Typography>\r\n                </React.Fragment>\r\n            </StyledInfoButton>\r\n        </StyledConfigBar>\r\n    );\r\n}\r\n\r\nexport default ConfigBar;","import styled from '@emotion/styled';\r\nimport { Button } from '@material-ui/core';\r\nimport React from 'react';\r\nimport { ContainerSection } from './MainPage';\r\n\r\nconst StyledControlPanel = styled((props: any) => <ContainerSection gridArea=\"control-panel\" {...props} />)`\r\ndisplay: flex;\r\nflex-direction: column;\r\nalign-items: stretch;\r\npadding-top: 15px;\r\npadding-bottom: 15px;\r\npadding-left: 10px;\r\npadding-right: 10px;\r\njustify-content: left;\r\n`;\r\n\r\nconst StyledButton = styled(Button)`\r\n    margin: 5px;\r\n`;\r\n\r\ninterface ControlPanelProps {\r\n    training: boolean;\r\n    handleStep: () => void;\r\n    toggleAutoTrain: () => void;\r\n    toggleDiscreetOutput: () => void;\r\n    handleRegenerateDataset: () => void;\r\n    handleReset: () => void;\r\n}\r\n\r\nfunction ControlPanel(props: ControlPanelProps) {\r\n    const {\r\n        training,\r\n        handleStep,\r\n        toggleAutoTrain,\r\n        toggleDiscreetOutput,\r\n        handleRegenerateDataset,\r\n        handleReset\r\n    } = props;\r\n    return (\r\n        <StyledControlPanel>\r\n            <StyledButton variant={\"contained\"} onClick={handleStep}> Step </StyledButton>\r\n            <StyledButton variant={\"contained\"} onClick={toggleAutoTrain}> Auto Train: <b>{training ? \"On\" : \"Off\"}</b></StyledButton>\r\n            <StyledButton variant={\"contained\"} onClick={toggleDiscreetOutput}> Toggle Discreet Boundary </StyledButton>\r\n            <StyledButton variant={\"contained\"} color={\"primary\"} onClick={handleRegenerateDataset}> Regenerate Dataset </StyledButton>\r\n            <StyledButton variant={\"contained\"} color={\"secondary\"} onClick={handleReset}> Reset </StyledButton>\r\n            {/* <StyledButton variant={\"contained\"} onClick={saveCurrentState}> Save Current Network State </StyledButton> \r\n                <StyledButton variant={\"contained\"} onClick={loadSavedState} disabled={(!networkController.compareMode) || false}> Load Network State </StyledButton>\r\n                <StyledButton variant={\"contained\"} onClick={clearNetworkState}> Clear Network State </StyledButton> */}\r\n        </StyledControlPanel>\r\n    );\r\n}\r\n\r\nexport default ControlPanel;","import React, { useContext, useEffect, useState } from 'react';\r\nimport * as vis from '../visControl';\r\nimport { Datapoint2D } from '../datasets';\r\nimport NNGraph from './NNGraph';\r\nimport { Button, InputLabel, MenuItem, Select, FormControl, Typography, Divider, IconButton } from '@material-ui/core';\r\nimport * as nn from './../NeuralNet';\r\nimport styled from '@emotion/styled';\r\nimport LabeledSlider from './Slider';\r\nimport InfoButton from './InfoButton';\r\nimport DefaultInfoPanel from './InfoPanels/DefaultInfoPanel';\r\nimport LearningInfoRatePanel from './InfoPanels/LearningRateInfoPanel';\r\nimport ActivationInfoPanel from './InfoPanels/ActivationInfoPanel';\r\nimport { ArrowBackIos, ArrowForwardIos, GitHub, Home } from '@material-ui/icons';\r\nimport DatasetInfoPanel from './InfoPanels/DatasetInfoPanel';\r\nimport NeuralNetworkVis from './NeuralNetworkVis';\r\nimport LossGraph from './LossGraph';\r\nimport LossInfoPanel from './InfoPanels/LossInfoPanel';\r\nimport { DefinedTerm, DefX1, DefX2 } from './Definitions';\r\nimport { ThemeContext } from '../contexts/ThemeContext';\r\nimport ColourScale from './ColourScale';\r\nimport { NNConfig, useNetwork } from '../NetworkController';\r\nimport { InfoPanelContext } from '../contexts/InfoPanelContext';\r\nimport { DGConfig, useDatasetGenerator } from '../DatasetGenerator';\r\nimport ConfigBar from './ConfigBar';\r\nimport ControlPanel from './ControlPanel';\r\n\r\ninterface PageProps {\r\n    xDomain: number[];\r\n    yDomain: number[];\r\n    numCells: number;\r\n    updateComparisionData: (currentState: NetworkState, savedState: NetworkState) => void;\r\n    nnConfig: NNConfig;\r\n    dgConfig: DGConfig;\r\n}\r\n\r\n// const StyledButton = styled(Button)`\r\n//     margin: 5px;\r\n// `;\r\n\r\nconst StyledFormControl = styled(FormControl)`\r\n    margin-left: 10px;\r\n    min-width: 130px;\r\n    background-color: inherit;\r\n`;\r\n\r\nconst StyledSelect = styled(Select)`\r\n    background-color: inherit;\r\n`;\r\n\r\nconst Container = styled(\"div\")`\r\n    -webkit-box-sizing: border-box; /* Safari/Chrome, other WebKit */\r\n    -moz-box-sizing: border-box;    /* Firefox, other Gecko */\r\n    box-sizing: border-box; \r\n    margin: 0px auto auto auto;\r\n    display: grid;\r\n    width: auto;\r\n    /* min-width: 1400px; */\r\n    min-height: 600px;\r\n    transition: padding 0.4s ease-in-out;\r\n    padding: 20px;\r\n    padding-left: 20px;\r\n    padding-right: 20px;\r\n    \r\n    /* max-width: 100%; */\r\n\r\n    // Using values from NeuralNetworkVis for middle column\r\n    grid-template-columns: 230px max(560px, calc(50vw + 10px)) min-content;\r\n    grid-template-rows: 90px 1fr 80px auto;\r\n    grid-gap: 15px;\r\n    grid-template-areas: \r\n        \"config-bar config-bar config-bar\"\r\n        \"control-panel network nn-graph\"\r\n        \"stats stats stats\"\r\n        \"info info info\";\r\n`;\r\n\r\nconst StyledLinkButton = styled(IconButton)`\r\n    color: #ffffff;\r\n`;\r\n\r\nconst LinksDiv = styled(\"div\")`\r\n    display: flex;\r\n    align-content: flex-end;\r\n`;\r\n\r\n\r\nexport const ContainerSection = styled(\"div\")`\r\n    -webkit-box-sizing: border-box; /* Safari/Chrome, other WebKit */\r\n    -moz-box-sizing: border-box;    /* Firefox, other Gecko */\r\n    box-sizing: border-box; \r\n    grid-area: ${(props: { gridArea: string }) => (props.gridArea)};\r\n    background-color: white;\r\n    margin: auto auto;\r\n    width: 100%;\r\n    height: 100%;\r\n    padding: 5px;\r\n    border-radius: 30px;\r\n    border: 2px solid #bdbdbd;\r\n    display: flex;\r\n    flex-direction: row;\r\n    justify-content: center;\r\n`;\r\n\r\n\r\nconst NetworkPanel = styled((props: any) => <ContainerSection gridArea=\"network\" {...props} />)`\r\n    display: flex;\r\n    flex-direction: column;\r\n    justify-content: space-between;\r\n    /* max-width: fit-content; */\r\n`\r\n\r\nconst GraphPanel = styled((props: any) => <ContainerSection gridArea=\"nn-graph\" {...props} />)`\r\n    display: block;\r\n`\r\n\r\nconst StatsBar = styled((props: any) => <ContainerSection gridArea=\"stats\" {...props} />)`\r\n    display: flex;\r\n    flex-direction: row;\r\n    align-items: stretch;\r\n    padding: 0px;\r\n    justify-content: space-around;\r\n    align-items: center;\r\n`;\r\n\r\nconst InfoPanel = styled((props: any) => <ContainerSection gridArea=\"info\" {...props} />)`\r\n    display: flex;\r\n    flex-direction: row;\r\n    justify-content: left;\r\n    padding-left: 30px;\r\n    padding-top: 10px;\r\n    position: relative;\r\n    max-width: inherit;\r\n    /* max-width: fit-content; */\r\n`;\r\n\r\nexport const StyledInfoButton = styled(InfoButton)`\r\n    font-size: 14px;\r\n`\r\n\r\nconst ColouredBox = styled(\"div\")`\r\n    float: left;\r\n    height: 1em;\r\n    width: 1em;\r\n    border: 1px solid black;\r\n    background-color: ${((props: { colour: string }) => props.colour)};\r\n    clear: both;\r\n    margin-right: 5px;\r\n`\r\n\r\nexport interface NetworkState {\r\n    noise: number;\r\n    datasetType: string;\r\n    dataset: Datapoint2D[];\r\n    config: NNConfig;\r\n    decisionBoundaries: { [nodeId: string]: number[] };\r\n    decisionBoundary: number[];\r\n    loss: number;\r\n    epochs: number;\r\n    lossData: [number, number][];\r\n}\r\n\r\nfunction MainPage(props: PageProps) {\r\n    const { minColour,\r\n        minColourName,\r\n        maxColour,\r\n        maxColourName,\r\n        midColour\r\n    } = useContext(ThemeContext);\r\n\r\n    const {\r\n        infoPanelData,\r\n        setInfoPanelWrapper,\r\n        handleInfoPanelForward,\r\n        handleInfoPanelBackward,\r\n        handleInfoPanelHome\r\n    } = useContext(InfoPanelContext);\r\n\r\n    const {\r\n        nnConfig,\r\n        network,\r\n        setActivationFunction,\r\n        setLearningRate,\r\n        setBatchSize,\r\n        step,\r\n        reset,\r\n        toggleInputNode,\r\n        addNode,\r\n        removeNode,\r\n        addLayer,\r\n        removeLayer\r\n    } = useNetwork(props.nnConfig);\r\n\r\n    const {\r\n        dgConfig,\r\n        generateDataset,\r\n        trainingData,\r\n        testData,\r\n        setDatasetType,\r\n        setNoise,\r\n        setNumSamples,\r\n    } = useDatasetGenerator(props.dgConfig);\r\n\r\n    const [decisionBoundaries, setDecisionBoundaries] = useState<{ [nodeId: string]: number[] }>({});\r\n    const [decisionBoundary, setDecisionBoundary] = useState<number[]>([]);\r\n    const [loss, setLoss] = useState<number>(0);\r\n    const [epochs, setEpochs] = useState<number>(0);\r\n    const [discreetBoundary, setDiscreetBoundary] = useState<boolean>(false);\r\n    const [lossData, setLossData] = useState<[number, number][]>([]);\r\n    const [training, setTraining] = useState<boolean>(false);\r\n    const [trainingInterval, setTrainingInterval] = useState<number>();\r\n    const [compareMode, setCompareMode] = useState<boolean>(false);\r\n    // const [networkOriginalState, setNetworkOriginalState] = useState<nn.Node[][]>();\r\n    // // const [networkSaveState, setNetworkSaveState] = useState<nn.Node[][]>();\r\n\r\n    const [comparisonData, setComaparisonData] = useState<NetworkState>();\r\n\r\n    useEffect(() => {\r\n        console.log(\"Config change useEffect\");\r\n        if (training) toggleAutoTrain();\r\n        // generateNetwork();\r\n        generateDataset();\r\n    }, [nnConfig, dgConfig]);\r\n\r\n    useEffect(() => {\r\n        updateDecisionBoundary();\r\n    }, [decisionBoundaries]);\r\n\r\n    useEffect(() => {\r\n        console.log(\"Network change useEffect\");\r\n        updateDecisionBoundaries();\r\n    }, [network]);\r\n\r\n\r\n    // useEffect(() => {\r\n    //     console.log(\"Dataset/Noise change useEffect\");\r\n    //     rese(); // Change reset implementation\r\n    // }, [datasetType, noise, numSamples]);\r\n\r\n    useEffect(() => {\r\n        if (epochs === 0 || !network) return;\r\n        setLossData(lossData => lossData.concat([[epochs, vis.getCost(network, trainingData, nnConfig.inputs)]]));\r\n    }, [epochs]);\r\n\r\n\r\n    // const generateDataset = () => {\r\n    //     console.log(\"Generating dataset\");\r\n    //     setDataset(vis.getDataset(datasetType, numSamples, noise));\r\n    // }\r\n\r\n    // const generateNetwork = () => {\r\n    //     console.log(\"Generating network\");\r\n\r\n    //     if (!compareMode) {\r\n    //         let newNetwork = vis.start(config);\r\n    //         setNetwork(newNetwork);\r\n    //         let newNetworkCopy = vis.copyNetwork(newNetwork);\r\n    //         console.log(newNetworkCopy);\r\n    //         setNetworkOriginalState(newNetworkCopy);\r\n    //     } else {\r\n    //         console.log(\"Loading network original state\");\r\n    //         if (networkOriginalState) {\r\n    //             console.log(networkOriginalState);\r\n    //             setNetwork(vis.copyNetwork(networkOriginalState));\r\n    //         }\r\n    //     }\r\n    //     setEpochs(0);\r\n    //     setLossData([]);\r\n    // }\r\n\r\n    const updateDecisionBoundaries = () => {\r\n        console.log(\"Updating decision boundaries\");\r\n        if (network) {\r\n            // Don't like numcells having to be the same\r\n            setDecisionBoundaries(vis.getAllDecisionBoundaries(network, 20, props.xDomain, props.yDomain, nnConfig.inputs));\r\n            trainingData && setLoss(vis.getCost(network, trainingData, nnConfig.inputs));\r\n        }\r\n    }\r\n\r\n    const updateDecisionBoundary = () => {\r\n        console.log(\"Updating decision boundary\");\r\n        network && setDecisionBoundary(vis.getOutputDecisionBoundary1D(network, props.numCells, props.xDomain, props.yDomain, nnConfig.inputs));\r\n    }\r\n\r\n    const handleReset = () => {\r\n        console.log(\"Reset\");\r\n        if (training) toggleAutoTrain();\r\n        reset();// generateNetwork();\r\n        setEpochs(0);\r\n        setLossData([]);\r\n        if (!compareMode) generateDataset();\r\n    };\r\n\r\n    const handleStep = () => {\r\n        console.log(\"HandleStep\")\r\n        step(trainingData);\r\n        setEpochs((prevEpochs) => prevEpochs + 1);\r\n        updateDecisionBoundaries();\r\n    }\r\n    // const step = (noSteps: number) => {\r\n    //     console.log(`MainPage step(${noSteps})`);\r\n    //     if (!network || !dataset) return;\r\n\r\n    //     let start = Date.now();\r\n    //     for (let i = 0; i < noSteps; i++) {\r\n    //         vis.step(network, dataset, config.learningRate, config.inputs, config.batchSize);\r\n    //         setEpochs(epochs => epochs + 1);\r\n    //     }\r\n\r\n    //     let delta = Date.now() - start;\r\n    //     // console.log(`Finished training step(${noSteps}) (Duration ${delta}ms)`);\r\n\r\n    //     start = Date.now();\r\n    //     updateDecisionBoundaries();\r\n    //     delta = Date.now() - start;\r\n    //     // console.log(`Finsihed updating decision boundaries (Duration ${delta}ms)`);\r\n    //     // console.log(lossData);\r\n    // };\r\n\r\n    const toggleDiscreetOutput = () => {\r\n        setDiscreetBoundary((prevDiscreetBoundary) => !prevDiscreetBoundary);\r\n    };\r\n\r\n    const handleActivationChange = (e: React.ChangeEvent<{ value: unknown }>) => {\r\n        // setConfig({ ...config, activationFunction: e.target.value as string });\r\n        // Method 1\r\n        setActivationFunction(e.target.value as string); // ??\r\n        // Method 2\r\n        // let networkController = useNetwork(props.nnConfig, props.nnState);\r\n        // Do I want a whole new controller made or just to change the current one?\r\n    };\r\n\r\n    // const handleLearningRateChange = (e: React.ChangeEvent<{ value: unknown }>) => {\r\n    //     // setConfig({ ...config, learningRate: e.target.value as number });\r\n    //     setLearningRate(e.target.value as number);\r\n    // };\r\n\r\n    // const handleDatasetChange = (e: React.ChangeEvent<{ value: unknown }>) => {\r\n    //     setDatasetType(e.target.value as string);\r\n    // };\r\n\r\n    const handleRegenerateDataset = () => {\r\n        generateDataset();\r\n        if (training) toggleAutoTrain();\r\n    };\r\n\r\n    // const handleNoiseChange = (e: any, newValue: number | number[]) => {\r\n    //     setNoise(newValue as number);\r\n    // };\r\n\r\n    // const handleNumSamplesChange = (e: any, newValue: number | number[]) => {\r\n    //     setNumSamples(newValue as number);\r\n    // }\r\n\r\n    // const handleBatchSizeChange = (e: any, newValue: number | number[]) => {\r\n    //     // setConfig({ ...config, batchSize: newValue as number });\r\n    //     setBatchSize(newValue as number);\r\n    // }\r\n\r\n    // const handleInputNodeClick = (nodeId: string, active: boolean) => {\r\n    //     // console.log(`Input node click (NodeId: ${nodeId}, Active: ${active})`);\r\n    //     // Change this implemntation input is highly coupled with visControl\r\n    //     toggleInputNode(nodeId, active);\r\n    // }\r\n\r\n   \r\n\r\n    // const saveComparisionData = () => {\r\n    //     let newComparisionData: NetworkState = {\r\n    //         config: config,\r\n    //         dataset: dataset,\r\n    //         datasetType: datasetType,\r\n    //         decisionBoundaries: decisionBoundaries,\r\n    //         decisionBoundary: decisionBoundary,\r\n    //         epochs: epochs,\r\n    //         loss: loss,\r\n    //         lossData: lossData,\r\n    //         noise: noise\r\n    //     }\r\n\r\n    //     setComaparisonData(newComparisionData);\r\n    // }\r\n\r\n    const toggleAutoTrain = () => {\r\n        setTraining((training) => {\r\n            if (training) {\r\n                clearInterval(trainingInterval);\r\n            } else {\r\n                setTrainingInterval(setInterval(() => {\r\n                    handleStep();\r\n                }, 500));\r\n            }\r\n            return !training;\r\n        })\r\n    }\r\n\r\n    // const saveNetworkState = () => {\r\n    //     setCompareMode(true);\r\n    // }\r\n\r\n    // const loadOriginalState = () => {\r\n\r\n    // }\r\n\r\n    // const saveCurrentState = () => {\r\n    //     saveComparisionData();\r\n    //     setCompareMode(true);\r\n    // }\r\n\r\n    // const loadSavedState = () => {\r\n    //     handleReset(); // This is defo broken\r\n    // }\r\n\r\n    // const clearNetworkState = () => {\r\n    //     setComaparisonData(undefined);\r\n    //     setCompareMode(false);\r\n    // }\r\n\r\n\r\n\r\n    return (\r\n        <Container id=\"main-page\">\r\n            <ConfigBar\r\n                nnConfig={nnConfig}\r\n                dgConfig={dgConfig}\r\n                setActivationFunction={setActivationFunction}\r\n                setLearningRate={setLearningRate}\r\n                setDatasetType={setDatasetType}\r\n                setNoise={setNoise}\r\n                setNumSamples={setNumSamples}\r\n                setBatchSize={setBatchSize}\r\n            />\r\n            <ControlPanel\r\n                training={training}\r\n                handleStep={handleStep}\r\n                toggleAutoTrain={toggleAutoTrain}\r\n                toggleDiscreetOutput={toggleDiscreetOutput}\r\n                handleRegenerateDataset={handleRegenerateDataset}\r\n                handleReset={handleReset}\r\n            />\r\n\r\n            <GraphPanel>\r\n                <div style={{ display: \"flex\", marginLeft: \"25px\" }}>\r\n                    <Typography variant=\"h6\">Output</Typography>\r\n                    <StyledInfoButton title=\"Output Tooltip\" marginLeft={5} fontSize=\"small\" onClick={setInfoPanelWrapper} infoPanel={<LossInfoPanel {...nnConfig} />}>\r\n                        <React.Fragment>\r\n                            <Typography color=\"inherit\">Output</Typography>\r\n                            <Typography variant=\"body2\">This graph shows the final output of the neural network in the domain (-8, +8) for both the <DefinedTerm definition={DefX1()}>X<sub>1</sub></DefinedTerm> and <DefinedTerm definition={DefX2()}>X<sub>2</sub></DefinedTerm> features.<br /> The samples in the data sets used only have 2 classes (-1 and +1); the neural network defines a decision boundary so that points that are in<br /> {minColourName} <ColouredBox colour={minColour} /> sections of the graph are classified as class -1 and points that are in <br /> {maxColourName} <ColouredBox colour={maxColour} /> sections of the graph are classified as class +1.</Typography><br />\r\n                        </React.Fragment>\r\n                    </StyledInfoButton>\r\n                    <ColourScale\r\n                        width={150}\r\n                        height={15}\r\n                        maxColour={maxColour}\r\n                        minColour={minColour}\r\n                        midColour={midColour}\r\n                        maxValue={1}\r\n                        minValue={-1}\r\n                        midValue={0}\r\n                        numShades={100}\r\n                        horizontal={true}\r\n                    />\r\n                </div>\r\n                {trainingData && network && <NNGraph\r\n                    dataset={trainingData}\r\n                    density={25}\r\n                    canvasWidth={250}\r\n                    marginLeft={35}\r\n                    marginRight={20}\r\n                    marginTop={20}\r\n                    marginBottom={40}\r\n                    numCells={props.numCells}\r\n                    xDomain={props.xDomain}\r\n                    yDomain={props.yDomain}\r\n                    decisionBoundary={decisionBoundary}\r\n                    discreetBoundary={discreetBoundary}\r\n                />}\r\n                <div style={{ marginLeft: \"10px\" }}>\r\n                    <p style={{ marginTop: \"0px\", marginBottom: \"0px\" }}> Epochs: {epochs} </p>\r\n                    <div style={{ display: \"flex\", justifyContent: \"flex-start\" }}>\r\n                        <p style={{ marginTop: \"0px\", marginBottom: \"0px\" }}> Loss: {loss.toFixed(3)} </p>\r\n                        <StyledInfoButton title=\"Loss Tooltip\" marginLeft={5} fontSize=\"small\" onClick={setInfoPanelWrapper} infoPanel={<LossInfoPanel {...nnConfig} />}>\r\n                            <React.Fragment>\r\n                                <Typography color=\"inherit\">Loss</Typography>\r\n                                <Typography variant=\"body2\">This is loss calculated using the <a href=\"https://www.google.com/search?q=sum+squared+residuals\" target=\"_blank\">sum of squared residulals</a> between the output of our neural network and the expected output from out training set.</Typography><br />\r\n                                <u>Click the icon to get more information</u>\r\n                            </React.Fragment>\r\n                        </StyledInfoButton>\r\n                    </div>\r\n                    <LossGraph\r\n                        height={60}\r\n                        width={170}\r\n                        margin={5}\r\n                        dataset={lossData}\r\n                        comparisionData={comparisonData?.lossData} />\r\n                </div>\r\n            </GraphPanel>\r\n            <NetworkPanel>\r\n                {trainingData && network && <NeuralNetworkVis\r\n                    network={network}\r\n                    decisionBoundaries={decisionBoundaries}\r\n                    discreetBoundary={discreetBoundary}\r\n                    inputs={nnConfig.inputs}\r\n                    config={nnConfig}\r\n                    networkWidth={650}\r\n                    networkHeight={550}\r\n                    handleOnClick={toggleInputNode}\r\n                    addNode={addNode}\r\n                    removeNode={removeNode}\r\n                    addLayer={addLayer}\r\n                    removeLayer={removeLayer}\r\n                    setInfoPanel={setInfoPanelWrapper}\r\n                />}\r\n            </NetworkPanel>\r\n            <StatsBar>\r\n\r\n            </StatsBar>\r\n            <InfoPanel>\r\n                {infoPanelData.infoPanel}\r\n                <div style={{ position: \"absolute\", right: \"40px\", top: \"30px\" }}>\r\n                    <IconButton onClick={handleInfoPanelBackward}>\r\n                        <ArrowBackIos />\r\n                    </IconButton>\r\n                    <IconButton onClick={handleInfoPanelHome}>\r\n                        <Home fontSize={\"large\"} />\r\n                    </IconButton>\r\n                    <IconButton onClick={handleInfoPanelForward}>\r\n                        <ArrowForwardIos />\r\n                    </IconButton>\r\n                </div>\r\n            </InfoPanel>\r\n            <LinksDiv>\r\n                <a href=\"https://git-teaching.cs.bham.ac.uk/mod-ug-proj-2020/bxg796\" target=\"_blank\">\r\n                    <StyledLinkButton>\r\n                        <GitHub color=\"inherit\" />\r\n                    </StyledLinkButton>\r\n                </a>\r\n            </LinksDiv>\r\n        </Container>\r\n    );\r\n}\r\n\r\nexport default MainPage;","import { useRef, useEffect, RefObject } from 'react';\r\n\r\n// From https://github.com/Junscuzzy/useHooks.ts\r\n\r\nfunction useEventListener<T extends HTMLElement = HTMLDivElement>(\r\n  eventName: string,\r\n  handler: (event: Event) => void,\r\n  element?: RefObject<T>,\r\n  useCapture?: boolean,\r\n) {\r\n  // Create a ref that stores handler\r\n  const savedHandler = useRef<(event: Event) => void>()\r\n  useEffect(() => {\r\n    // Define the listening target\r\n    const targetElement: T | Window = element?.current || window;\r\n    const capture = useCapture ? useCapture : false;\r\n    if (!(targetElement && targetElement.addEventListener)) {\r\n      return;\r\n    }\r\n    // Update saved handler if necessary\r\n    if (savedHandler.current !== handler) {\r\n      savedHandler.current = handler;\r\n    }\r\n    // Create event listener that calls handler function stored in ref\r\n    const eventListener = (event: Event) => {\r\n      // eslint-disable-next-line no-extra-boolean-cast\r\n      if (!!savedHandler?.current) {\r\n        savedHandler.current(event);\r\n      }\r\n    }\r\n    targetElement.addEventListener(eventName, eventListener, capture);\r\n    // Remove event listener on cleanup\r\n    return () => {\r\n      targetElement.removeEventListener(eventName, eventListener, capture);\r\n    }\r\n  }, [eventName, element, handler, useCapture]);\r\n}\r\nexport default useEventListener;","import { ThemeContext } from \"./contexts/ThemeContext\";\r\nimport styled from '@emotion/styled';\r\nimport { IconButton } from '@material-ui/core';\r\nimport { ArrowBackIos, ArrowForwardIos } from '@material-ui/icons';\r\nimport React, { createRef, useContext, useEffect, useState } from 'react';\r\nimport './App.css';\r\nimport ComparePage from './components/ComparePage';\r\nimport MainPage, { NetworkState } from './components/MainPage';\r\nimport useEventListener from './components/UseEventListener';\r\nimport { css, Global } from \"@emotion/react\";\r\nimport { useNetwork } from \"./NetworkController\";\r\nimport { useDatasetGenerator } from \"./DatasetGenerator\";\r\n\r\n\r\n// export const ThemeContext = createContext<Partial<ThemeProps>>({});\r\n\r\n// const StyledMainPage = styled(MainPage)`\r\n\r\n// `\r\n\r\nconst StyledComparePage = styled(ComparePage)`\r\n`\r\n\r\nconst StyledMargin = styled(\"div\")`\r\n    //min-width: 130px;\r\n    //max-width: 100%;\r\n`\r\n\r\nconst Container = styled(\"div\")`\r\n        -webkit-box-sizing: border-box; /* Safari/Chrome, other WebKit */\r\n        -moz-box-sizing: border-box;    /* Firefox, other Gecko */\r\n        box-sizing: border-box; \r\n        position: absolute;\r\n        display: flex;\r\n        /* justify-content: center; */\r\n        margin-top: auto;\r\n        min-height: 100vh;\r\n        width: calc(100vw - (100vw - 100%));\r\n        /* max-width: 100vw; */\r\n        overflow-x: auto;\r\n    \r\n\r\n    &.main {\r\n        margin-right: max(60px,);\r\n        left: 0%;\r\n        transition: all 0.7s ease-in-out;\r\n        &.active {\r\n        left: -100%;\r\n        }\r\n    }\r\n\r\n    &.compare {\r\n        left: 100%;\r\n        transition: all 0.7s ease-in-out;\r\n        &.active {\r\n        left: 0%;\r\n        }\r\n    }\r\n`\r\n\r\n// const MainContainer = styled(Container)`\r\n\r\n// `\r\n\r\nconst AuxContainer = styled(\"div\")`\r\n    position: relative;\r\n    min-width: 100vw;\r\n    height: 100vh;\r\n    /* min-width: 100%; */\r\n    width: auto;\r\n    display: flex;\r\n    overflow-x: hidden;\r\n    left: 0%;\r\n`\r\n\r\nconst TransitionButton = styled(IconButton)`\r\n    position: absolute;\r\n    background: white;\r\n    border-radius: 50%;\r\n    width: 50px;\r\n    height: 50px;\r\n    top: 50%;\r\n    left: 95%;\r\n    z-index: 500;\r\n    transition: all ${(props: {transitioning: boolean}) => props.transitioning ? \"0.7s\" : \"0s\"} ease-in-out;\r\n    &.active {\r\n        left: 5%;\r\n    }\r\n`\r\n\r\ninterface ComparisonData {\r\n    currentState: NetworkState;\r\n    savedState: NetworkState;\r\n}\r\n\r\nfunction App() {\r\n    const {background} = useContext(ThemeContext);\r\n    const { nnConfig } = useNetwork();\r\n    const { dgConfig } = useDatasetGenerator();\r\n    const mainContainer = createRef<HTMLDivElement>();\r\n\r\n    const [pageState, setPageState] = useState<string>(\"main\");\r\n    const [marginAdded, setMarginAdded] = useState<boolean>(false);\r\n    const [marginWidth, setMarginWidth] = useState<number>(0);\r\n    const [transitioning, setTransitioning] = useState<boolean>(false);\r\n\r\n    const [comparisonData, setComparisonData] = useState<ComparisonData>();\r\n\r\n    const updateComparisionData = (currentState: NetworkState, savedState: NetworkState) => {\r\n        setComparisonData({currentState: currentState, savedState: savedState});\r\n    }\r\n\r\n    useEffect(() => {\r\n        if(transitioning) {\r\n            updateButtonPosition();\r\n        }\r\n    }, [transitioning])\r\n\r\n    useEffect(() => {\r\n        setTimeout(function() {\r\n            // console.log(pageState);\r\n            setTransitioning(false);\r\n            updateContainerSize();\r\n            // updateButtonPosition();\r\n        }, 700);\r\n    }, [pageState]);\r\n\r\n    useEffect(() => {\r\n        updateButtonPosition();\r\n    }, [marginAdded]);\r\n\r\n    const handleTransitionButton = () => {\r\n        setPageState(pageState === \"main\" ? \"compare\" : \"main\");\r\n        setTransitioning(true);\r\n        let containers = document.querySelectorAll(\".animated\");\r\n        containers.forEach((container: Element) => container.classList.toggle(\"active\"));\r\n    }\r\n\r\n    const updateContainerSize = () => {\r\n        // console.log(\"Updating container size\");\r\n\r\n        const maxMarginSize = 140;\r\n        if (pageState === \"main\") {\r\n\r\n            let container = document.getElementById(\"main-container\");\r\n            let mainPage = document.getElementById(\"main-page\");\r\n            let margin = document.getElementById(\"dynamic-margin-main\");\r\n\r\n            if (!container || !mainPage || !margin) return;\r\n\r\n            // console.log(\"Conatainer width: \" + container.offsetWidth);\r\n            // console.log(\"Page width: \" + mainPage.offsetWidth);\r\n\r\n            // console.log(\"Margin width: \" + marginWidth);\r\n\r\n            if ((container.offsetWidth - marginWidth) < (mainPage.offsetWidth + maxMarginSize)) {\r\n                let newMarginWidth = Math.min((mainPage.offsetWidth + maxMarginSize) - container.offsetWidth, maxMarginSize);\r\n                margin.style.minWidth = `${newMarginWidth}px`;\r\n                setMarginAdded(true);\r\n                setMarginWidth(newMarginWidth);\r\n                // console.log(\"Margin added\");\r\n            } else {\r\n                margin.style.minWidth = \"0px\";\r\n                setMarginAdded(false);\r\n                setMarginWidth(0);\r\n                // console.log(\"Margin removed\");\r\n            }\r\n        }\r\n\r\n        if (pageState === \"compare\") {\r\n\r\n            let container = document.getElementById(\"compare-container\");\r\n            let comparePage = document.getElementById(\"compare-page\");\r\n            let margin = document.getElementById(\"dynamic-margin-compare\");\r\n\r\n            if (!container || !comparePage || !margin) return;\r\n\r\n            // console.log(\"Conatainer width: \" + container.offsetWidth);\r\n            // console.log(\"Page width: \" + comparePage.offsetWidth);\r\n\r\n            // console.log(\"Margin width: \" + marginWidth);\r\n\r\n            if ((container.offsetWidth - marginWidth) < (comparePage.offsetWidth + maxMarginSize)) {\r\n                let newMarginWidth = Math.min((comparePage.offsetWidth + maxMarginSize) - container.offsetWidth, maxMarginSize);\r\n                margin.style.minWidth = `${newMarginWidth}px`;\r\n                setMarginAdded(true);\r\n                setMarginWidth(newMarginWidth);\r\n                // console.log(\"Margin added\");\r\n            } else {\r\n                margin.style.minWidth = \"0px\";\r\n                setMarginAdded(false);\r\n                setMarginWidth(0);\r\n                // console.log(\"Margin removed\");\r\n            }\r\n\r\n        }\r\n    }\r\n\r\n    // Maybe convert to refs for better design. (Note: can't ref mainPage)\r\n    const updateButtonPosition = () => {\r\n        // console.log(\"Updating button position\");\r\n\r\n        let button = document.getElementById(\"transition-button\");\r\n\r\n        if(!button) return;\r\n\r\n\r\n        // console.log(\"Margin added: \" + marginAdded);\r\n        // console.log(\"Transitioning: \" + transitioning);\r\n        // console.log(\"Pagestate: \" + pageState);\r\n\r\n        if(transitioning) {\r\n            button.style.left = pageState === \"compare\" ? \"5%\" : \"95%\";\r\n            return;\r\n        }\r\n        if (marginAdded) {\r\n            // setTransitioning(false);\r\n            if (pageState === \"main\") {\r\n\r\n                let container = document.getElementById(\"main-container\");\r\n                let mainPage = document.getElementById(\"main-page\");\r\n\r\n                if (!container || !mainPage) return;\r\n\r\n                let containerRect = container.getBoundingClientRect();\r\n                let pageRect = mainPage.getBoundingClientRect();\r\n\r\n                if ((pageRect.right + 70) >= containerRect.width) {\r\n                    // button.style.left = \"100%\";\r\n                    button.style.left = `${pageRect.right + 20}px`;\r\n                } else {\r\n                    button.style.left = `min(95%, calc(${pageRect.x + pageRect.width}px + 2%))`;\r\n                    // console.log(\"here\");\r\n\r\n                }\r\n            //     console.log(pageRect);\r\n            //     console.log(containerRect);\r\n            }\r\n\r\n            if (pageState === \"compare\") {\r\n\r\n                let container = document.getElementById(\"compare-container\");\r\n                let comparePage = document.getElementById(\"compare-page\");\r\n\r\n                if (!container || !comparePage) return;\r\n\r\n                let containerRect = container.getBoundingClientRect();\r\n                let pageRect = comparePage.getBoundingClientRect();\r\n\r\n                if ((pageRect.left - 60) <= containerRect.width) {\r\n                    // button.style.left = \"100%\";\r\n                    button.style.right = \"100%\";\r\n                } else {\r\n                    button.style.left = `min(95%, calc(${pageRect.x + pageRect.width}px + 2%))`;\r\n                    // console.log(\"here\");\r\n\r\n                }\r\n                // console.log(pageRect);\r\n                // console.log(containerRect);\r\n            }\r\n        } else {\r\n            // console.log(\"heer\");\r\n            button.style.left = pageState === \"main\" ? \"95%\" : \"5%\";\r\n        }\r\n    }\r\n\r\n    useEventListener(\"resize\", () => {\r\n        updateContainerSize();\r\n        updateButtonPosition();\r\n    });\r\n    \r\n    useEventListener(\"scroll\",  updateButtonPosition, mainContainer);\r\n\r\n    return (\r\n        <AuxContainer>\r\n        <Global\r\n          styles={css`\r\n            body {\r\n              background: ${background}\r\n            }`}/>\r\n            <Container id=\"main-container\" className=\"animated main\" ref={mainContainer}>\r\n                {/* <StyledMargin/> */}\r\n                <MainPage\r\n                    xDomain={[-8, 8]}\r\n                    yDomain={[-8, 8]}\r\n                    numCells={100}\r\n                    updateComparisionData={updateComparisionData}\r\n                    nnConfig={nnConfig}\r\n                    dgConfig={dgConfig}\r\n                />\r\n                <StyledMargin id=\"dynamic-margin-main\" />\r\n            </Container>\r\n            <TransitionButton transitioning={transitioning} id=\"transition-button\" className=\"animated\" onClick={handleTransitionButton}>\r\n                {pageState === \"main\" && <ArrowForwardIos />}\r\n                {pageState === \"compare\" && <ArrowBackIos />}\r\n            </TransitionButton>\r\n            <Container id=\"compare-container\" className=\"animated compare\">\r\n                <StyledMargin id=\"dynamic-margin-compare\" />\r\n                <StyledComparePage currentState={comparisonData?.currentState} savedState={comparisonData?.savedState}/>\r\n            </Container>\r\n        </AuxContainer>\r\n    );\r\n}\r\n\r\nexport default App;\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport './index.css';\r\nimport App from './App';\r\nimport { StylesProvider } from '@material-ui/core';\r\nimport { ThemeProvider } from './contexts/ThemeContext';\r\nimport { InfoPanelProvider } from './contexts/InfoPanelContext';\r\n//import reportWebVitals from './reportWebVitals';\r\n\r\n\r\n\r\nReactDOM.render(\r\n    <React.StrictMode>\r\n        <StylesProvider injectFirst>\r\n            <ThemeProvider>\r\n                <InfoPanelProvider>\r\n                    <App />\r\n                </InfoPanelProvider>\r\n            </ThemeProvider>\r\n        </StylesProvider>\r\n    </React.StrictMode>,\r\n    document.getElementById('root')\r\n);\r\n\r\n// If you want to start measuring performance in your app, pass a function\r\n// to log results (for example: reportWebVitals(console.log))\r\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\r\n//reportWebVitals();\r\n"],"sourceRoot":""}