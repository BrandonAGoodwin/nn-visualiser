{"version":3,"sources":["contexts/ThemeContext.tsx","components/LossGraph.tsx","components/ComparePage.tsx","NeuralNet.ts","datasets.ts","visControl.ts","components/BackgroundCanvas.tsx","components/NNGraph.tsx","components/Slider.tsx","components/InfoButton.tsx","components/InfoPanels/DefaultInfoPanel.tsx","PositiveLink.png","NegativeLink.png","components/InfoPanels/LearningRateInfoPanel.tsx","components/Definitions.tsx","components/SVGs/Sigmoid-function-2.svg","components/InfoPanels/NodeInfoPanel.tsx","components/InfoPanels/ActivationInfoPanel.tsx","components/InfoPanels/DatasetInfoPanel.tsx","components/NNNode.tsx","components/NeuralNetworkVis.tsx","components/MouseTooltip.tsx","components/InfoPanels/LossInfoPanel.tsx","components/ColourScale.tsx","components/MainPage.tsx","components/UseEventListener.ts","App.tsx","index.tsx"],"names":["ThemeContext","createContext","background","minColour","minColourName","midColour","midColourName","maxColour","maxColourName","ThemeProvider","props","useState","Provider","value","children","LossGraph","d3Container","useRef","initialised","setInitialised","init","width","createGraph","useEffect","updateGraph","dataset","d3","currnet","attr","margin","height","svg","current","selectAll","remove","graph","append","x","range","domain","Math","max","length","comparisionData","minY","Number","MAX_VALUE","maxY","MIN_VALUE","forEach","d","y","min","call","datum","ref","ContainerSection","styled","ComparePage","id","currentState","lossData","savedState","Node","activationFunction","linksIn","linksOut","totalInput","bias","output","outputDerivative","inputDerivative","accInputDererivatives","numInputDerivatives","dw","db","this","i","weight","source","tanh","Infinity","e2x","exp","Activations","SIGMOID","derivative","RELU","TANH","Costs","SQUARE","cost","pow","Link","dest","startWeight","costDer","derAcc","noAccDers","random","forwardPropagate","network","inputs","numLayers","inputLayer","outputlayer","Error","layerNum","currentLayer","updateOutput","backPropagate","costFunction","outputNode","node","j","link","previousLayer","train","learningRate","averageWeightGradient","averageBiasGradient","forEachNode","f","ignoreInputs","getOutputNode","Dataset","normalDistribution","mean","variance","x1","x2","w","sqrt","log","ACTIVATIONS","nn","GENERATORS","GAUSSIAN_2","numSamples","noise","varianceScale","samples","generateGaussianData","cx1","cx2","push","GAUSSIAN_3","XOR","noiseScale","generateUniformData","x1Scale","x2Scale","INPUTS","label","sin","start","config","networkShape","outputActivationFunction","numlayers","inputIds","Object","keys","inputId","numNodes","isInputLayer","nodeId","toString","prevLayer","prevNode","console","constructInputs","constructedInputs","inputName","step","trainingData","batchSize","sample","getCost","data","totalCost","dataPoint","copyNetwork","networkCopy","currentLayerCopy","nodeOriginal","nodeCopy","prevLayerCopy","prevNodeCopy","linkOriginal","linkCopy","BackgroundCanvas","useContext","canvasRef","updateCanvas","decisionBoundary","discreetBoundary","Date","now","tmpScale","disabled","clamp","numShades","colors","map","a","color","canvas","context","getContext","imageData","createImageData","numCells","iter","c","r","g","b","putImageData","className","style","paddingLeft","padding","paddingRight","paddingTop","paddingBottom","NNGraph","scale","canvasWidth","marginLeft","marginRight","marginTop","marginBottom","addFormattedText","text","test","myArray","lastIndex","myRe","exec","prefix","sep","suffix","substring","tickValues","concat","ticks","xAxisText","yAxisText","filteredDataset","filter","p","enter","datapoint","colour","position","StyledDiv","LabeledSlider","defaultValue","currentValue","setCurrentValue","Typography","gutterBottom","Slider","onChange","e","newValue","onChangeCommitted","StyledIconButton","IconButton","HtmlTooltip","Tooltip","InfoButton","interactive","arrow","title","onClick","infoPanel","icon","Info","fontSize","DefaultInfoPanel","src","alt","LearningRateInfoPanel","float","tex","String","raw","StyledLink","DefinedTerm","definition","DefX1","variant","DefX2","NodeInfoPanel","ActivationImg","ActivationInfoPanel","setInfoPanel","sigmoid","DatasetInfoPanel","href","target","NodeContainer","active","nodeWidth","NNNode","HoverCardType","handleOnClick","onMouseOver","handleOnHover","MouseTooltip","offsetX","offsetY","args","setPosition","mouseMoved","setMouseMoved","listenerActive","setListenerActive","addListener","removeListener","visible","getTooltipPosition","event","clientX","clientY","window","addEventListener","removeEventListener","display","top","left","HoverCard","PlusMinusButtonsContainer","GridContainer","Container","Layer","gridArea","LayerControls","FadeCanvas","NeuralNetworkVis","svgContainer","container","linksUpdated","setLinksUpdated","setNetwork","labelsDrawn","setLabelsDrawn","containerBox","setContainerBox","showHoverCard","setShowHoverCard","type","WEIGHT","hoverCardConfig","setHoverCardConfig","hoverTarget","setHoverTarget","updateContainerBox","document","getElementById","updateHovercard","targetId","indexOf","hideHoverCard","drawAllLinks","decisionBoundaries","nodeId2Node","BIAS","linkId2Link","node2Coord","getNodeCoords","drawLink","node2coord","nodeIds","nodeNotDrawnYet","cx","cy","drawLabels","delta","containerCurrent","offsetLeft","offsetTop","nodeElement","input","line","diagonal","linkConfig","weightToSize","size","generateLineConfig","on","transition","duration","ease","viewportOffset","getBoundingClientRect","nodeNum","linkId","splitId","split","fromNodeId","toNodeId","fromNode","overflow","pointerEvents","flexDirection","justifyContent","alignItems","StyledInfoButton","Fragment","removeLayer","addLayer","slice","layer","flexGrow","removeNode","addNode","toFixed","LossInfoPanel","ColourScale","d3ContainerRef","horizontal","createScale","colourScale","tickSize","imageWidth","imageHeight","select","StyledButton","Button","StyledFormControl","FormControl","StyledSelect","Select","StyledLinkButton","LinksDiv","ConfigBar","ControlPanel","NetworkPanel","GraphPanel","StatsBar","InfoPanel","ColouredBox","MainPage","setNumSamples","setNoise","datasetType","setDatasetType","setDataset","setConfig","setDecisionBoundaries","setDecisionBoundary","loss","setLoss","epochs","setEpochs","setDiscreetBoundary","setLossData","training","setTraining","trainingInterval","setTrainingInterval","compareMode","setCompareMode","networkOriginalState","setNetworkOriginalState","infoPanelHistory","setInfoPanelHistory","infoPanelFuture","setInfoPanelFuture","comparisonData","setComaparisonData","toggleAutoTrain","generateNetwork","generateDataset","updateDecisionBoundary","updateDecisionBoundaries","reset","vis","datasetGenerator","newNetwork","newNetworkCopy","density","xDomain","yDomain","boundaries","xScale","yScale","inputNodeIds","boundary","noSteps","clearInterval","setInterval","setInfoPanelWrapper","newInfoPanel","newInfoPanelHistory","InputLabel","MenuItem","Divider","orientation","flexItem","appendValueToLabel","undefined","maxValue","minValue","midValue","networkWidth","networkHeight","newInputs","newNetworkShape","noActiveNodes","pop","right","newInfoPanelFuture","newPanel","unshift","ArrowBackIos","Home","shift","ArrowForwardIos","GitHub","useEventListener","eventName","handler","element","useCapture","savedHandler","targetElement","capture","eventListener","StyledMainPage","StyledComparePage","StyledMargin","AuxContainer","TransitionButton","transitioning","App","mainContainer","createRef","pageState","setPageState","marginAdded","setMarginAdded","marginWidth","setMarginWidth","setTransitioning","setComparisonData","updateButtonPosition","setTimeout","updateContainerSize","maxMarginSize","mainPage","offsetWidth","newMarginWidth","minWidth","comparePage","button","containerRect","pageRect","styles","css","updateComparisionData","querySelectorAll","classList","toggle","ReactDOM","render","StrictMode","StylesProvider","injectFirst"],"mappings":"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","file":"static/js/main.5f206369.chunk.js","sourcesContent":["import React, { useState, createContext } from \"react\";\r\n\r\nexport const ThemeContext = createContext({\r\n    background: \"linear-gradient(207deg, rgba(255,118,97,1) 0%, rgba(34,55,129,1) 100%)\",\r\n    minColour: \"#223781\",\r\n    minColourName: \"blue\",\r\n    midColour: \"#FFFFFF\",\r\n    midColourName: \"white\",\r\n    maxColour: \"#ff7661\",\r\n    maxColourName: \"orange\"\r\n});\r\n\r\ninterface ThemeProps {\r\n    children: React.ReactChild | React.ReactChild[];\r\n}\r\n\r\nexport const ThemeProvider = (props: ThemeProps) => {\r\n    const [theme, setTheme] = useState({\r\n        background: \"linear-gradient(207deg, rgba(255,118,97,1) 0%, rgba(34,55,129,1) 100%)\",\r\n        minColour: \"#223781\",\r\n        minColourName: \"blue\",\r\n        midColour: \"#FFFFFF\",\r\n        midColourName: \"white\",\r\n        maxColour: \"#ff7661\",\r\n        maxColourName: \"orange\"\r\n    })\r\n    \r\n    return(\r\n        <ThemeContext.Provider value={{\r\n            background: \"linear-gradient(207deg, rgba(255,118,97,1) 0%, rgba(34,55,129,1) 100%)\",\r\n            minColour: \"#223781\",\r\n            minColourName: \"blue\",\r\n            midColour: \"#FFFFFF\",\r\n            midColourName: \"white\",\r\n            maxColour: \"#ff7661\",\r\n            maxColourName: \"orange\"\r\n        }}>\r\n            {props.children}\r\n        </ThemeContext.Provider>\r\n    );\r\n}","import React, { useEffect, useState, useRef } from 'react';\r\nimport * as d3 from 'd3';\r\nimport { Dataset2D } from '../datasets';\r\nimport BackgroundCanvas from './BackgroundCanvas';\r\n\r\nexport type LossData = {\r\n    epoch: number;\r\n    trainingLoss: number;\r\n}\r\n\r\ninterface GraphProps {\r\n    dataset: [number, number][];\r\n    comparisionData?: [number, number][];\r\n    width: number;\r\n    height: number;\r\n    margin: number;\r\n    // xDomain: number[];\r\n    // yDomain: number[];\r\n}\r\n\r\n\r\nfunction LossGraph(props: GraphProps) {\r\n\r\n    const d3Container: any = useRef<any>(null);\r\n    const [initialised, setInitialised] = useState<boolean>(false);\r\n\r\n    let scale = props.width / 16;\r\n\r\n\r\n    const init = () => {\r\n        // console.log(\"LossGraph init\")\r\n\r\n        createGraph();\r\n        setInitialised(true);\r\n    }\r\n\r\n    useEffect(() => {\r\n        init()\r\n    }, []);\r\n\r\n\r\n    useEffect(() => {\r\n        if (!initialised) {\r\n            init()\r\n        } else {\r\n            updateGraph()\r\n\r\n        }\r\n    }, [props.dataset]);\r\n\r\n\r\n    const createGraph = () => {\r\n        // console.log(\"Creating loss graph\")\r\n\r\n        let svg = d3.select(d3Container.currnet)\r\n\r\n        svg.attr('width', props.width + props.margin * 2)\r\n            .attr('height', props.height + props.margin * 2)\r\n\r\n    }\r\n\r\n    const updateGraph = () => {\r\n        // console.log(\"Updating loss graph\")\r\n        // console.log(props.dataset)\r\n        const svg = d3.select(d3Container.current)\r\n\r\n        svg.selectAll(`.loss-graph`).remove();\r\n\r\n        const graph = svg.append('g')\r\n            .attr(\"class\", `loss-graph`)\r\n            .attr('transform', `translate(${props.margin}, ${props.margin})`);\r\n\r\n        const x = d3.scaleLinear()\r\n            .range([0, props.width])\r\n            .domain([1, Math.max(props.dataset.length, props.comparisionData?.length || 0)]);\r\n\r\n        let minY = Number.MAX_VALUE;\r\n        let maxY = Number.MIN_VALUE;\r\n\r\n        props.dataset.forEach((d: [number, number]) => {\r\n            let y = d[1];\r\n            minY = Math.min(minY, y);\r\n            maxY = Math.max(maxY, y);\r\n        });\r\n\r\n        if (props.comparisionData) {\r\n            props.comparisionData.forEach((d: [number, number]) => {\r\n                let y = d[1];\r\n                minY = Math.min(minY, y);\r\n                maxY = Math.max(maxY, y);\r\n            });\r\n        }\r\n\r\n        const y = d3.scaleLinear()\r\n            .range([props.height, 0])\r\n            .domain([minY, maxY]);\r\n\r\n        graph.append('g')\r\n            .attr(\"class\", `axis`)\r\n            .attr('transform', `translate(0,${props.height})`)\r\n            .call(d3.axisBottom(x));\r\n\r\n        graph.append('g')\r\n            .attr(\"class\", `axis`)\r\n            .call(d3.axisLeft(y));\r\n\r\n\r\n        let index = 1;\r\n        graph.append(\"path\")\r\n            .datum(props.dataset)\r\n            .attr(\"fill\", \"none\")\r\n            .attr(\"stroke\", \"#606060\")\r\n            .attr(\"stroke-width\", 1.5)\r\n            .attr(\"d\", d3.line()\r\n                .x((d: [number, number]) => x(d[0]) || 0)\r\n                .y((d: [number, number]) => y(d[1]) || 0))\r\n\r\n        if (props.comparisionData) {\r\n            graph.append(\"path\")\r\n                .datum(props.comparisionData)\r\n                .attr(\"fill\", \"none\")\r\n                .attr(\"stroke\", \"red\")\r\n                .attr(\"stroke-width\", 1.5)\r\n                .attr(\"d\", d3.line()\r\n                    .x((d: [number, number]) => x(d[0]) || 0)\r\n                    .y((d: [number, number]) => y(d[1]) || 0))\r\n        }\r\n    }\r\n\r\n    return (\r\n        <svg\r\n            ref={d3Container}\r\n            width={props.width + props.margin * 2}\r\n            height={props.height + props.margin * 2}\r\n        //style={{ position: \"absolute\" }}\r\n        />\r\n    );\r\n}\r\n\r\nexport default LossGraph;","import styled from \"@emotion/styled\";\r\nimport React from \"react\";\r\nimport LossGraph from \"./LossGraph\";\r\nimport { NetworkState } from \"./MainPage\";\r\n\r\n\r\nconst ContainerSection = styled(\"div\")`\r\n    -webkit-box-sizing: border-box; /* Safari/Chrome, other WebKit */\r\n    -moz-box-sizing: border-box;    /* Firefox, other Gecko */\r\n    box-sizing: border-box; \r\n    background-color: white;\r\n    margin: 30px auto;\r\n    min-width: 800px;\r\n    width: auto;\r\n    max-width: 80vw;\r\n    height: 80vh;\r\n    padding: 30px;\r\n    border-radius: 30px;\r\n    border: 2px solid #bdbdbd;\r\n    display: flex;\r\n    flex-direction: row;\r\n    justify-content: center;\r\n`;\r\n\r\ninterface PageProps {\r\n    savedState?: NetworkState;\r\n    currentState?: NetworkState;\r\n}\r\n\r\nfunction ComparePage(props: PageProps) {\r\n\r\n    return(\r\n        <ContainerSection id=\"compare-page\">\r\n\r\n            {props.currentState && <LossGraph\r\n                height={60}\r\n                width={170}\r\n                margin={5}\r\n                dataset={props.currentState.lossData}\r\n                comparisionData={props.savedState?.lossData}/> }\r\n        </ContainerSection>\r\n    );\r\n}\r\n\r\nexport default ComparePage;","\r\n/** Represents a node in the neural network. */\r\nexport class Node {\r\n\r\n    // Standardise no and num usage\r\n\r\n    // Refactor to init variables in the constructor\r\n\r\n    id: string;\r\n    /** AKA phi(x) */\r\n    activationFunction: ActivationFunction;\r\n\r\n    linksIn: Link[] = [];\r\n    linksOut: Link[] = [];\r\n\r\n    /** AKA z = phi(a) */\r\n    totalInput: number = 0.0;\r\n\r\n    /** AKA b */\r\n    bias: number = 0.1;\r\n    /** AKA a */\r\n    output: number = 0.0;\r\n\r\n    /** AKA dc/da */\r\n    outputDerivative: number = 0.0;\r\n    /** AKA delta */\r\n    inputDerivative: number = 0.0;\r\n\r\n    /** Sum of input derivatives over multiple backpropagation iterations to be used for avarage\r\n     * when carring out gradient decent\r\n     */\r\n    accInputDererivatives: number = 0.0;\r\n    /** Number of derivatives accumulated, used to calculate average dc/db for gradient decent */\r\n    numInputDerivatives: number = 0.0;\r\n\r\n    /** AKA dc/dw = delta^l . a^l-1 */\r\n    dw: number = 0;\r\n    /** AKA dc/db =  delta^l */\r\n    db: number = 0;\r\n\r\n    constructor(id: string, activationFunction: ActivationFunction) {\r\n        this.id = id;\r\n        this.activationFunction = activationFunction;\r\n    }\r\n\r\n    // Figure out what happens for input layer (maybe make sure this doesn't get called)\r\n    updateOutput(): number {\r\n        //let prevOutput = this.output;\r\n        this.totalInput = this.bias;\r\n        for (let i = 0; i < this.linksIn.length; i++) {\r\n            this.totalInput += this.linksIn[i].weight * this.linksIn[i].source.output;\r\n        }\r\n\r\n        this.output = this.activationFunction.output(this.totalInput);\r\n        //(console.log(`Node ${this.id}: Updated output from ${prevOutput} to ${this.output} diff = ${this.output - prevOutput}`))\r\n        return this.output;\r\n    }\r\n}\r\n\r\nexport interface ActivationFunction {\r\n    output: (x: number) => number;\r\n    derivative: (input: number) => number;\r\n}\r\n\r\n/** Also known as an error or loss function. */\r\nexport interface CostFunction {\r\n    cost: (output: number, y: number) => number;\r\n    derivative: (output: number, y: number) => number;\r\n}\r\n\r\n/** Polyfill for TANH */\r\n(Math as any).tanh = (Math as any).tanh || function (x: number) {\r\n    if (x === Infinity) {\r\n        return 1;\r\n    } else if (x === -Infinity) {\r\n        return -1;\r\n    } else {\r\n        let e2x = Math.exp(2 * x);\r\n        return (e2x - 1) / (e2x + 1);\r\n    }\r\n};\r\n\r\n\r\n/** Built in activation functions */\r\nexport class Activations {\r\n    public static SIGMOID: ActivationFunction = {\r\n        output: (x: number) => 1.0 / (1.0 + Math.exp(-x)), // Check that this evaluates to higher than 1 d.p.\r\n        derivative: (x: number) => {\r\n            let output = Activations.SIGMOID.output(x);\r\n            return output * (1.0 - output)\r\n        }\r\n    };\r\n    public static RELU: ActivationFunction = {\r\n        output: (x: number) => Math.max(0, x),\r\n        derivative: (x: number) => x > 0 ? 1 : 0\r\n    };\r\n    // Might need to polyfill not TANH implementation for +/- inf values if Math.tah doesn't exist\r\n    public static TANH: ActivationFunction = {\r\n        // output: (x: number) => Math.tanh(x),\r\n        output: (x: number) => (Math as any).tanh(x),\r\n        derivative: (x: number) => {\r\n            let output = Activations.TANH.output(x);\r\n            return 1 - output * output;\r\n        }\r\n    }\r\n}\r\n\r\n/** Built in cost functions (Only using SQUARE for now) */\r\nexport class Costs {\r\n    public static SQUARE: CostFunction = {\r\n        cost: (output: number, y: number) => 0.5 * Math.pow(output - y, 2),\r\n        derivative: (output: number, y: number) => output - y\r\n    }\r\n}\r\n\r\n/** \r\n * Links Nodes together and carries the weight associated with the connected nodes\r\n * (for now weights are initialised to 0)\r\n */\r\nexport class Link {\r\n    /** Linked node in the previous layer. */\r\n    source: Node;\r\n    /** Linked node in the next layer. */\r\n    dest: Node;\r\n\r\n    /** Weight associated to this link.\r\n     *  AKA w\r\n     */\r\n    weight: number;\r\n    /** current cost derivative */\r\n    costDer: number;\r\n    /** Accumulated derivatives */\r\n    derAcc: number;\r\n    /** Number of accumulated derivatives */\r\n    noAccDers: number;\r\n\r\n    // Careful of copying a network while acc values aren't zero\r\n    constructor(source: Node, dest: Node, startWeight?: number) {\r\n        this.source = source;\r\n        this.dest = dest;\r\n        this.weight = startWeight ? startWeight : Math.random() - 0.5;\r\n        this.costDer = 0.0;\r\n        this.derAcc = 0.0;\r\n        this.noAccDers = 0.0;\r\n    }\r\n}\r\n\r\n/**\r\n * Builds a neural network. \r\n * (Currently without any differing output activation or regularization)\r\n * @param networkShape The shape of a network where each value in the list\r\n *      represents the number of neurons in the respective layer.\r\n * @param activationFunction The activation function for the ouput of each node.\r\n * @param inputIds List of ids for the input nodes.\r\n */\r\nexport function generateNetwork(\r\n    networkShape: number[],\r\n    activationFunction: ActivationFunction,\r\n    outputActivationFunction: ActivationFunction,\r\n    inputs: { [id: string]: boolean },\r\n): Node[][] {\r\n    let numlayers = networkShape.length;\r\n    let network: Node[][] = [];\r\n\r\n    let inputIds: string[] = [];\r\n    Object.keys(inputs).forEach((inputId) => {\r\n        if (inputs[inputId]) inputIds.push(inputId);\r\n    });\r\n\r\n    let id = 1;\r\n    // console.log(inputIds)\r\n    for (let layerNum = 0; layerNum < numlayers; layerNum++) {\r\n        let currentLayer: Node[] = [];\r\n\r\n        network.push(currentLayer);\r\n\r\n        let numNodes = networkShape[layerNum];\r\n        let isInputLayer = layerNum === 0;\r\n\r\n        for (let i = 0; i < numNodes; i++) {\r\n            let nodeId = isInputLayer ? inputIds[i] : (id++).toString();\r\n            let isOutputNode = layerNum === numlayers - 1 && i === 0;\r\n            let node = new Node(nodeId, isOutputNode ? outputActivationFunction : activationFunction);\r\n            currentLayer.push(node);\r\n\r\n            if (!isInputLayer) {\r\n                // Link nodes from previous layer\r\n                let prevLayer = network[layerNum - 1]\r\n                for (let j = 0; j < prevLayer.length; j++) {\r\n                    let prevNode = prevLayer[j];\r\n                    let link = new Link(prevNode, node);\r\n                    prevNode.linksOut.push(link);\r\n                    node.linksIn.push(link);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    return network;\r\n}\r\n\r\nexport function forwardPropagate(network: Node[][], inputs: number[]): number {\r\n    let numLayers = network.length;\r\n    let inputLayer = network[0];\r\n    let outputlayer = network[numLayers - 1];\r\n\r\n    if (inputLayer.length !== inputs.length) {\r\n        // Check the number of inputs is equal to the number of nodes in the first layer\r\n        throw new Error(\"Then number of inputs should equal the number of input neurons\");\r\n    }\r\n\r\n    for (let i = 0; i < inputLayer.length; i++) {\r\n        let node = inputLayer[i];\r\n        node.output = inputs[i];\r\n    }\r\n\r\n    for (let layerNum = 1; layerNum < numLayers; layerNum++) {\r\n        let currentLayer = network[layerNum];\r\n        for (let i = 0; i < currentLayer.length; i++) {\r\n            let node = currentLayer[i];\r\n            node.updateOutput();\r\n        }\r\n    }\r\n\r\n    return outputlayer[0].output;\r\n}\r\n\r\n/**\r\n * Back propagation algorithm.\r\n * @param network The neural network to run backprogation on.\r\n * @param costFunction The cost function used to determing how well the neural network performs.\r\n * @param y The expected out put of the neural network.\r\n */\r\nexport function backPropagate(network: Node[][], costFunction: CostFunction, y: number): void {\r\n\r\n    // Special Case: Last Layer (Single output node) /////////////////////////////////////////\r\n\r\n    let outputNode = network[network.length - 1][0];\r\n\r\n    // outputDerivative = dc/da\r\n    outputNode.outputDerivative = costFunction.derivative(outputNode.output, y);\r\n\r\n    // General Case: Hidden Layers //////////////////////////////////////////////////////////\r\n\r\n    for (let layerNum = network.length - 1; layerNum > 0; layerNum--) {\r\n        let currentLayer = network[layerNum];\r\n\r\n        // Parse through nodes and calculate input derivatives\r\n        for (let i = 0; i < currentLayer.length; i++) {\r\n            let node = currentLayer[i];\r\n\r\n            // Calculate input derivative for current node\r\n            // inputDerivative = dc/dz = dc/da . phi_d(z)\r\n            node.inputDerivative = node.outputDerivative * node.activationFunction.derivative(node.totalInput);\r\n\r\n            // For average in gradient decent\r\n            // dc/db for the bias on the current node\r\n            node.accInputDererivatives += node.inputDerivative;\r\n            node.numInputDerivatives++;\r\n\r\n        }\r\n\r\n        // Parse through nodes again to calculate weight derivative for link\r\n        for (let i = 0; i < currentLayer.length; i++) {\r\n            let node = currentLayer[i];\r\n            // dc/dw for each weight comming in\r\n            for (let j = 0; j < node.linksIn.length; j++) {\r\n                let link = node.linksIn[j];\r\n\r\n                link.costDer = link.source.output * node.inputDerivative;\r\n                link.derAcc += link.costDer;\r\n                link.noAccDers++;\r\n            }\r\n        }\r\n\r\n        // Don't bother computing ouput derivatives for input nodes (Saves on compuiation)\r\n        if (layerNum === 1) continue;\r\n\r\n        // Parse through the previous layer and calculate output derivative all the nodes\r\n        let previousLayer = network[layerNum - 1];\r\n        for (let i = 0; i < previousLayer.length; i++) {\r\n            let node = previousLayer[i];\r\n            // Compute the error derivative with respect to each node's output.\r\n            node.outputDerivative = 0;\r\n            for (let j = 0; j < node.linksOut.length; j++) {\r\n                let link = node.linksOut[j];\r\n                node.outputDerivative += link.dest.inputDerivative * link.weight;\r\n            }\r\n        }\r\n    }\r\n\r\n}\r\n\r\n/**\r\n * \r\n * @param network \r\n * @param trainingData \r\n * @param costFunction \r\n * @param learningRate The hyperparameter that determines how much weights a biases change on each iteration (AKA epsilon)\r\n */\r\nexport function train(network: Node[][], learningRate: number) {\r\n\r\n    for (let layerNum = 1; layerNum < network.length; layerNum++) {\r\n\r\n        let currentLayer = network[layerNum];\r\n\r\n        for (let i = 0; i < currentLayer.length; i++) {\r\n            let node = currentLayer[i];\r\n\r\n            for (let j = 0; j < node.linksIn.length; j++) {\r\n                let link = node.linksIn[j];\r\n\r\n                if (link.noAccDers > 0) {\r\n                    let averageWeightGradient = link.derAcc / link.noAccDers;\r\n                    link.weight = link.weight - (learningRate * averageWeightGradient);\r\n\r\n                    link.derAcc = 0;\r\n                    link.noAccDers = 0;\r\n                }\r\n            }\r\n            if (node.numInputDerivatives > 0) {\r\n                let averageBiasGradient = node.accInputDererivatives / node.numInputDerivatives;\r\n\r\n                node.bias = node.bias - (learningRate * averageBiasGradient);\r\n\r\n                node.accInputDererivatives = 0;\r\n                node.numInputDerivatives = 0;\r\n            }\r\n\r\n        }\r\n    }\r\n}\r\n\r\nexport function forEachNode(network: Node[][], f: (node: Node) => void, ignoreInputs?: boolean): void {\r\n    for (let layerNum = ignoreInputs ? 1 : 0; layerNum < network.length; layerNum++) {\r\n        let currentLayer = network[layerNum];\r\n        for (let i = 0; i < currentLayer.length; i++) {\r\n            f(currentLayer[i]);\r\n        }\r\n    }\r\n}\r\n\r\nexport function getOutputNode(network: Node[][]): Node {\r\n    return network[network.length - 1][0];\r\n}\r\n\r\nexport function copyNetwork(network: Node[][]): Node[][] {\r\n    let networkCopy: Node[][] = [];\r\n    \r\n    for (let layerNum = 0; layerNum < network.length; layerNum++) {\r\n        let currentLayerCopy: Node[] = [];\r\n\r\n        networkCopy.push(currentLayerCopy);\r\n\r\n        let isInputLayer = layerNum === 0;\r\n\r\n        for (let i = 0; i < network[layerNum].length; i++) {\r\n            let nodeOriginal = network[layerNum][i];\r\n            let nodeCopy = new Node(nodeOriginal.id, nodeOriginal.activationFunction);\r\n            currentLayerCopy.push(nodeCopy);\r\n\r\n            if (!isInputLayer) {\r\n                let prevLayerCopy = networkCopy[layerNum - 1]\r\n                for (let j = 0; j < prevLayerCopy.length; j++) {\r\n                    let prevNodeCopy = prevLayerCopy[j];\r\n\r\n                    let linkOriginal = nodeOriginal.linksIn[j];\r\n\r\n                    let linkCopy = new Link(prevNodeCopy, nodeCopy, linkOriginal.weight);\r\n                    prevNodeCopy.linksOut.push(linkCopy);\r\n                    nodeCopy.linksIn.push(linkCopy);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    return networkCopy;\r\n}","import * as d3 from \"d3\";\r\n\r\n\r\nexport type Dataset2D = {\r\n    x1: number,\r\n    x2: number,\r\n    y: number\r\n};\r\n\r\nexport type DatasetGenerator = (numSamples: number, noise: number) => Dataset2D[];\r\n\r\n\r\nexport class Dataset {\r\n\r\n    public static GAUSSIAN_2: DatasetGenerator = (numSamples, noise) => {\r\n        // When noise = 0, variance = 0.5 and when noise = 1, variance = 8\r\n        let varianceScale = d3.scaleLinear().domain([0, .5]).range([0.5, 4]); // Arbitrary\r\n        let variance = varianceScale(noise) || 0;\r\n        let samples: Dataset2D[] = [];\r\n\r\n        /**\r\n         * Generate a gaussian dataset with centre point (/mean) at cx, cy\r\n         * @param cx Mean of distribution along x\r\n         * @param cy Mean of distribution along y\r\n         * @param variance Variance of distribution\r\n         */\r\n        function generateGaussianData(cx1: number, cx2: number, y: number) {\r\n            // Workiung with an -8, 8 grid non-variable for the forseeable future\r\n            for (let i = 0; i < numSamples / 2; i++) {\r\n                let x1 = normalDistribution(cx1, variance);\r\n                let x2 = normalDistribution(cx2, variance);\r\n                samples.push({ x1: x1, x2: x2, y: y });\r\n            }\r\n        }\r\n\r\n        // Generate two sets of gauss distributed data with mean at points (-3, -3) and (3, 3) each with \r\n        generateGaussianData(-3, -3, -1);\r\n        generateGaussianData(3, 3, 1);\r\n\r\n        return samples;\r\n    }\r\n\r\n    public static GAUSSIAN_3: DatasetGenerator = (numSamples, noise) => {\r\n        let varianceScale = d3.scaleLinear().domain([0, .5]).range([0.5, 4]); // Arbitrary\r\n        let variance = varianceScale(noise) || 0;\r\n        let samples: Dataset2D[] = [];\r\n\r\n        /**\r\n         * Generate a gaussian dataset with centre point (/mean) at cx, cy\r\n         * @param cx Mean of distribution along x\r\n         * @param cy Mean of distribution along y\r\n         * @param variance Variance of distribution\r\n         */\r\n        function generateGaussianData(cx1: number, cx2: number, y: number) {\r\n            // Workiung with an -8, 8 grid non-variable for the forseeable future\r\n            for (let i = 0; i < numSamples / 3; i++) {\r\n                let x1 = normalDistribution(cx1, variance);\r\n                let x2 = normalDistribution(cx2, variance);\r\n                samples.push({ x1: x1, x2: x2, y: y });\r\n            }\r\n        }\r\n\r\n        // Generate two sets of gauss distributed data with mean at points (-3, -3) and (3, 3) each with \r\n        generateGaussianData(-4, -4, -1);\r\n        generateGaussianData(0, 0, 1);\r\n        generateGaussianData(4, 4, -1);\r\n\r\n        return samples;\r\n    }\r\n\r\n    public static XOR: DatasetGenerator = (numSamples, noise) => {\r\n        let noiseScale = d3.scaleLinear().domain([0, 1]).range([-0.5, 0.5]);\r\n        let samples: Dataset2D[] = [];\r\n        function generateUniformData(cx1: number, cx2: number, width: number, height: number, y: number) {\r\n            let x1Scale = d3.scaleLinear().domain([0, 1]).range([cx1 - (width / 2), cx1 + (width / 2)]);\r\n            let x2Scale = d3.scaleLinear().domain([0, 1]).range([cx2 - (height / 2), cx2 + (height / 2)]);\r\n            for (let i = 0; i < numSamples / 4; i++) {\r\n                let x1 = x1Scale(Math.random() + (noiseScale(Math.random()) || 0) * noise) || 0;\r\n                let x2 = x2Scale(Math.random() + (noiseScale(Math.random()) || 0) * noise) || 0;\r\n                samples.push({ x1: x1, x2: x2, y: y });\r\n            }\r\n        }\r\n\r\n        generateUniformData(-8 / 2, 8 / 2, 8, 8, 1);     // Top left +1\r\n        generateUniformData(8 / 2, 8 / 2, 8, 8, -1);     // Top right -1\r\n        generateUniformData(-8 / 2, -8 / 2, 8, 8, -1);   // Bottom left -1\r\n        generateUniformData(8 / 2, -8 / 2, 8, 8, 1);     // Bottom right +1\r\n\r\n        return samples;\r\n    }\r\n}\r\n\r\n\r\n/**\r\n * Function to randomly generate a point in the normal distribution described by\r\n * the mean and variance parameters, using the Box-Muller transform\r\n * @param mean the mean or mu to describe the normal(/gaussian) distribution\r\n * @param variance The variance or sigma squared to describe the normal(/gaussian) distribution\r\n */\r\nfunction normalDistribution(mean: number, variance: number): number {\r\n    let x1, x2, y, w: number;\r\n\r\n    mean = mean || 0;\r\n    variance = variance || 1;\r\n\r\n    do {\r\n        x1 = 2 * Math.random() - 1;\r\n        x2 = 2 * Math.random() - 1;\r\n        w = x1 * x1 + x2 * x2;\r\n    } while (w > 1);\r\n\r\n    y = Math.sqrt(-2 * Math.log(w) / w) * x1;\r\n\r\n    return mean + Math.sqrt(variance) * y;\r\n}","import * as nn from \"./NeuralNet\";\r\nimport { Dataset2D, DatasetGenerator, Dataset } from \"./datasets\";\r\nimport { NNConfig } from \"./components/MainPage\";\r\nimport * as d3 from \"d3\";\r\nimport seedrandom from \"seedrandom\";\r\n\r\n\r\ninterface InputFunc {\r\n    f: (x: number, y: number) => number;\r\n    label: string;\r\n}\r\n\r\nlet ACTIVATIONS: { [name: string]: nn.ActivationFunction } = {\r\n    \"Tanh\": nn.Activations.TANH,\r\n    \"ReLU\": nn.Activations.RELU,\r\n    \"Sigmoid\": nn.Activations.SIGMOID,\r\n}\r\n\r\nlet GENERATORS: { [datasetType: string]: DatasetGenerator } = {\r\n    \"Gaussian2\": Dataset.GAUSSIAN_2,\r\n    \"Gaussian3\": Dataset.GAUSSIAN_3,\r\n    \"XOR\": Dataset.XOR,\r\n}\r\n\r\n\r\nexport let INPUTS: { [name: string]: InputFunc } = {\r\n    \"x\": { f: (x, y) => x, label: \"X_1\" },\r\n    \"y\": { f: (x, y) => y, label: \"X_2\" },\r\n    \"xSquared\": { f: (x, y) => x * x, label: \"X_1^2\" },\r\n    \"ySquared\": { f: (x, y) => y * y, label: \"X_2^2\" },\r\n    \"xTimesY\": { f: (x, y) => x * y, label: \"X_1X_2\" },\r\n    \"sinX\": { f: (x, y) => Math.sin(x), label: \"sin(X_1)\" },\r\n    \"sinY\": { f: (x, y) => Math.sin(y), label: \"sin(X_2)\" },\r\n};\r\n\r\n\r\nexport function start(config: NNConfig): nn.Node[][] {\r\n    let network = nn.generateNetwork(config.networkShape, ACTIVATIONS[config.activationFunction], nn.Activations.TANH, config.inputs);\r\n    console.log(network);\r\n\r\n    return network;\r\n}\r\n\r\nexport function getDataset(datasetType: string, numSamples: number, noise: number) {\r\n    let datasetGenerator = GENERATORS[datasetType];\r\n    let dataset = datasetGenerator(numSamples, noise);\r\n    // console.log(dataset);\r\n    return dataset;\r\n}\r\n\r\nexport function constructInputs(x: number, y: number, inputs: { [key: string]: boolean }): number[] {\r\n    let constructedInputs: number[] = [];\r\n    for (let inputName in INPUTS) {\r\n        if (inputs[inputName]) constructedInputs.push(INPUTS[inputName].f(x, y))\r\n    }\r\n    // console.log(\"X:\" + x + \" Y:\"+ y)\r\n    // console.log(constructedInputs)\r\n    return constructedInputs;\r\n\r\n}\r\n\r\nexport function step(network: nn.Node[][], trainingData: Dataset2D[], learningRate: number, inputs: { [key: string]: boolean }, batchSize: number): void {\r\n    for (let i = 0; i < trainingData.length; i++) {\r\n        let sample = trainingData[i];\r\n        nn.forwardPropagate(network, constructInputs(sample.x1, sample.x2, inputs));\r\n        nn.backPropagate(network, nn.Costs.SQUARE, sample.y);\r\n        if ((i + 1) % batchSize === 0) nn.train(network, learningRate);\r\n    }\r\n\r\n}\r\n\r\nexport function getCost(network: nn.Node[][], data: Dataset2D[], inputs: { [key: string]: boolean }/* , costFunction: nn.CostFunction */): number {\r\n    let totalCost = 0;\r\n    for (let i = 0; i < data.length; i++) {\r\n        let dataPoint = data[i];\r\n        totalCost += nn.Costs.SQUARE.cost(nn.forwardPropagate(network, constructInputs(dataPoint.x1, dataPoint.x2, inputs)), dataPoint.y);\r\n    }\r\n\r\n    return totalCost / data.length;\r\n}\r\n\r\nexport function copyNetwork(network: nn.Node[][]): nn.Node[][] {\r\n    return nn.copyNetwork(network);\r\n}\r\n\r\nexport function getOutputDecisionBoundary(network: nn.Node[][], density: number, xDomain: number[], yDomain: number[], inputs: { [key: string]: boolean }): Dataset2D[] {\r\n\r\n    let xScale = d3.scaleLinear().domain([0, density]).range(xDomain);\r\n    let yScale = d3.scaleLinear().domain([density, 0]).range(yDomain);\r\n    let boundary: Dataset2D[] = [];\r\n\r\n    for (let i = 0; i < density; i++) {\r\n        for (let j = 0; j < density; j++) {\r\n            let x = xScale(j);\r\n            let y = yScale(i);\r\n\r\n            let input = constructInputs(x || 0, y || 0, inputs);\r\n            nn.forwardPropagate(network, input);\r\n\r\n            let dataPoint: Dataset2D = { x1: x || 0, x2: y || 0, y: nn.getOutputNode(network).output }\r\n\r\n            boundary.push(dataPoint);\r\n        }\r\n    }\r\n\r\n    return boundary;\r\n}\r\n\r\nexport function getOutputDecisionBoundary1D(network: nn.Node[][], density: number, xDomain: number[], yDomain: number[], inputs: { [key: string]: boolean }): number[] {\r\n\r\n    let xScale = d3.scaleLinear().domain([0, density]).range(xDomain);\r\n    let yScale = d3.scaleLinear().domain([density, 0]).range(yDomain);\r\n    let boundary: number[] = [];\r\n    let iter = 0;\r\n\r\n    for (let i = 0; i < density; i++) {\r\n        for (let j = 0; j < density; j++) {\r\n            let x = xScale(j);\r\n            let y = yScale(i);\r\n\r\n            let input = constructInputs(x || 0, y || 0, inputs);\r\n            nn.forwardPropagate(network, input);\r\n\r\n            boundary[iter++] = nn.getOutputNode(network).output;\r\n        }\r\n    }\r\n\r\n    return boundary;\r\n}\r\n\r\nexport function getAllDecisionBoundaries(network: nn.Node[][], density: number, xDomain: number[], yDomain: number[], inputs: { [key: string]: boolean }): { [nodeId: string]: number[] } {\r\n    let boundaries: { [nodeId: string]: number[] } = {};\r\n\r\n    let xScale = d3.scaleLinear().domain([0, density]).range(xDomain);\r\n    let yScale = d3.scaleLinear().domain([density, 0]).range(yDomain);\r\n    let iter = 0;\r\n\r\n    let inputNodeIds = Object.keys(INPUTS);\r\n\r\n    for (let i = 0; i < density; i++) {\r\n        for (let j = 0; j < density; j++) {\r\n            let x = xScale(j);\r\n            let y = yScale(i);\r\n\r\n            let input = constructInputs(x || 0, y || 0, inputs);\r\n            nn.forwardPropagate(network, input);\r\n            nn.forEachNode(network, (node: nn.Node) => {\r\n                if (!boundaries[node.id]) boundaries[node.id] = [];\r\n                boundaries[node.id][iter] = node.output;\r\n            })\r\n            inputNodeIds.forEach((nodeId) => {\r\n                if (!boundaries[nodeId]) boundaries[nodeId] = [];\r\n                boundaries[nodeId][iter] = INPUTS[nodeId].f(x || 0, y || 0);\r\n            })\r\n            iter++;\r\n            //boundary[iter++] = nn.getOutputNode(network).output;\r\n        }\r\n    }\r\n\r\n    return boundaries;\r\n\r\n}\r\n\r\n","import * as d3 from \"d3\";\r\nimport React, { useContext, useEffect, useRef } from \"react\";\r\nimport { ThemeContext } from \"../contexts/ThemeContext\";\r\n\r\n\r\ninterface CanvasProps {\r\n    id?: string;\r\n    width: number;\r\n    height: number;\r\n    numCells: number;\r\n    numShades?: number;\r\n    padding: boolean;\r\n    decisionBoundary?: number[];\r\n    discreetBoundary: boolean;\r\n    disabled: boolean;\r\n    paddingLeft?: number;\r\n    paddingRight?: number;\r\n    paddingTop?: number;\r\n    paddingBottom?: number;\r\n}\r\n\r\n\r\nfunction BackgroundCanvas(props: CanvasProps) {\r\n    const {minColour, midColour, maxColour} = useContext(ThemeContext);\r\n\r\n    const canvasRef = useRef<HTMLCanvasElement>(null);\r\n\r\n    useEffect(() => {\r\n        //console.log(`BackgroundCanvas decisionBoundary useEffect`);\r\n        updateCanvas();\r\n    }, [props.decisionBoundary, props.discreetBoundary]);\r\n    \r\n    const updateCanvas = () => {\r\n\r\n        //console.log(\"Update canvas\");\r\n\r\n        let start = Date.now();\r\n\r\n        let tmpScale = d3.scaleLinear<string, number>()\r\n            .domain([0, 0.5, 1])\r\n            .range(props.disabled ? [\"#606060\", \"#FFFFFF\", \"#202020\" ] : [minColour, midColour, maxColour])\r\n            .clamp(true);\r\n\r\n        let numShades = props.numShades || 100;\r\n\r\n        let colors = d3.range(0, 1 + 1E-9, 1 / numShades).map(a => {\r\n            return tmpScale(a) || 0;\r\n        });\r\n\r\n        let color: any = d3.scaleQuantize()\r\n            .domain([-1, 1])\r\n            .range(colors);\r\n\r\n        const canvas = canvasRef.current;\r\n        const context = canvas?.getContext(\"2d\");\r\n        if(!props.decisionBoundary || !context) return;\r\n        let imageData = context.createImageData(props.numCells, props.numCells);\r\n\r\n        if(!imageData) return;\r\n\r\n        const data = imageData.data;\r\n        let iter = -1;\r\n\r\n        for(let i = 0; i < props.decisionBoundary.length; i++) {\r\n            let value: number = props.decisionBoundary[i];\r\n            if(props.discreetBoundary) value = value > 0 ? 1 : -1;\r\n            let c = d3.rgb(color(value));\r\n            data[++iter] = c.r;\r\n            data[++iter] = c.g;\r\n            data[++iter] = c.b;\r\n            data[++iter] = 200;\r\n        }\r\n        context.putImageData(imageData, 0, 0);\r\n\r\n        let delta = Date.now() - start;\r\n        //console.log(`Finsihed updating canvas (Duration: ${delta}ms)`);\r\n    };\r\n\r\n    return (\r\n        <canvas\r\n            ref={canvasRef}\r\n            id={props.id}\r\n            className=\"background\"\r\n            width={props.numCells}\r\n            height={props.numCells}\r\n            style={{\r\n                width: `${props.width}px`,\r\n                height: `${props.height}px`,\r\n                paddingLeft: `${props.padding && props.paddingLeft ? props.paddingLeft : \"0\"}px`,\r\n                paddingRight: `${props.padding && props.paddingRight ? props.paddingRight : \"0\"}px`,\r\n                paddingTop: `${props.padding && props.paddingTop ? props.paddingTop: \"0\"}px`,\r\n                paddingBottom: `${props.padding && props.paddingBottom ? props.paddingBottom : \"0\"}px`,\r\n            }}\r\n        />);\r\n}\r\n\r\nexport default BackgroundCanvas;","import React, { useEffect, useState, useRef, useContext } from \"react\";\r\nimport * as d3 from \"d3\";\r\nimport { Dataset2D } from \"../datasets\";\r\nimport BackgroundCanvas from \"./BackgroundCanvas\";\r\nimport { ThemeContext } from \"../contexts/ThemeContext\";\r\n\r\ninterface GraphProps  {\r\n    dataset: Dataset2D[];\r\n    density: number;\r\n    canvasWidth: number;\r\n\r\n    marginLeft: number;\r\n    marginRight: number;\r\n    marginTop: number;\r\n    marginBottom: number;\r\n    numCells: number;\r\n    xDomain: number[];\r\n    yDomain: number[];\r\n    decisionBoundary?: number[];\r\n    discreetBoundary: boolean;\r\n}\r\n\r\n\r\nfunction NNGraph(props: GraphProps): JSX.Element {\r\n\r\n    const {minColour, maxColour} = useContext(ThemeContext);\r\n\r\n    const d3Container: any = useRef<any>(null);\r\n\r\n    const [initialised, setInitialised] = useState<boolean>(false);\r\n\r\n    let scale = props.canvasWidth / 16;\r\n\r\n\r\n    const init = () => {\r\n        console.log(\"NNGraph init\")\r\n\r\n        createGraph();\r\n        setInitialised(true);\r\n    }\r\n\r\n    useEffect(() => {\r\n        console.log(\"NNGraph inital useEffect\")\r\n        init()\r\n    }, []);\r\n\r\n\r\n    useEffect(() => {\r\n        console.log(\"props and props.decisionboundary NNGraph useEffect\")\r\n        if (!initialised) {\r\n            init()\r\n        } else {\r\n            updateGraph()\r\n        }\r\n    }, [props.decisionBoundary, props.dataset]);\r\n\r\n\r\n    const createGraph = () => {\r\n        console.log(\"Creating graph\");\r\n\r\n        d3.select(d3Container.currnet)\r\n            .attr(\"width\", props.canvasWidth + props.marginLeft + props.marginRight)\r\n            .attr(\"height\", props.canvasWidth + props.marginTop + props.marginBottom);\r\n\r\n    }\r\n\r\n    const addFormattedText = (label: string, text: d3.Selection<SVGTextElement, unknown, null, undefined>) => {\r\n        if (/[_^]/.test(label)) {\r\n            let myRe = /(.*?)([_^])(.)/g;\r\n            let myArray;\r\n            let lastIndex;\r\n            while ((myArray = myRe.exec(label)) != null) {\r\n                lastIndex = myRe.lastIndex;\r\n                let prefix = myArray[1];\r\n                let sep = myArray[2];\r\n                let suffix = myArray[3];\r\n                if (prefix) {\r\n                    text.append(\"tspan\").text(prefix);\r\n                }\r\n                text.append(\"tspan\")\r\n                    .attr(\"baseline-shift\", sep === \"_\" ? \"sub\" : \"super\")\r\n                    .style(\"font-size\", \"9px\")\r\n                    .text(suffix);\r\n            }\r\n            if (lastIndex && label.substring(lastIndex)) {\r\n                text.append(\"tspan\").text(label.substring(lastIndex));\r\n            }\r\n        } else {\r\n            text.append(\"tspan\").text(label);\r\n        }\r\n    }\r\n\r\n    const updateGraph = () => {\r\n        console.log(\"Updating graph\");\r\n\r\n        const svg = d3.select(d3Container.current);\r\n\r\n        svg.selectAll(`.graph`).remove();\r\n\r\n        const graph = svg.append(\"g\")\r\n            .attr(\"class\", \"graph\")\r\n            .attr(\"transform\", `translate(${props.marginLeft}, ${props.marginTop})`);\r\n\r\n        const x = d3.scaleLinear().range([0, props.canvasWidth]);\r\n        const y = d3.scaleLinear().range([props.canvasWidth, 0]);\r\n\r\n        x.domain([-8, 8]);\r\n        y.domain([-8, 8]);\r\n\r\n        graph.append(\"g\")\r\n            .attr(\"class\", `axis`)\r\n            .attr(\"transform\", `translate(0,${props.canvasWidth})`)\r\n            .call(d3.axisBottom(x).tickValues([0].concat(x.ticks())));\r\n\r\n        graph.append(\"g\")\r\n            .attr(\"class\", `axis`)\r\n            .call(d3.axisLeft(y).tickValues([0].concat(y.ticks())));\r\n\r\n        graph.append(\"g\")\r\n            .attr(\"class\", `axis`)\r\n            .attr(\"transform\", `translate(${props.canvasWidth},0)`)\r\n            .call(d3.axisRight(y).tickValues([0].concat(y.ticks())));\r\n\r\n        graph.append(\"g\")\r\n            .attr(\"class\", `axis`)\r\n            .call(d3.axisTop(x).tickValues([0].concat(x.ticks())));\r\n\r\n        let xAxisLabel = \"X_1\";\r\n        let yAxisLabel = \"X_2\";\r\n\r\n        let xAxisText = graph.append(\"text\")\r\n            .attr(\"class\", `axis`)\r\n            .attr(\"x\", props.canvasWidth / 2)\r\n            .attr(\"y\", props.canvasWidth + props.marginBottom - 7)\r\n            .attr(\"text-anchor\", \"middle\")\r\n            .attr(\"alignment-baseline\", \"bottom\");\r\n\r\n        addFormattedText(xAxisLabel, xAxisText);\r\n\r\n        let yAxisText = graph.append(\"text\")\r\n            .attr(\"class\", `axis`)\r\n            .attr(\"y\", props.canvasWidth / 2)\r\n            .attr(\"x\", -props.marginLeft)\r\n            .attr(\"text-anchor\", \"left\")\r\n            .attr(\"alignment-baseline\", \"middle\")     \r\n        \r\n\r\n        addFormattedText(yAxisLabel, yAxisText);\r\n\r\n        let filteredDataset = props.dataset.filter((p: Dataset2D) => {\r\n            return p.x1 >= x.domain()[0] && p.x1 <= x.domain()[1]\r\n              && p.x2 >= y.domain()[0] && p.x2 <= y.domain()[1];\r\n          });\r\n\r\n        graph.selectAll(`.circle`)\r\n            .data(filteredDataset)\r\n            .enter().append(\"circle\")\r\n            .attr(\"class\", `circle`)\r\n            .attr(\"r\", scale / 7)\r\n            .attr(\"fill\", function (datapoint: Dataset2D): string {\r\n                let colour = \"black\";\r\n                if (datapoint.y === 1) colour = maxColour;\r\n                if (datapoint.y === -1) colour = minColour;\r\n\r\n                return colour;\r\n            })\r\n            .style(\"stroke\", \"black\")\r\n            .attr(\"cx\", (datapoint: Dataset2D) => (datapoint.x1 * scale) + (props.canvasWidth / 2))\r\n            .attr(\"cy\", (datapoint: Dataset2D) => -(datapoint.x2 * scale) + (props.canvasWidth / 2));\r\n    \r\n\r\n        }\r\n\r\n    return (\r\n        <>\r\n            <div style={{ position: \"relative\"}}>\r\n                <svg\r\n                    ref={d3Container}\r\n                    width={props.canvasWidth + props.marginLeft + props.marginRight}\r\n                    height={props.canvasWidth + props.marginTop + props.marginBottom}\r\n                    style={{ position: \"absolute\"}}\r\n                />\r\n                <BackgroundCanvas\r\n                    width={props.canvasWidth}\r\n                    height={props.canvasWidth}\r\n                    numCells={props.numCells}\r\n                    paddingLeft={props.marginLeft}\r\n                    paddingRight={props.marginRight}\r\n                    paddingTop={props.marginTop}\r\n                    paddingBottom={props.marginBottom}\r\n                    disabled={false}\r\n                    padding={true}\r\n                    decisionBoundary={props.decisionBoundary}\r\n                    discreetBoundary={props.discreetBoundary}\r\n                />\r\n            </div>\r\n        </>\r\n    );\r\n}\r\n\r\nexport default NNGraph;","import styled from \"@emotion/styled\";\r\nimport { Typography } from \"@material-ui/core\";\r\nimport Slider from \"@material-ui/core/Slider\";\r\nimport Tooltip from \"@material-ui/core/Tooltip\";\r\nimport React, { useState } from \"react\";\r\n\r\ninterface Props {\r\n    children: React.ReactElement;\r\n    open: boolean;\r\n    value: number;\r\n}\r\n\r\nconst StyledDiv = styled(\"div\")`\r\n    width: 110px;\r\n    padding-left: 10px;\r\n    padding-right: 10px;\r\n`\r\n\r\nfunction ValueLabelComponent(props: Props) {\r\n    const { children, open, value } = props;\r\n\r\n    return (\r\n        <Tooltip open={open} enterTouchDelay={0} placement=\"top\" title={value}>\r\n            {children}\r\n        </Tooltip>\r\n    );\r\n}\r\n\r\n\r\ninterface sliderProps {\r\n    label?: string;\r\n    defaultValue: number;\r\n    onChange: (e: React.ChangeEvent<{}>, value: number | number[]) => void;\r\n    valueLabelDisplay?: \"on\" | \"off\" | \"auto\" | undefined;\r\n    step: number;\r\n    min: number;\r\n    max: number;\r\n    appendValueToLabel: boolean;\r\n}\r\n\r\nfunction LabeledSlider(props: sliderProps) {\r\n    const [currentValue, setCurrentValue] = useState<number>(props.defaultValue);\r\n\r\n\r\n    const handleOnChange = (e: any, newValue: number | number[]) => {\r\n        setCurrentValue(newValue as number);\r\n    }\r\n    return (\r\n        <StyledDiv>\r\n            <Typography gutterBottom>{props.label + \": \" + currentValue}</Typography>\r\n            <Slider\r\n                // ValueLabelComponent={ValueLabelComponent}\r\n                //aria-label=\"custom thumb label\"\r\n                defaultValue={props.defaultValue}\r\n                step={props.step}\r\n                min={props.min}\r\n                max={props.max}\r\n                onChange={handleOnChange}\r\n                onChangeCommitted={props.onChange}\r\n                // valueLabelDisplay={props.valueLabelDisplay || \"auto\"}\r\n            />\r\n        </StyledDiv>\r\n    );\r\n}\r\n\r\nexport default LabeledSlider;","import styled from \"@emotion/styled\";\r\nimport { IconButton, Tooltip } from \"@material-ui/core\";\r\nimport { Info } from \"@material-ui/icons\";\r\nimport React from \"react\";\r\n\r\nconst StyledIconButton = styled(IconButton)`\r\n    -webkit-box-sizing: border-box; /* Safari/Chrome, other WebKit */\r\n    -moz-box-sizing: border-box;    /* Firefox, other Gecko */\r\n    box-sizing: border-box; \r\n    width: 20px;\r\n    height: 20px;\r\n    color: #505050;\r\n    padding: 10px;\r\n    \r\n    margin: auto 0px;\r\n    border-radius: 100%;\r\n    &:hover {\r\n        background-color: inherit;\r\n    }\r\n\r\n`\r\n\r\nconst HtmlTooltip = styled(Tooltip)`\r\n    -webkit-box-sizing: border-box; /* Safari/Chrome, other WebKit */\r\n    -moz-box-sizing: border-box;    /* Firefox, other Gecko */\r\n    box-sizing: border-box; \r\n\r\n    margin-right: ${(props: { marginLeft: number, marginRight: number }) => `${props.marginRight}px`};\r\n    margin-left: ${(props: { marginLeft: number, marginRight: number }) => `${props.marginLeft}px`};\r\n\r\n`\r\n\r\ninterface InfoButtonProps {\r\n    title: string;\r\n    children?: React.ReactElement;\r\n    onClick?: (panel: JSX.Element) => void;\r\n    infoPanel?: JSX.Element;\r\n    icon?: React.ReactElement;\r\n    fontSize?: \"small\" | \"inherit\" | \"default\" | \"large\" | undefined;\r\n    marginLeft?: number;\r\n    marginRight?: number;\r\n}\r\n\r\nconst InfoButton: React.FC<InfoButtonProps> = ({\r\n    marginLeft = 10,\r\n    marginRight = 10,\r\n    ...props\r\n}) => {\r\n\r\n    return (\r\n        <HtmlTooltip interactive arrow\r\n            title={props.children || props.title}\r\n            onClick={() => props.onClick && props.infoPanel && props.onClick(props.infoPanel)}\r\n            marginLeft={marginLeft}\r\n            marginRight={marginRight}\r\n        >\r\n            <StyledIconButton>\r\n                {props.icon || <Info fontSize={props.fontSize} />}\r\n            </StyledIconButton>\r\n        </HtmlTooltip>\r\n    );\r\n}\r\n\r\nexport default InfoButton;","import React, { useContext, useRef } from \"react\";\r\nimport { NNConfig } from \"../MainPage\";\r\nimport positiveLink from \"../../PositiveLink.png\";\r\nimport negativeLink from \"../../NegativeLink.png\";\r\nimport { ThemeContext } from \"../../contexts/ThemeContext\";\r\n\r\nfunction DefaultInfoPanel(props: NNConfig) {\r\n    // const linkSvgContainer: any = useRef<any>(null);\r\n    // const drawDemoLink = () => {\r\n\r\n    // }\r\n    const { minColourName, maxColourName } = useContext(ThemeContext);\r\n\r\n    return (\r\n        <div>\r\n            <h1>How To Get Started</h1>\r\n            <p>This is a tool that lets you play with a simple neural network implementation. Below are instructions on how to get started designing your own neural network and test it's performance.</p>\r\n            <h2>Neural Network</h2>\r\n            <h3>Links</h3>\r\n            {/* Maths font w? */}\r\n            {/* Defined Term or google link for Gradient Decent*/}\r\n            <p>Links (or edges) connect neurons in adjacent layers, each link has a weight value w that is updated by training the network using Gradient Decent.</p>\r\n            {/* <svg\r\n                ref={linkSvgContainer}\r\n                width={100}\r\n                height={40}\r\n                style={{pointerEvents: \"none\" }}\r\n                // id={'lines-container'}\r\n            /> */}\r\n            <h4>Magnitude</h4>\r\n            <p>The width of a link corresponds to the absolute magnitude of it's weight. Wider links have greater absolute weight values (and therefore have a stronger influence in the destination node) than narrower links.</p>\r\n            <h4>Positive Value Link</h4>\r\n            <img src={positiveLink} alt=\"Positive link\" width={100}/>\r\n            <p>Links with a weight value &gt; 0 are {maxColourName}.</p>\r\n            <h4>Negative Value Link</h4>\r\n            <img src={negativeLink} alt=\"Negative link\" width={100}/>\r\n            <p>Links with a weight value &lt; 0 are {minColourName}.</p>\r\n            <ul>\r\n                <li>Fix history functionality</li>\r\n                <li>Node representation</li>\r\n                <li>Link representation</li>\r\n                <li>Inputs</li>\r\n                <li>Data set</li>\r\n                <li>Building network</li>\r\n                <li>Training</li>\r\n                <li>Comparision func</li>\r\n                <li>Tool tips</li>\r\n            </ul>\r\n            <p></p>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default DefaultInfoPanel;","export default \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAT8AAAA1CAYAAAA3Sux5AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAFtSURBVHhe7d2xTcNAGIbhM5sABQxCzwxQwAZhBtgACmaAGragIUVAyiLGRieBrODyYvQ9T5Nz98t3eiVLJ6XrBwUgzEH9BYgifkAk8QMiiR8QSfyASOIHRBI/IJL4AZHED4gkfkAk8QMiiR8QSfyASOIHRBI/IJL4AZHED4gkfkAk8QMiiR8QSfyASF3/8tT+39vOzuti4vW5Lho7PCnl+LQ+/LKveZb2fswzb9c8m/dSPtf1obH/MM9oz/vV9auL9vG7fayLiZvLumjsarU7fvd3pXwMh6a1pb0f8/ztaDg318P5mRpj8zCcn9aWNs9oofvlsxeIJH5AJPEDIokfEEn8gEjiB0QSPyCSS84jl5znmWfernlccv6x0P3q+sH3CiCIz14gkvgBkcQPiCR+QCTxAyKJHxBJ/IBI4gdEEj8gkvgBkcQPiCR+QCTxAyKJHxBJ/IBI4gdEEj8gkvgBkcQPyLPdiB8QaP1WvgBj/FW9pIttHAAAAABJRU5ErkJggg==\"","export default \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAUEAAAAuCAYAAAC226sKAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAFcSURBVHhe7dwxSsRAGIbh0YsoeIMtZDvvoWBlZaE3sPAGWlhZCR7EbrXYGwh6Es1mZwnIJmUS+Z6n2STVz0x4ITDswU+jAIQ6rL8AkUQQiCaCQDQRBKKJIBBNBIFoIghEE0EgmggC0UQQiCaCQDQRBKKJIBBNBIFoIghEE0EgmggC0dp/ln58fqu34zpdHJXl4rjedaaaZ+Pm6qxedcyzNbf9Ms+wfe/Oav1VPtbf9W5cc92vNoLn1y/lvVmcsb0+Xe5dlKnmuW1emr7oPEywUX3z2K+t/zLPyfK+Xo3rc3VXrzqbCF406zOFua3Pbh6fw0A0EQSiiSAQTQSBaCIIRBNBIJoIAtEclv7DYel+DicPm9s8DksP283TRrA+A4jjcxiIJoJANBEEookgEE0EgWgiCEQTQSCaCALRRBCIJoJANBEEookgEE0EgWgiCEQTQSCaCALRRBAIVsov/YKARCqVXtEAAAAASUVORK5CYII=\"","import React from \"react\";\r\nimport { NNConfig } from \"../MainPage\";\r\nimport { MathComponent } from \"mathjax-react\";\r\n\r\nfunction LearningRateInfoPanel(props: NNConfig) {\r\n\r\n    return (\r\n        <div style={{ float: \"left\"}}>\r\n            <h1>Learning Rate (&epsilon;)</h1>\r\n            <p>The learning rate affects the rate at which the weights and biases change each epoch when training the neural network.</p>\r\n            <h2>Usage</h2>\r\n            <MathComponent tex={String.raw`w'=w-\\epsilon\\Delta J(x)`} />\r\n           <h2>Observations</h2>\r\n            <p>\r\n                We observe that <b>smaller</b> learning rates lead to <b>slower learning</b> but <b>more precise decision boundaries </b>\r\n                and <b>less fluctuating</b> around the local optima and conversely <b>larger</b> learning rates lead to <b>faster learning </b>\r\n                but <b>less precise decision boundaries</b> and <b>more fluctuating</b> around local minima.\r\n            </p>\r\n            <h3>Exercise</h3>\r\n            <p>Try different different learning rates and see how much the loss is reduced on average after 3 epochs.</p>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default LearningRateInfoPanel;","import styled from \"@emotion/styled\";\r\nimport { createStyles, IconButton, makeStyles, Theme, Tooltip, Typography } from \"@material-ui/core\";\r\nimport React from \"react\";\r\n\r\nconst HtmlTooltip = styled(Tooltip)`\r\n    -webkit-box-sizing: border-box; /* Safari/Chrome, other WebKit */\r\n    -moz-box-sizing: border-box;    /* Firefox, other Gecko */\r\n    box-sizing: border-box; \r\n\r\n`\r\n\r\nconst StyledLink = styled(\"a\")`\r\n    text-decoration: underline;\r\n    color: blue;\r\n    cursor: pointer;\r\n`\r\nexport interface DefinedTermProps {\r\n    children: React.ReactChild | React.ReactChild[];\r\n    definition: React.ReactChild | React.ReactChild[];\r\n    onClick?: (panel: JSX.Element) => void;\r\n    infoPanel?: JSX.Element;\r\n}\r\n\r\nexport function DefinedTerm(props: DefinedTermProps) {\r\n    return (\r\n        <HtmlTooltip interactive arrow\r\n            title={props.definition}\r\n            onClick={() => props.onClick && props.infoPanel && props.onClick(props.infoPanel)}\r\n        ><StyledLink>{props.children}</StyledLink></HtmlTooltip>\r\n    );\r\n}\r\n\r\nexport function DefX1() {\r\n    return (\r\n        <Typography variant=\"body2\">\r\n            X<sub>1</sub> represents the first feature of a datapoint that is being entered into the neural network\r\n            (shown on the X axis of the nodes in the neural network and the output graph).<br />\r\n            Domain of X<sub>1</sub> shown in the neural network is -8 to +8.\r\n        </Typography>\r\n    );\r\n}\r\n\r\nexport function DefX2() {\r\n    return (\r\n        <Typography variant=\"body2\">\r\n            X<sub>2</sub> represents the second feature of a datapoint that is being entered into the neural network\r\n            (shown on the Y axis of the nodes in the neural network and the output graph).<br />\r\n            Domain of X<sub>2</sub> shown in the neural network is -8 to +8.\r\n        </Typography>\r\n    );\r\n}\r\n\r\nexport function DefNode() {\r\n    return (\r\n        <Typography variant=\"body2\">\r\n           Nodes are the individual functions that make up the neural network and are connected to nodes in adjacent layers by links.<br/>\r\n           <u>Click the icon to get more information</u>\r\n        </Typography>\r\n    );\r\n}\r\n\r\nexport function DefLink() {\r\n    return (\r\n        <Typography variant=\"body2\">\r\n\r\n        </Typography>\r\n    )\r\n}\r\n","export default __webpack_public_path__ + \"static/media/Sigmoid-function-2.8e7151dc.svg\";","import React from \"react\";\r\nimport { NNConfig } from \"../MainPage\";\r\nimport { MathComponent } from \"mathjax-react\";\r\n\r\nfunction NodeInfoPanel(props: NNConfig) {\r\n\r\n    return (\r\n        <div>\r\n            <h1>Nodes</h1>\r\n            <p>Nodes are the individual functions that make up the neural network and are connected to nodes in adjacent layers by links.</p>\r\n            <h2>Usage</h2>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default NodeInfoPanel;","import styled from \"@emotion/styled\";\r\nimport React from \"react\";\r\nimport { DefinedTerm, DefNode } from \"../Definitions\";\r\nimport { NNConfig } from \"../MainPage\";\r\nimport sigmoid from \"../SVGs/Sigmoid-function-2.svg\";\r\nimport NodeInfoPanel from \"./NodeInfoPanel\";\r\n\r\n\r\nconst ActivationImg = styled(\"img\")`\r\n    width: 600px;\r\n`;\r\n\r\nfunction ActivationInfoPanel(props: {config: NNConfig, setInfoPanel: (infoPanel: JSX.Element) => void}) {\r\n\r\n    return (\r\n        <div>\r\n            <h1>Activation Functions (&Phi;)</h1>\r\n            <p>Activation function of a <DefinedTerm definition={DefNode()} onClick={props.setInfoPanel} infoPanel={<NodeInfoPanel {...props.config} />}>node</DefinedTerm></p>\r\n            <h2>Sigmoid</h2>\r\n            <ActivationImg src={sigmoid} alt=\"Sigmoid Function\" />\r\n            <p></p>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default ActivationInfoPanel;","import React from \"react\";\r\nimport { DefinedTerm, DefX1, DefX2 } from \"../Definitions\";\r\nimport { NNConfig } from \"../MainPage\";\r\n\r\nfunction DatasetInfoPanel(props: NNConfig) {\r\n\r\n    return (\r\n        <div>\r\n            <h1>Datasets</h1>\r\n            <p>These are the data sets you can use to train and test your network. All the points in the data sets have 2 features (<DefinedTerm definition={DefX1()}>X<sub>1</sub></DefinedTerm> and <DefinedTerm definition={DefX2()}>X<sub>2</sub></DefinedTerm>) and fall under one of two classifications (-1 or +1).</p>\r\n            <h2>Gaussian 2</h2>\r\n            <p>This data set is comprised of two 2-Dimensional Gaussian (or Normal) distributed sets of points, one for each class.<br/>\r\n            <a href=\"https://en.wikipedia.org/wiki/Normal_distribution\" target=\"_blank\">Read more here (Wiki)</a></p>\r\n            <h2>Gaussian 3</h2>\r\n            <p>This data set is comprised of three 2-Dimensional Gaussian (or Normal) distributed sets of points, one group of +1 points and two groups of -1 points.</p>\r\n            <h2>XOR</h2>\r\n            <p>This data set represents an XOR distributed set of points which cannot be classified using a straight line.<br/>\r\n            <a href=\"https://www.google.com/search?q=XOR\" target=\"_blank\">Read more here (Google)</a></p>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default DatasetInfoPanel;","import styled from \"@emotion/styled\";\r\nimport React, { useEffect, useState } from \"react\";\r\nimport BackgroundCanvas from \"./BackgroundCanvas\";\r\n\r\ninterface NNNodeProps {\r\n    nodeWidth: number;\r\n    id: string;\r\n    nodeId?: string;\r\n    decisionBoundary?: number[];\r\n    discreetBoundary: boolean;\r\n    numCells: number;\r\n    handleOnClick?: (nodeId: string, active: boolean) => any;\r\n    handleOnHover?: (nodeId: string, active: boolean) => any;\r\n    active: boolean;\r\n}\r\n\r\ninterface ContainerProps {\r\n    nodeWidth: number;\r\n    active: boolean;\r\n}\r\n\r\nconst NodeContainer = styled(\"div\") <ContainerProps>`\r\n    -webkit-box-sizing: border-box; /* Safari/Chrome, other WebKit */\r\n    -moz-box-sizing: border-box;    /* Firefox, other Gecko */\r\n    box-sizing: border-box;\r\n    //border: 2px solid ${props => props.active ?\"#000000\" : \"#505050\"};\r\n    border: 2px solid black;\r\n    //background-color: black;\r\n    background-color: white;\r\n    border-radius: 3px;\r\n    max-height: ${props => props.nodeWidth + 2 * 2}px;\r\n    cursor: pointer;\r\n`;\r\n\r\n\r\nfunction NNNode(props: NNNodeProps) {\r\n\r\n    return (\r\n        <NodeContainer id={`${props.id}`}\r\n            nodeWidth={props.nodeWidth}\r\n            active={props.active}\r\n            onClick={() => (props.handleOnClick && props.nodeId && props.handleOnClick(props.nodeId, props.active))}\r\n            onMouseOver={() => (props.handleOnHover && props.nodeId && props.handleOnHover(props.nodeId, props.active))}\r\n        >\r\n            <BackgroundCanvas\r\n                width={props.nodeWidth}\r\n                height={props.nodeWidth}\r\n                numCells={props.numCells}\r\n                padding={false}\r\n                disabled={!props.active}\r\n                decisionBoundary={props.decisionBoundary}\r\n                discreetBoundary={props.discreetBoundary}\r\n            />\r\n        </NodeContainer>\r\n    );\r\n}\r\n\r\nexport default NNNode;","import * as nn from \"../NeuralNet\";\r\nimport styled from \"@emotion/styled\";\r\nimport React, { useContext, useEffect, useRef, useState } from \"react\";\r\nimport * as d3 from \"d3\";\r\nimport NNNode from \"./NNNode\";\r\nimport { INPUTS } from \"../visControl\"\r\nimport AddCircleIcon from '@material-ui/icons/AddCircle';\r\nimport RemoveCircleIcon from '@material-ui/icons/RemoveCircle';\r\nimport { IconButton, Typography } from \"@material-ui/core\";\r\nimport { NNConfig, StyledInfoButton } from \"./MainPage\";\r\nimport { DefinedTerm, DefX1, DefX2 } from \"./Definitions\";\r\nimport MouseTooltip from \"./MouseTooltip\";\r\nimport ResizeSensor from \"css-element-queries\";\r\nimport useEventListener from \"./UseEventListener\";\r\nimport { ThemeContext } from \"../contexts/ThemeContext\";\r\n\r\ninterface ContainerBox {\r\n    top: number;\r\n    left: number;\r\n    x: number;\r\n    y: number;\r\n    width: number;\r\n    height: number;\r\n}\r\n\r\nenum HoverCardType {\r\n    BIAS,\r\n    WEIGHT\r\n}\r\n\r\ninterface HoverCardConfig {\r\n    type: HoverCardType;\r\n    value: number;\r\n}\r\n\r\nconst HoverCard = styled(\"div\")`\r\n    -webkit-box-sizing: border-box; /* Safari/Chrome, other WebKit */\r\n    -moz-box-sizing: border-box;    /* Firefox, other Gecko */\r\n    box-sizing: border-box; \r\n    background-color: white;\r\n    margin: auto auto;\r\n    border-radius: 10px;\r\n    border: 2px solid #bdbdbd;\r\n    //border: 2px solid #353a3c;\r\n    width: 120px;\r\n    height: 60px;\r\n    display: flex;\r\n    flex-direction: row;\r\n    justify-content: center;\r\n    z-index: 10000;\r\n    /* position: absolute; */\r\n    /* position: static; */\r\n`\r\n\r\nconst PlusMinusButtonsContainer = styled(\"div\")`\r\n    display: flex;\r\n    justify-content: center;\r\n    align-items: center;\r\n    align-self: flex-start;\r\n`\r\n\r\nconst GridContainer = styled(\"div\")`\r\n    position: relative;\r\n    display: grid;\r\n    height: 100%;\r\n    width: 50vw;\r\n    /* max-width: 40vw; */\r\n    min-width: 550px;\r\n    grid-template-columns: auto 1fr auto;\r\n    grid-template-rows: auto 1fr 48px;\r\n    grid-gap: 0px;\r\n    grid-template-areas: \r\n        \"inputs-label layer-controls .\"\r\n        \"inputs-layer hidden-layers output\"\r\n        \". hidden-layers .\"\r\n        ;\r\n`\r\n\r\nconst Container = styled(\"div\")`\r\n    -webkit-box-sizing: border-box; /* Safari/Chrome, other WebKit */\r\n    -moz-box-sizing: border-box;    /* Firefox, other Gecko */\r\n    box-sizing: border-box;\r\n    display: flex;\r\n    flex-direction: row;\r\n    justify-content: space-between;\r\n    padding-left: 50px;\r\n    padding-right: 0px;\r\n    width: 100%;\r\n    height: inherit;\r\n`;\r\n\r\nconst Layer = styled(\"div\")`\r\n    display: flex;\r\n    flex-direction: column;\r\n    justify-content: space-around;\r\n    align-items: center;\r\n`;\r\n\r\nconst ContainerSection = styled(\"div\")`\r\n    grid-area: ${(props: { gridArea: string }) => (props.gridArea)};\r\n`\r\n\r\nconst LayerControls = styled((props: any) => <ContainerSection gridArea=\"layer-controls\" {...props} />)`\r\n    display: flex;\r\n    flex-direction: row;\r\n    justify-content: space-around;\r\n    align-items: center;\r\n`\r\n\r\ninterface CanvasProps {\r\n    visible: boolean;\r\n}\r\nconst FadeCanvas = styled(\"canvas\") <CanvasProps>`\r\n    position: absolute;\r\n    background-color: white;\r\n\r\n    ${({ visible }) => visible && `\r\n    transition: opacity 1.1s;\r\n    `}\r\n    ${({ visible }) => !visible && `\r\n    transition: opacity 0.1s;\r\n    `}\r\n`;\r\n\r\n// export function generateLineConfig (link: nn.Link, minColour:string, maxColour: string) {\r\n//     let weightToSize = d3.scaleLinear()\r\n//         .domain([-1, 0, 1])\r\n//         .range([6, 1.5, 6])\r\n//         .clamp(true);\r\n//     return {\r\n//         color: (link.weight > 0 ? maxColour : minColour),\r\n//         size: weightToSize(link.weight),\r\n//     }\r\n// }\r\n\r\n// export function drawLink(\r\n//     input: nn.Link, node2coord: { [id: string]: { cx: number, cy: number } },\r\n//     index: number, length: number, nodeWidth: number, minColour: string, maxColour: string, container: any) {\r\n//     let line = d3.select(container.current).append(\"path\");\r\n//     let source = node2coord[input.source.id];\r\n//     let dest = node2coord[input.dest.id];\r\n//     if (!(dest && source)) return;\r\n\r\n//     // Check X and Ys are reversed properlly\r\n//     let datum: any = {\r\n//         source:\r\n//             [source.cx + nodeWidth / 2 + 2, source.cy]\r\n//         ,\r\n//         target: [dest.cx - nodeWidth / 2, dest.cy]\r\n//     };\r\n\r\n//     let diagonal = d3.linkHorizontal()\r\n//         .x(function (d: any) {\r\n//             return d[0];\r\n//         }).y(function (d: any) { return d[1]; })\r\n//     let d = diagonal(datum);\r\n\r\n//     let linkConfig = generateLineConfig(input, minColour,  maxColour);\r\n\r\n//     d && line.attr(\"marker-start\", \"url(#markerArrow)\")\r\n//         .attr(\"class\", \"link\")\r\n//         .attr(\"id\", `link-${input.source.id}-${input.dest.id}`)\r\n//         .attr(\"d\", d)\r\n//         .attr(\"fill\", \"transparent\")\r\n//         .attr(\"pointer-events\", \"all\")\r\n//         .attr(\"stroke\", linkConfig.color)\r\n//         .attr(\"stroke-width\", linkConfig.size || 0)\r\n//         .attr(\"stroke-dasharray\", \"10,2\")\r\n//         .on(\"mouseover\", function (d, i) {\r\n//             d3.select(this).transition()\r\n//                 .duration(100000)\r\n//                 .ease(d3.easeLinear)\r\n//                 .attr(\"stroke-dashoffset\", -8000)\r\n//         })\r\n//         .on(\"mouseout\", function (d, i) {\r\n//             d3.select(this)\r\n//                 .transition();\r\n//         })\r\n//     return line;\r\n// }\r\n\r\n// function drawLink2() {\r\n\r\n// }\r\n\r\ninterface NetworkProps {\r\n    network: nn.Node[][];\r\n    decisionBoundaries: { [nodeId: string]: number[] };\r\n    discreetBoundary: boolean;\r\n    networkWidth: number;\r\n    networkHeight: number;\r\n    handleOnClick: any;\r\n    inputs: { [inputId: string]: boolean };\r\n    config: NNConfig;\r\n    addNode: (layer: number) => void;\r\n    removeNode: (layer: number) => void;\r\n    addLayer: () => void;\r\n    removeLayer: () => void;\r\n    setInfoPanel: any;\r\n}\r\n\r\n// Could remove the output node and point straight to the graph\r\nfunction NeuralNetworkVis(props: NetworkProps) {\r\n    const { minColour, maxColour } = useContext(ThemeContext);\r\n\r\n    const svgContainer: any = useRef<any>(null);\r\n    const container: any = useRef<any>(null);\r\n    const nodeWidth = 30;\r\n    const [linksUpdated, setLinksUpdated] = useState<boolean>(false);\r\n    const [network, setNetwork] = useState<nn.Node[][]>();\r\n    const [labelsDrawn, setLabelsDrawn] = useState<boolean>(false);\r\n    const [containerBox, setContainerBox] = useState<ContainerBox>({ top: 0, left: 0, x: 0, y: 0, width: 0, height: 0 });\r\n    const [showHoverCard, setShowHoverCard] = useState<boolean>(false);\r\n    const [hoverCardConfig, setHoverCardConfig] = useState<HoverCardConfig>({ type: HoverCardType.WEIGHT, value: 0 });\r\n    const [hoverTarget, setHoverTarget] = useState<string>(\"\");\r\n\r\n\r\n    useEffect(() => {\r\n\r\n        updateContainerBox();\r\n\r\n        let container = document.getElementById(\"main-container\");\r\n\r\n        if (container) {\r\n            window.addEventListener('resize', updateContainerBox);\r\n            container.addEventListener('scroll', updateContainerBox);\r\n        }\r\n        return () => {\r\n            if (container) {\r\n                window.removeEventListener('resize', updateContainerBox);\r\n                container.removeEventListener('scroll', updateContainerBox);\r\n            }\r\n        }\r\n    }, [])\r\n\r\n    const updateHovercard = (event: any) => {\r\n        let targetId = event.target.id;\r\n\r\n        if (targetId\r\n            && (targetId.indexOf(\"link\") !== -1 || targetId.indexOf(\"node\") !== -1)\r\n            && !(targetId.substring(5) in props.inputs)) {\r\n\r\n            setHoverTarget(targetId);\r\n            setShowHoverCard(true);\r\n\r\n        }\r\n    }\r\n\r\n    const hideHoverCard = (event: any) => {\r\n        let targetId = event.target.id;\r\n        if (!targetId || (targetId.indexOf(\"link\") === -1 && targetId.indexOf(\"node\") === -1)) return;\r\n        setHoverTarget(\"\");\r\n        setShowHoverCard(false);\r\n    }\r\n\r\n    // useEventListener(\"mouseenter\", updateHovercard, undefined, true);\r\n    // useEventListener(\"mouseleave\", hideHoverCard, undefined, true);\r\n\r\n    useEffect(() => {\r\n        setLinksUpdated(false);\r\n        setNetwork(props.network);\r\n\r\n        document.addEventListener('mouseenter', updateHovercard, true);\r\n        document.addEventListener('mouseleave', hideHoverCard, true);\r\n\r\n        return () => {\r\n            document.removeEventListener('mouseenter', updateHovercard, true);\r\n            document.removeEventListener('mouseleave', hideHoverCard, true);\r\n        }\r\n    }, [props.network, props.inputs]);\r\n\r\n\r\n    useEffect(() => {\r\n        drawAllLinks(props.network);\r\n        updateContainerBox();\r\n    }, [props.decisionBoundaries]);\r\n\r\n    useEffect(() => {\r\n        // At this point this means links are always drawn twice\r\n        drawAllLinks(props.network);\r\n    }, [containerBox]);\r\n\r\n    useEffect(() => {\r\n        if (hoverTarget !== \"\") {\r\n            if (hoverTarget.indexOf(\"link\") === -1) {\r\n                // If a node\r\n                let node = nodeId2Node(hoverTarget);\r\n                if (node) setHoverCardConfig({ type: HoverCardType.BIAS, value: node.bias });\r\n\r\n            } else {\r\n                // If a link\r\n                let link = linkId2Link(hoverTarget);\r\n                if (link) setHoverCardConfig({ type: HoverCardType.WEIGHT, value: link.weight });\r\n            }\r\n        }\r\n    }, [hoverTarget, props.decisionBoundaries]);\r\n\r\n\r\n    const drawAllLinks = (network: nn.Node[][]) => {\r\n        console.log(\"Draw Links\");\r\n        let start = Date.now();\r\n\r\n        d3.selectAll(\".link\").remove();\r\n\r\n        let node2Coord = getNodeCoords(network);\r\n        if (!node2Coord) return;\r\n\r\n        let iter = 0;\r\n        for (let layerNum = 0; layerNum < network.length; layerNum++) {\r\n            let currentLayer = network[layerNum];\r\n            for (let i = 0; i < currentLayer.length; i++) {\r\n                let node: nn.Node = currentLayer[i];\r\n                // Instead store node positions in a dictionary to reduce elementSearches and increase speed\r\n                for (let j = 0; j < node.linksOut.length; j++) {\r\n                    let link: nn.Link = node.linksOut[j];\r\n\r\n                    drawLink(link, node2Coord);\r\n\r\n                    iter++;\r\n                }\r\n\r\n            }\r\n        }\r\n\r\n        if (!labelsDrawn) drawLabels(node2Coord);\r\n\r\n        setLinksUpdated(true);\r\n        let delta = Date.now() - start;\r\n        console.log(`Finished drawing links (Links Drawn: ${iter}) (Duration: ${delta}ms)`);\r\n\r\n    }\r\n\r\n    const getNodeCoords = (network: nn.Node[][]) => {\r\n\r\n        let containerCurrent = container.current;\r\n        if (!network || !containerCurrent) return null;\r\n        let node2Coord: { [id: string]: { cx: number, cy: number } } = {}\r\n        let containerLeft = containerCurrent.offsetLeft;\r\n        let containerTop = containerCurrent.offsetTop;\r\n\r\n        for (let layerNum = 0; layerNum < network.length; layerNum++) {\r\n            let currentLayer = network[layerNum];\r\n            if (layerNum === 0) {\r\n                let iter = 0;\r\n                Object.keys(INPUTS).forEach((nodeId) => {\r\n\r\n                    let nodeElement = document.getElementById(`node-${nodeId}`);\r\n                    // Right now they aren't actually the centre\r\n                    if (nodeElement) node2Coord[nodeId] = { cx: nodeElement.offsetLeft + nodeWidth / 2, cy: nodeElement.offsetTop + nodeWidth / 2 }\r\n                })\r\n            } else {\r\n                for (let i = 0; i < currentLayer.length; i++) {\r\n                    let node: nn.Node = currentLayer[i];\r\n                    let nodeElement = document.getElementById(`node-${node.id}`);\r\n                    // Right now they aren't actually the centre\r\n                    if (nodeElement) node2Coord[node.id] = { cx: nodeElement.offsetLeft + nodeWidth / 2, cy: nodeElement.offsetTop + nodeWidth / 2 }\r\n                }\r\n            }\r\n        }\r\n        return node2Coord;\r\n    }\r\n\r\n    // Implement something so that the distributed widths are proportional to each other\r\n    // or\r\n    // Set a max width\r\n    const generateLineConfig = (link: nn.Link) => {\r\n        let weightToSize = d3.scaleLinear()\r\n            .domain([-1, 0, 1])\r\n            .range([6, 1.5, 6])\r\n            .clamp(true);\r\n        return {\r\n            color: (link.weight > 0 ? maxColour : minColour),\r\n            size: weightToSize(link.weight),\r\n        }\r\n    }\r\n\r\n    function drawLink(\r\n        input: nn.Link, node2coord: { [id: string]: { cx: number, cy: number } }) {\r\n        let line = d3.select(svgContainer.current).append(\"path\");\r\n        let source = node2coord[input.source.id];\r\n        let dest = node2coord[input.dest.id];\r\n        if (!(dest && source)) return;\r\n\r\n        // Check X and Ys are reversed properlly\r\n        let datum: any = {\r\n            source:\r\n                [source.cx + nodeWidth / 2 + 2, source.cy]\r\n            ,\r\n            target: [dest.cx - nodeWidth / 2, dest.cy]\r\n        };\r\n\r\n        let diagonal = d3.linkHorizontal()\r\n            .x(function (d: any) {\r\n                return d[0];\r\n            }).y(function (d: any) { return d[1]; })\r\n        let d = diagonal(datum);\r\n\r\n        let linkConfig = generateLineConfig(input);\r\n\r\n        d && line.attr(\"marker-start\", \"url(#markerArrow)\")\r\n            .attr(\"class\", \"link\")\r\n            .attr(\"id\", `link-${input.source.id}-${input.dest.id}`)\r\n            .attr(\"d\", d)\r\n            .attr(\"fill\", \"transparent\")\r\n            .attr(\"pointer-events\", \"all\")\r\n            .attr(\"stroke\", linkConfig.color)\r\n            .attr(\"stroke-width\", linkConfig.size || 0)\r\n            .attr(\"stroke-dasharray\", \"10,2\")\r\n            .on(\"mouseover\", function (d, i) {\r\n                d3.select(this).transition()\r\n                    .duration(100000)\r\n                    .ease(d3.easeLinear)\r\n                    .attr(\"stroke-dashoffset\", -8000)\r\n            })\r\n            .on(\"mouseout\", function (d, i) {\r\n                d3.select(this)\r\n                    .transition();\r\n            })\r\n        return line;\r\n    }\r\n\r\n    function drawLabels(node2coord: { [id: string]: { cx: number, cy: number } }) {\r\n        console.log(\"Draw Labels\");\r\n        let nodeIds = Object.keys(INPUTS);\r\n        let nodeNotDrawnYet = false;\r\n        let svg = d3.select(svgContainer.current);\r\n\r\n        svg.selectAll(\".input-label\").remove();\r\n\r\n        nodeIds.forEach((nodeId) => {\r\n            let source = node2coord[nodeId];\r\n            if (!source) {\r\n                nodeNotDrawnYet = true;\r\n                return;\r\n            }\r\n\r\n            let label = INPUTS[nodeId].label != null ? INPUTS[nodeId].label : nodeId;\r\n\r\n            let text = svg.append(\"text\")\r\n                .attr(\"class\", \"input-label\")\r\n                .attr(\"x\", source.cx - (nodeWidth / 2 + 2))\r\n                .attr(\"y\", source.cy + (nodeWidth / 4))\r\n                .attr(\"text-anchor\", \"end\")\r\n                .attr(\"alignment-baseline\", \"middle\")\r\n            if (/[_^]/.test(label)) {\r\n                let myRe = /(.*?)([_^])(.)/g;\r\n                let myArray;\r\n                let lastIndex;\r\n                while ((myArray = myRe.exec(label)) != null) {\r\n                    lastIndex = myRe.lastIndex;\r\n                    let prefix = myArray[1];\r\n                    let sep = myArray[2];\r\n                    let suffix = myArray[3];\r\n                    if (prefix) {\r\n                        text.append(\"tspan\").text(prefix);\r\n                    }\r\n                    text.append(\"tspan\")\r\n                        .attr(\"baseline-shift\", sep === \"_\" ? \"sub\" : \"super\")\r\n                        .style(\"font-size\", \"9px\")\r\n                        .text(suffix);\r\n                }\r\n                if (lastIndex && label.substring(lastIndex)) {\r\n                    text.append(\"tspan\").text(label.substring(lastIndex));\r\n                }\r\n            } else {\r\n                text.append(\"tspan\").text(label);\r\n            }\r\n\r\n        })\r\n        if (!nodeNotDrawnYet) setLabelsDrawn(true);\r\n    }\r\n\r\n    const updateContainerBox = () => {\r\n        let containerCurrent = container.current;\r\n        if (!containerCurrent) return;\r\n        // console.log(\"updating container box\");\r\n        let viewportOffset = containerCurrent.getBoundingClientRect();\r\n        // console.log(containerCurrent.offsetTop);\r\n        // console.log(viewportOffset)\r\n        setContainerBox({\r\n            left: -viewportOffset.x,\r\n            top: -viewportOffset.y,\r\n            x: viewportOffset.x,\r\n            y: viewportOffset.y,\r\n            width: viewportOffset.width,\r\n            height: viewportOffset.height\r\n        });\r\n\r\n    }\r\n\r\n    const nodeId2Node = (nodeId: string) => {\r\n        if (!props.network) return null;\r\n        let id = nodeId.substring(5);\r\n        for (let layerNum = 0; layerNum < props.network.length; layerNum++) {\r\n            for (let nodeNum = 0; nodeNum < props.network[layerNum].length; nodeNum++) {\r\n                let node = props.network[layerNum][nodeNum];\r\n                if (node.id === id) return node;\r\n            }\r\n        }\r\n    }\r\n\r\n    const linkId2Link = (linkId: string) => {\r\n        // console.log(props.network)\r\n        if (!props.network) return null;\r\n        let splitId = linkId.split(\"-\");\r\n        // console.log(splitId)\r\n        let fromNodeId = splitId[1];\r\n        let toNodeId = splitId[2];\r\n        let fromNode = nodeId2Node(\"node-\" + fromNodeId);\r\n        // console.log(fromNode)\r\n        if (!fromNode) return null;\r\n        for (let i = 0; i < fromNode.linksOut.length; i++) {\r\n            let link = fromNode.linksOut[i];\r\n            if (link.dest.id === toNodeId) return link;\r\n        }\r\n        return null;\r\n    }\r\n\r\n    return (\r\n        <>\r\n            <GridContainer style={{ overflow: \"hidden\" }} ref={container}>\r\n                <svg\r\n                    ref={svgContainer}\r\n                    width={containerBox.width}\r\n                    height={containerBox.height}\r\n                    style={{ position: \"absolute\", pointerEvents: \"none\" }}\r\n                    id={'lines-container'}\r\n                />\r\n                {!network || !linksUpdated && <FadeCanvas visible={true} width={containerBox.width} height={containerBox.height} />}\r\n                <div style={{ paddingTop: \"10px\", paddingLeft: \"30px\", display: \"flex\", flexDirection: \"column\", justifyContent: \"center\", alignItems: \"center\", gridArea: \"inputs-label\" }}>\r\n                    <Typography>Inputs</Typography>\r\n                    <StyledInfoButton title=\"Inputs Tooltip\" fontSize=\"small\" marginRight={0} marginLeft={5}>\r\n                        <React.Fragment>\r\n                            <Typography color=\"inherit\">Inputs</Typography>\r\n                            <Typography variant=\"body2\">\r\n                                The inputs determine the data that is input into the neural network from the data set.\r\n                                Each input is a function of <DefinedTerm definition={DefX1()}>X<sub>1</sub></DefinedTerm> and/or <DefinedTerm definition={DefX2()}>X<sub>2</sub></DefinedTerm>.\r\n                            </Typography>\r\n                            {/* <br /><u>Click the icon to get more information</u> */}\r\n                        </React.Fragment>\r\n                    </StyledInfoButton>\r\n                </div>\r\n                <LayerControls>\r\n                    <IconButton onClick={props.removeLayer}>\r\n                        <RemoveCircleIcon />\r\n                    </IconButton>\r\n                    <Typography> Hidden Layers: {props.config.networkShape.length - 2}</Typography>\r\n                    <IconButton onClick={props.addLayer}>\r\n                        <AddCircleIcon />\r\n                    </IconButton>\r\n                </LayerControls>\r\n                <Container style={{ gridArea: \"inputs-layer\", paddingLeft: \"60px\" }}>\r\n                    <Layer>\r\n                        {network && Object.keys(INPUTS).map(nodeId =>\r\n                            <NNNode\r\n                                id={`node-${nodeId}`}\r\n                                nodeId={nodeId}\r\n                                active={props.inputs[nodeId]}\r\n                                nodeWidth={nodeWidth}\r\n                                numCells={20}\r\n                                decisionBoundary={props.decisionBoundaries[nodeId]}\r\n                                discreetBoundary={props.discreetBoundary}\r\n                                handleOnClick={props.handleOnClick}\r\n                            />\r\n                        )}\r\n                    </Layer>\r\n                </Container>\r\n                <Container style={{ width: \"100%\", height: \"100%\", paddingLeft: \"0px\", justifyContent: \"space-around\", gridArea: \"hidden-layers\" }}>\r\n                    {network && network.slice(1, network.length - 1).map((layer, layerNum) =>\r\n                        <div style={{ display: \"flex\", flexDirection: \"column\" }}>\r\n                            <Layer style={{ flexGrow: 1 }}>\r\n                                {layer.map(node => <NNNode\r\n                                    id={`node-${node.id}`}\r\n                                    nodeWidth={nodeWidth}\r\n                                    numCells={20}\r\n                                    active={true}\r\n                                    decisionBoundary={props.decisionBoundaries[node.id]}\r\n                                    discreetBoundary={props.discreetBoundary}\r\n                                />)}\r\n                            </Layer>\r\n                            {(layerNum !== network.length - 2) && <PlusMinusButtonsContainer style={{ flexGrow: 0 }}>\r\n                                <IconButton onClick={() => props.removeNode(layerNum + 1)}>\r\n                                    <RemoveCircleIcon />\r\n                                </IconButton>\r\n                                <IconButton onClick={() => props.addNode(layerNum + 1)}>\r\n                                    <AddCircleIcon />\r\n                                </IconButton>\r\n                            </PlusMinusButtonsContainer>}\r\n                        </div>)}\r\n                </Container>\r\n                <Container style={{ width: \"100%\", height: \"100%\", paddingLeft: \"0px\", gridArea: \"output\", paddingRight: \"10px\" }}>\r\n                    {network && network.slice(network.length - 1).map((layer, layerNum) =>\r\n                        <div style={{ display: \"flex\", flexDirection: \"column\" }}>\r\n                            <Layer style={{ flexGrow: 1 }}>\r\n                                {layer.map(node => <NNNode\r\n                                    id={`node-${node.id}`}\r\n                                    nodeWidth={nodeWidth}\r\n                                    numCells={20}\r\n                                    active={true}\r\n                                    decisionBoundary={props.decisionBoundaries[node.id]}\r\n                                    discreetBoundary={props.discreetBoundary}\r\n                                />)}\r\n                            </Layer>\r\n                        </div>)}\r\n                </Container>\r\n                {/* <svg\r\n                    ref={svgContainer}\r\n                    width={containerBox.width}\r\n                    height={containerBox.height}\r\n                    style={{ position: \"absolute\", pointerEvents: \"none\" }}\r\n                    id={'lines-container'}\r\n                    className={\"testg\"}\r\n                /> */}\r\n            </GridContainer>\r\n            <MouseTooltip\r\n                visible={showHoverCard}\r\n                // offsetX={containerBox.left}\r\n                // offsetY={containerBox.top}\r\n                style={{ /* position: \"absolute\"  ,*/ pointerEvents: \"none\" }}\r\n            >\r\n                <HoverCard>\r\n                    {(hoverCardConfig.type === HoverCardType.WEIGHT) && <p>Weight: {hoverCardConfig.value.toFixed(3)}</p>}\r\n                    {(hoverCardConfig.type === HoverCardType.BIAS) && <p>Bias: {hoverCardConfig.value.toFixed(3)}</p>}\r\n                </HoverCard>\r\n            </MouseTooltip>\r\n        </>\r\n    );\r\n}\r\n\r\nexport default NeuralNetworkVis;","import React, { useEffect, useState } from 'react';\r\n// import PropTypes from 'prop-types';\r\n\r\ninterface Point2D {\r\n    x: number;\r\n    y: number;\r\n}\r\n\r\ninterface TooltipProps {\r\n    className?: string;\r\n    visible: boolean;\r\n    offsetX?: number;\r\n    offsetY?: number;\r\n    style?: object;\r\n}\r\n\r\nconst MouseTooltip: React.FC<TooltipProps> = ({\r\n    offsetX = 0,\r\n    offsetY = 0,\r\n    ...args\r\n}) => {\r\n    const props = { offsetX, offsetY, ...args };\r\n    //   static defaultProps = {\r\n    //     visible: true,\r\n    //     offsetX: 0,\r\n    //     offsetY: 0,\r\n    //   };\r\n\r\n    //   state = {\r\n    //     xPosition: 0,\r\n    //     yPosition: 0,\r\n    //     mouseMoved: false,\r\n    //     listenerActive: false,\r\n    //   };\r\n\r\n    //   const [xPosition, setXPosition] = useState<number>(0);\r\n    //   const [yPositionm, setYPosition] = useState<number>(0);\r\n    const [position, setPosition] = useState<Point2D>({ x: 0, y: 0 });\r\n    const [mouseMoved, setMouseMoved] = useState<boolean>(false);\r\n    const [listenerActive, setListenerActive] = useState<boolean>(false);\r\n\r\n\r\n    useEffect(() => {\r\n        // window.addEventListener('mousemove', getTooltipPosition);\r\n        // setListenerActive(true);\r\n        addListener();\r\n        return () => {\r\n            // window.removeEventListener('mousemove', getTooltipPosition);\r\n            // setListenerActive(false);\r\n            removeListener();\r\n        }\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        if (!listenerActive && props.visible) {\r\n            addListener();\r\n        }\r\n\r\n        if (listenerActive && !props.visible) {\r\n            removeListener();\r\n        }\r\n    }, [props.visible, mouseMoved]);\r\n\r\n    //   componentDidMount() {\r\n    //     this.addListener();\r\n    //   }\r\n\r\n    //   componentDidUpdate() {\r\n    //     this.updateListener();\r\n    //   }\r\n\r\n    //   componentWillUnmount() {\r\n    //     this.removeListener();\r\n    //   }\r\n\r\n    const getTooltipPosition = (event: MouseEvent) => {\r\n        setPosition({ x: event.clientX, y: event.clientY });\r\n        setMouseMoved(true);\r\n        // Maybe have one state object\r\n        // this.setState({\r\n        //   xPosition,\r\n        //   yPosition,\r\n        //   mouseMoved: true,\r\n        // });\r\n    };\r\n\r\n    //   addListener = () => {\r\n    //     window.addEventListener('mousemove', this.getTooltipPosition);\r\n    //     this.setState({ listenerActive: true });\r\n    //   };\r\n\r\n      const addListener = () => {\r\n        window.addEventListener('mousemove', getTooltipPosition);\r\n        setListenerActive(true);\r\n      };\r\n\r\n    //   removeListener = () => {\r\n    //     window.removeEventListener('mousemove', this.getTooltipPosition);\r\n    //     this.setState({ listenerActive: false });\r\n    //   };\r\n\r\n      const removeListener = () => {\r\n        window.removeEventListener('mousemove', getTooltipPosition);\r\n            setListenerActive(false);\r\n      };\r\n\r\n    //   updateListener = () => {\r\n    //     if (!this.state.listenerActive && this.props.visible) {\r\n    //       this.addListener();\r\n    //     }\r\n\r\n    //     if (this.state.listenerActive && !this.props.visible) {\r\n    //       this.removeListener();\r\n    //     }\r\n    //   };\r\n\r\n    return (\r\n        <div\r\n            className={props.className}\r\n            style={{\r\n                display: props.visible && mouseMoved ? 'block' : 'none',\r\n                position: 'fixed',\r\n                top: position.y + props.offsetY,\r\n                left: position.x + props.offsetX,\r\n                ...props.style,\r\n            }}\r\n        >\r\n            {props.children}\r\n        </div>\r\n    );\r\n}\r\n\r\n// MouseTooltip.propTypes = {\r\n//   visible: PropTypes.bool,\r\n//   children: PropTypes.node.isRequired,\r\n//   offsetX: PropTypes.number,\r\n//   offsetY: PropTypes.number,\r\n//   className: PropTypes.string,\r\n//   style: PropTypes.object, // eslint-disable-line react/forbid-prop-types\r\n// };\r\n\r\nexport default MouseTooltip;","import React from \"react\";\r\nimport { NNConfig } from \"../MainPage\";\r\n\r\nfunction LossInfoPanel(props: NNConfig) {\r\n\r\n    return (\r\n        <div>\r\n            <h1>Loss</h1>\r\n            <p></p>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default LossInfoPanel;","import * as  d3 from \"d3\";\r\nimport React, { useEffect, useRef, useState } from \"react\";\r\n\r\ninterface ColourScaleProps {\r\n    width: number;\r\n    height: number;\r\n    minColour: string;\r\n    midColour: string;\r\n    maxColour: string;\r\n    minValue: number;\r\n    midValue: number;\r\n    maxValue: number;\r\n    numShades: number;\r\n    horizontal: boolean;\r\n}\r\n\r\nfunction ColourScale(props: ColourScaleProps) {\r\n\r\n    const d3ContainerRef: any = useRef<any>(null);\r\n    const canvasRef: any = useRef<any>(null);\r\n\r\n    const marginTop = 4;\r\n    const marginLeft = props.horizontal ? 8 : 20;\r\n    const marginBottom = props.horizontal ? 20 : 4;\r\n    const marginRight = 8;\r\n\r\n    useEffect(() => {\r\n        createScale();\r\n    }, [])\r\n\r\n    const createScale = () => {\r\n        const svg = d3.select(d3ContainerRef.current)\r\n            .attr(\"width\", props.width + marginLeft + marginRight)\r\n            .attr(\"height\", props.height + marginBottom + marginTop);\r\n\r\n        svg.selectAll(\"*\").remove();\r\n\r\n        const scale = d3.scaleLinear()\r\n            .domain([-1, 1])\r\n            .range(props.horizontal ? [0, props.width -1] : [props.height -1, 0]);\r\n\r\n        const colourScale = svg.append(\"g\")\r\n            .attr(\"transform\", `translate(${marginLeft}, ${marginTop})`);\r\n\r\n        colourScale.append(\"g\")\r\n            .attr(\"transform\", `translate(0,${props.horizontal ? props.height : 0})`)\r\n            .call((props.horizontal ? d3.axisBottom(scale) : d3.axisLeft(scale)).tickValues([0].concat(scale.ticks(2))).tickSize(3));\r\n\r\n        let tmpScale = d3.scaleLinear<string, number>()\r\n            .domain([0, 0.5, 1])\r\n            .range([props.minColour, props.midColour, props.maxColour])\r\n            .clamp(true);\r\n\r\n        let numShades = props.numShades || 100;\r\n\r\n        let colors = d3.range(0, 1 + 1E-9, 1 / numShades).map(a => {\r\n            return tmpScale(a) || 0;\r\n        });\r\n\r\n        let color: any = d3.scaleQuantize()\r\n            .domain(props.horizontal ? [0,props.width] : [0, props.height])\r\n            .range(colors);\r\n\r\n        const canvas = canvasRef.current;\r\n        const context = canvas?.getContext(\"2d\");\r\n        if (!context) return;\r\n        let imageWidth = props.horizontal ? props.width : 1;\r\n        let imageHeight = props.horizontal ? 1 : props.height;\r\n        let imageData = context.createImageData(imageWidth, imageHeight);\r\n\r\n        if (!imageData) return;\r\n\r\n        const data = imageData.data;\r\n        let iter = -1;\r\n\r\n        for (let i = (props.horizontal ? 0 : props.height); props.horizontal ? i <= props.width : i >= 0; props.horizontal ? i++ : i--) {\r\n            // let value: number = props.decisionBoundary[i];\r\n            // if(props.discreetBoundary) value = value > 0 ? 1 : -1;\r\n            let c = d3.rgb(color(i));\r\n            data[++iter] = c.r;\r\n            data[++iter] = c.g;\r\n            data[++iter] = c.b;\r\n            data[++iter] = 200;\r\n        }\r\n        context.putImageData(imageData, 0, 0);\r\n\r\n        colourScale.select(\".domain\")\r\n            .attr(\"opacity\", \"0\");\r\n        \r\n        // let delta = Date.now() - start;\r\n    }\r\n\r\n\r\n    return (\r\n        <div style={{ position: \"relative\" }}>\r\n            <svg\r\n                ref={d3ContainerRef}\r\n                width={props.width + marginLeft}\r\n                height={props.height + marginBottom + marginTop}\r\n                style={{ position: \"absolute\" }}\r\n            />\r\n            <canvas\r\n                ref={canvasRef}\r\n                // id={props.id}\r\n                // className=\"background\"\r\n                width={props.horizontal ? props.width : 1}\r\n                height={props.horizontal ? 1 : props.height}\r\n                style={{\r\n                    width: `${props.width}px`,\r\n                    height: `${props.height}px`,\r\n                    paddingLeft: `${marginLeft}px`,\r\n                    paddingTop: `${marginTop}px`,\r\n                    paddingRight: `${marginRight}px`,\r\n                    paddingBottom: `${marginBottom}px`,\r\n                    // paddingRight: `${props.padding && props.paddingRight ? props.paddingRight : \"0\"}px`,\r\n                    // paddingTop: `${props.padding && props.paddingTop ? props.paddingTop: \"0\"}px`,\r\n                    // paddingBottom: `${props.padding && props.paddingBottom ? props.paddingBottom : \"0\"}px`,\r\n                }}\r\n            />\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default ColourScale;","import React, { useContext, useEffect, useState } from 'react';\r\nimport * as vis from '../visControl';\r\nimport { Dataset2D } from '../datasets';\r\nimport NNGraph from './NNGraph';\r\nimport { Button, InputLabel, MenuItem, Select, FormControl, Typography, Divider, IconButton } from '@material-ui/core';\r\nimport * as nn from './../NeuralNet';\r\nimport styled from '@emotion/styled';\r\nimport LabeledSlider from './Slider';\r\nimport InfoButton from './InfoButton';\r\nimport DefaultInfoPanel from './InfoPanels/DefaultInfoPanel';\r\nimport LearningInfoRatePanel from './InfoPanels/LearningRateInfoPanel';\r\nimport ActivationInfoPanel from './InfoPanels/ActivationInfoPanel';\r\nimport { ArrowBackIos, ArrowForwardIos, GitHub, Home } from '@material-ui/icons';\r\nimport DatasetInfoPanel from './InfoPanels/DatasetInfoPanel';\r\nimport NeuralNetworkVis from './NeuralNetworkVis';\r\nimport LossGraph from './LossGraph';\r\nimport LossInfoPanel from './InfoPanels/LossInfoPanel';\r\nimport { DefinedTerm, DefX1, DefX2 } from './Definitions';\r\nimport { ThemeContext } from '../contexts/ThemeContext';\r\nimport ColourScale from './ColourScale';\r\n\r\nexport interface NNConfig {\r\n    networkShape: number[];\r\n    activationFunction: string;\r\n    learningRate: number;\r\n    inputs: { [key: string]: boolean };\r\n    batchSize: number;\r\n}\r\n\r\ninterface PageProps {\r\n    xDomain: number[];\r\n    yDomain: number[];\r\n    numCells: number;\r\n    updateComparisionData: (currentState: NetworkState, savedState: NetworkState) => void;\r\n}\r\n\r\nconst StyledButton = styled(Button)`\r\n    margin: 5px;\r\n`;\r\n\r\nconst StyledFormControl = styled(FormControl)`\r\n    margin-left: 10px;\r\n    min-width: 130px;\r\n    background-color: inherit;\r\n`;\r\n\r\nconst StyledSelect = styled(Select)`\r\n    background-color: inherit;\r\n`;\r\n\r\nconst Container = styled(\"div\")`\r\n    -webkit-box-sizing: border-box; /* Safari/Chrome, other WebKit */\r\n    -moz-box-sizing: border-box;    /* Firefox, other Gecko */\r\n    box-sizing: border-box; \r\n    margin: 0px auto auto auto;\r\n    display: grid;\r\n    width: auto;\r\n    /* min-width: 1400px; */\r\n    min-height: 600px;\r\n    transition: padding 0.4s ease-in-out;\r\n    padding: 20px;\r\n    padding-left: 20px;\r\n    padding-right: 20px;\r\n    \r\n    /* max-width: 100%; */\r\n\r\n    // Using values from NeuralNetworkVis for middle column\r\n    grid-template-columns: 230px max(560px, calc(50vw + 10px)) min-content;\r\n    grid-template-rows: 90px 1fr 80px auto;\r\n    grid-gap: 15px;\r\n    grid-template-areas: \r\n        \"config-bar config-bar config-bar\"\r\n        \"control-panel network nn-graph\"\r\n        \"stats stats stats\"\r\n        \"info info info\";\r\n`;\r\n\r\nconst StyledLinkButton = styled(IconButton)`\r\n    color: #ffffff;\r\n`;\r\n\r\nconst LinksDiv = styled(\"div\")`\r\n    display: flex;\r\n    align-content: flex-end;\r\n`;\r\n\r\n\r\nconst ContainerSection = styled(\"div\")`\r\n    -webkit-box-sizing: border-box; /* Safari/Chrome, other WebKit */\r\n    -moz-box-sizing: border-box;    /* Firefox, other Gecko */\r\n    box-sizing: border-box; \r\n    grid-area: ${(props: { gridArea: string }) => (props.gridArea)};\r\n    background-color: white;\r\n    margin: auto auto;\r\n    width: 100%;\r\n    height: 100%;\r\n    padding: 5px;\r\n    border-radius: 30px;\r\n    border: 2px solid #bdbdbd;\r\n    display: flex;\r\n    flex-direction: row;\r\n    justify-content: center;\r\n`;\r\n\r\n// Fix so that this doesn't use hard coded paddings\r\nconst ConfigBar = styled((props: any) => <ContainerSection gridArea=\"config-bar\" {...props} />)`\r\n    display: flex;\r\n    flex-direction: row;\r\n    justify-content: left;\r\n    padding-left: 30px;\r\n    padding-top: 10px;\r\n`;\r\n\r\nconst ControlPanel = styled((props: any) => <ContainerSection gridArea=\"control-panel\" {...props} />)`\r\n    display: flex;\r\n    flex-direction: column;\r\n    align-items: stretch;\r\n    padding-top: 15px;\r\n    padding-bottom: 15px;\r\n    padding-left: 10px;\r\n    padding-right: 10px;\r\n    justify-content: left;\r\n`;\r\n\r\nconst NetworkPanel = styled((props: any) => <ContainerSection gridArea=\"network\" {...props} />)`\r\n    display: flex;\r\n    flex-direction: column;\r\n    justify-content: space-between;\r\n    /* max-width: fit-content; */\r\n`\r\n\r\nconst GraphPanel = styled((props: any) => <ContainerSection gridArea=\"nn-graph\" {...props} />)`\r\n    display: block;\r\n`\r\n\r\nconst StatsBar = styled((props: any) => <ContainerSection gridArea=\"stats\" {...props} />)`\r\n    display: flex;\r\n    flex-direction: row;\r\n    align-items: stretch;\r\n    padding: 0px;\r\n    justify-content: space-around;\r\n    align-items: center;\r\n`;\r\n\r\nconst InfoPanel = styled((props: any) => <ContainerSection gridArea=\"info\" {...props} />)`\r\n    display: flex;\r\n    flex-direction: row;\r\n    justify-content: left;\r\n    padding-left: 30px;\r\n    padding-top: 10px;\r\n    position: relative;\r\n    max-width: inherit;\r\n    /* max-width: fit-content; */\r\n`;\r\n\r\nconst NeuralNetworkControls = styled(\"div\")`\r\n    display: flex;\r\n    flex-direction: row;\r\n    justify-content: space-around;\r\n    align-items: center;\r\n`;\r\n\r\nexport const StyledInfoButton = styled(InfoButton)`\r\n    font-size: 14px;\r\n`\r\n\r\nfunction removeItemOnce(arr: string[], value: string) {\r\n    var index = arr.indexOf(value);\r\n    if (index > -1) {\r\n        arr.splice(index, 1);\r\n    }\r\n    return arr;\r\n}\r\n\r\nconst ColouredBox = styled(\"div\")`\r\n    float: left;\r\n    height: 1em;\r\n    width: 1em;\r\n    border: 1px solid black;\r\n    background-color: ${((props: { colour: string }) => props.colour)};\r\n    clear: both;\r\n    margin-right: 5px;\r\n`\r\n\r\nexport interface NetworkState {\r\n    noise: number;\r\n    datasetType: string;\r\n    dataset: Dataset2D[];\r\n    config: NNConfig;\r\n    decisionBoundaries: { [nodeId: string]: number[] };\r\n    decisionBoundary: number[];\r\n    loss: number;\r\n    epochs: number;\r\n    lossData: [number, number][];\r\n}\r\n\r\n\r\nfunction MainPage(props: PageProps) {\r\n    const { minColour, minColourName, maxColour, maxColourName, midColour } = useContext(ThemeContext);\r\n\r\n    const [numSamples, setNumSamples] = useState<number>(100);\r\n    const [noise, setNoise] = useState<number>(0.2);\r\n    const [datasetType, setDatasetType] = useState<string>(\"Gaussian2\");\r\n    const [dataset, setDataset] = useState<Dataset2D[]>([]);\r\n    const [config, setConfig] = useState<NNConfig>(\r\n        {\r\n            networkShape: [2, 2, 2, 1],\r\n            activationFunction: \"Tanh\",\r\n            learningRate: 0.03,\r\n            inputs: {\r\n                \"x\": true,\r\n                \"y\": true,\r\n                \"xSquared\": false,\r\n                \"ySquared\": false,\r\n                \"xTimesY\": false,\r\n                \"sinX\": false,\r\n                \"sinY\": false\r\n            },\r\n            batchSize: 10, // CHange this back to 10\r\n        }\r\n    );\r\n    const [network, setNetwork] = useState<nn.Node[][]>();\r\n    const [decisionBoundaries, setDecisionBoundaries] = useState<{ [nodeId: string]: number[] }>({});\r\n    const [decisionBoundary, setDecisionBoundary] = useState<number[]>([]);\r\n    const [loss, setLoss] = useState<number>(0);\r\n    const [epochs, setEpochs] = useState<number>(0);\r\n    const [discreetBoundary, setDiscreetBoundary] = useState<boolean>(false);\r\n    const [lossData, setLossData] = useState<[number, number][]>([]);\r\n    const [training, setTraining] = useState<boolean>(false);\r\n    const [trainingInterval, setTrainingInterval] = useState<number>();\r\n    const [networkSeed, setNetworkSeed] = useState<string>();\r\n    const [compareMode, setCompareMode] = useState<boolean>(false);\r\n    const [infoPanel, setInfoPanel] = useState<JSX.Element>(<DefaultInfoPanel{...config} />);\r\n    const [networkOriginalState, setNetworkOriginalState] = useState<nn.Node[][]>();\r\n    const [networkSaveState, setNetworkSaveState] = useState<nn.Node[][]>();\r\n    const [infoPanelHistory, setInfoPanelHistory] = useState<JSX.Element[]>([]);\r\n    const [infoPanelFuture, setInfoPanelFuture] = useState<JSX.Element[]>([]);\r\n\r\n    const [comparisonData, setComaparisonData] = useState<NetworkState>();\r\n\r\n    useEffect(() => {\r\n        console.log(\"Config change useEffect\");\r\n        if (training) toggleAutoTrain();\r\n        generateNetwork();\r\n        generateDataset();\r\n    }, [config])\r\n\r\n    useEffect(() => {\r\n        updateDecisionBoundary();\r\n    }, [decisionBoundaries])\r\n\r\n    useEffect(() => {\r\n        console.log(\"Config change useEffect\");\r\n        updateDecisionBoundaries();\r\n    }, [network])\r\n\r\n\r\n    useEffect(() => {\r\n        console.log(\"Dataset/Noise change useEffect\");\r\n        reset();\r\n    }, [datasetType, noise, numSamples])\r\n\r\n    useEffect(() => {\r\n        if (epochs === 0 || !network) return;\r\n        setLossData(lossData => lossData.concat([[epochs, vis.getCost(network, dataset, config.inputs)]]));\r\n    }, [epochs])\r\n\r\n\r\n    const generateDataset = () => {\r\n        console.log(\"Generating dataset\");\r\n        setDataset(vis.getDataset(datasetType, numSamples, noise));\r\n    }\r\n\r\n    const generateNetwork = () => {\r\n        console.log(\"Generating network\");\r\n\r\n        if (!compareMode) {\r\n            let newNetwork = vis.start(config);\r\n            setNetwork(newNetwork);\r\n            let newNetworkCopy = vis.copyNetwork(newNetwork);\r\n            console.log(newNetworkCopy);\r\n            setNetworkOriginalState(newNetworkCopy);\r\n        } else {\r\n            console.log(\"Loading network original state\");\r\n            if (networkOriginalState) {\r\n                console.log(networkOriginalState);\r\n                setNetwork(vis.copyNetwork(networkOriginalState));\r\n            }\r\n        }\r\n        setEpochs(0);\r\n        setLossData([]);\r\n    }\r\n\r\n    const updateDecisionBoundaries = () => {\r\n        // console.log(\"Updating decision boundaries\");\r\n        if (network) {\r\n            // Don't like numcells having to be the same\r\n            setDecisionBoundaries(vis.getAllDecisionBoundaries(network, 20, props.xDomain, props.yDomain, config.inputs));\r\n            dataset && setLoss(vis.getCost(network, dataset, config.inputs));\r\n        }\r\n    }\r\n\r\n    const updateDecisionBoundary = () => {\r\n        // console.log(\"Updating decision boundary\");\r\n        network && setDecisionBoundary(vis.getOutputDecisionBoundary1D(network, props.numCells, props.xDomain, props.yDomain, config.inputs));\r\n    }\r\n\r\n    const reset = () => {\r\n        console.log(\"Reset\");\r\n        if (training) toggleAutoTrain();\r\n        generateNetwork();\r\n        if (!compareMode) generateDataset();\r\n    };\r\n\r\n    const step = (noSteps: number) => {\r\n        console.log(`MainPage step(${noSteps})`);\r\n        if (!network || !dataset) return;\r\n\r\n        let start = Date.now();\r\n        for (let i = 0; i < noSteps; i++) {\r\n            vis.step(network, dataset, config.learningRate, config.inputs, config.batchSize);\r\n            setEpochs(epochs => epochs + 1);\r\n        }\r\n\r\n\r\n        let delta = Date.now() - start;\r\n        // console.log(`Finished training step(${noSteps}) (Duration ${delta}ms)`);\r\n\r\n        start = Date.now();\r\n        updateDecisionBoundaries();\r\n        delta = Date.now() - start;\r\n        // console.log(`Finsihed updating decision boundaries (Duration ${delta}ms)`);\r\n        // console.log(lossData);\r\n    };\r\n\r\n    const toggleDiscreetOutput = () => {\r\n        setDiscreetBoundary(!discreetBoundary);\r\n    };\r\n\r\n    const handleActivationChange = (e: React.ChangeEvent<{ value: unknown }>) => {\r\n        setConfig({ ...config, activationFunction: e.target.value as string });\r\n    };\r\n\r\n    const handleLearningRateChange = (e: React.ChangeEvent<{ value: unknown }>) => {\r\n        setConfig({ ...config, learningRate: e.target.value as number });\r\n    };\r\n\r\n    const handleDatasetChange = (e: React.ChangeEvent<{ value: unknown }>) => {\r\n        setDatasetType(e.target.value as string);\r\n    };\r\n\r\n    const handleRegenerateDataset = () => {\r\n        generateDataset();\r\n        if (training) toggleAutoTrain();\r\n    };\r\n\r\n    const handleNoiseChange = (e: any, newValue: number | number[]) => {\r\n        setNoise(newValue as number);\r\n    };\r\n\r\n    const handleNumSamplesChange = (e: any, newValue: number | number[]) => {\r\n        setNumSamples(newValue as number);\r\n    }\r\n\r\n    const handleBatchSizeChange = (e: any, newValue: number | number[]) => {\r\n        setConfig({ ...config, batchSize: newValue as number });\r\n    }\r\n\r\n    const handleInputNodeClick = (nodeId: string, active: boolean) => {\r\n        // console.log(`Input node click (NodeId: ${nodeId}, Active: ${active})`);\r\n        // Change this implemntation input is highly coupled with visControl\r\n        let newInputs: { [inputId: string]: boolean } = { ...config.inputs };\r\n        let newNetworkShape = config.networkShape;\r\n\r\n        if (active) {\r\n            let noActiveNodes = 0;\r\n            Object.keys(config.inputs).forEach((inputId) => { if (config.inputs[inputId]) noActiveNodes++; });\r\n            if (noActiveNodes > 1) {\r\n                newInputs[nodeId] = false;\r\n                newNetworkShape[0] = newNetworkShape[0] - 1;\r\n            } else {\r\n                return;\r\n            }\r\n        } else {\r\n            newInputs[nodeId] = true;\r\n            newNetworkShape[0] = newNetworkShape[0] + 1;\r\n        }\r\n        setConfig({ ...config, inputs: newInputs, networkShape: newNetworkShape });\r\n    }\r\n\r\n    const removeLayer = () => {\r\n        console.log(\"Running removeLayer\");\r\n        if (config.networkShape.length > 2) {\r\n            let newNetworkShape = config.networkShape;\r\n            newNetworkShape.pop();\r\n            newNetworkShape.pop();\r\n            newNetworkShape.push(1);\r\n            console.log(newNetworkShape);\r\n            setConfig({ ...config, networkShape: newNetworkShape });\r\n        }\r\n    }\r\n\r\n    const addLayer = () => {\r\n        console.log(\"Running addLayer\");\r\n        if (config.networkShape.length < 6) {\r\n            let newNetworkShape = config.networkShape;\r\n            newNetworkShape.pop();\r\n            newNetworkShape.push(newNetworkShape[newNetworkShape.length - 1]);\r\n            newNetworkShape.push(1);\r\n            console.log(newNetworkShape);\r\n            setConfig({ ...config, networkShape: newNetworkShape });\r\n        }\r\n    }\r\n\r\n    const removeNode = (layerNum: number) => {\r\n        console.log(\"Running removeNode\");\r\n        if (config.networkShape[layerNum] > 1) {\r\n            let newNetworkShape = config.networkShape;\r\n            newNetworkShape[layerNum] = config.networkShape[layerNum] - 1;\r\n            setConfig({ ...config, networkShape: newNetworkShape });\r\n        }\r\n    }\r\n\r\n    const addNode = (layerNum: number) => {\r\n        console.log(\"Running addNode\");\r\n        if (config.networkShape[layerNum] < 5) {\r\n            let newNetworkShape = config.networkShape;\r\n            newNetworkShape[layerNum] = config.networkShape[layerNum] + 1;\r\n            setConfig({ ...config, networkShape: newNetworkShape });\r\n        }\r\n    }\r\n\r\n    const saveComparisionData = () => {\r\n        let newComparisionData: NetworkState = {\r\n            config: config,\r\n            dataset: dataset,\r\n            datasetType: datasetType,\r\n            decisionBoundaries: decisionBoundaries,\r\n            decisionBoundary: decisionBoundary,\r\n            epochs: epochs,\r\n            loss: loss,\r\n            lossData: lossData,\r\n            noise: noise\r\n        }\r\n\r\n        setComaparisonData(newComparisionData);\r\n    }\r\n\r\n    const toggleAutoTrain = () => {\r\n        if (training) {\r\n            clearInterval(trainingInterval);\r\n        } else {\r\n            setTrainingInterval(setInterval(() => {\r\n                step(1);\r\n            }, 500));\r\n        }\r\n        setTraining(!training);\r\n    }\r\n\r\n    const saveNetworkState = () => {\r\n        setCompareMode(true);\r\n    }\r\n\r\n    const loadOriginalState = () => {\r\n\r\n    }\r\n\r\n    const saveCurrentState = () => {\r\n        saveComparisionData();\r\n        setCompareMode(true);\r\n    }\r\n\r\n    const loadSavedState = () => {\r\n        reset();\r\n    }\r\n\r\n    const clearNetworkState = () => {\r\n        setComaparisonData(undefined);\r\n        setCompareMode(false);\r\n    }\r\n\r\n    const setInfoPanelWrapper = (newInfoPanel: JSX.Element) => {\r\n        console.log(newInfoPanel);\r\n        let newInfoPanelHistory = infoPanelHistory;\r\n        newInfoPanelHistory.push(infoPanel);\r\n        console.log(newInfoPanelHistory);\r\n        console.log(infoPanel)\r\n        setInfoPanel(newInfoPanel);\r\n        setInfoPanelHistory(newInfoPanelHistory);\r\n        setInfoPanelFuture([]);\r\n    }\r\n\r\n    const handleInfoPanelForward = () => {\r\n        if (infoPanelFuture.length !== 0) {\r\n            let newInfoPanelHistory = infoPanelHistory;\r\n            let newInfoPanelFuture = infoPanelFuture;\r\n            let newPanel = newInfoPanelFuture.shift();\r\n\r\n            newInfoPanelHistory.push(infoPanel);\r\n\r\n            setInfoPanelHistory(newInfoPanelHistory);\r\n            setInfoPanelFuture(newInfoPanelFuture);\r\n            if (newPanel) setInfoPanel(newPanel);\r\n        }\r\n    }\r\n\r\n    const handleInfoPanelBackward = () => {\r\n        if (infoPanelHistory.length !== 0) {\r\n            let newInfoPanelHistory = infoPanelHistory;\r\n            let newInfoPanelFuture = infoPanelFuture;\r\n            let newPanel = newInfoPanelHistory.pop();\r\n\r\n            newInfoPanelFuture.unshift(infoPanel);\r\n\r\n            setInfoPanelHistory(newInfoPanelHistory);\r\n            setInfoPanelFuture(newInfoPanelFuture);\r\n            if (newPanel) setInfoPanel(newPanel);\r\n        }\r\n    }\r\n\r\n    const handleInfoPanelHome = () => {\r\n        setInfoPanelWrapper(<DefaultInfoPanel{...config}/>);\r\n    }\r\n\r\n    return (\r\n        <Container id=\"main-page\">\r\n            <ConfigBar>\r\n                <StyledFormControl variant=\"filled\">\r\n                    <InputLabel>Activation</InputLabel>\r\n                    <StyledSelect\r\n                        value={config.activationFunction}\r\n                        onChange={handleActivationChange}\r\n                    >\r\n                        <MenuItem value=\"Tanh\">Tanh</MenuItem>\r\n                        <MenuItem value=\"ReLU\">ReLU</MenuItem>\r\n                        <MenuItem value=\"Sigmoid\">Sigmoid</MenuItem>\r\n                    </StyledSelect>\r\n                </StyledFormControl>\r\n                <StyledInfoButton title=\"Activation Tooltip\" onClick={setInfoPanelWrapper} infoPanel={<ActivationInfoPanel config={config} setInfoPanel={setInfoPanelWrapper} />}>\r\n                    <React.Fragment>\r\n                        <Typography color=\"inherit\">Activation Function (&Phi;)</Typography>\r\n                        <Typography variant=\"body2\">The activation defines the output of a neuron (node).</Typography><br />\r\n                        <u>Click the icon to get more information</u>\r\n                    </React.Fragment>\r\n                </StyledInfoButton>\r\n                <Divider orientation=\"vertical\" flexItem />\r\n                <StyledFormControl variant=\"filled\">\r\n                    <InputLabel>Learning Rate</InputLabel>\r\n                    <StyledSelect\r\n                        value={config.learningRate}\r\n                        onChange={handleLearningRateChange}\r\n                    >\r\n                        <MenuItem value=\"0.03\">0.03</MenuItem>\r\n                        <MenuItem value=\"0.005\">0.005</MenuItem>\r\n                    </StyledSelect>\r\n                </StyledFormControl>\r\n                <StyledInfoButton title=\"Learning Rate Tooltip\" onClick={setInfoPanelWrapper} infoPanel={<LearningInfoRatePanel {...config} />}>\r\n                    <React.Fragment>\r\n                        <Typography color=\"inherit\">Learning Rate (&epsilon;)</Typography>\r\n                        <Typography variant=\"body2\">This affects the rate at which the weights and biases change when training the neural network.</Typography><br />\r\n                        <u>Click the icon to get more information</u>\r\n                    </React.Fragment>\r\n                </StyledInfoButton>\r\n                <Divider orientation=\"vertical\" flexItem />\r\n                <StyledFormControl variant=\"filled\">\r\n                    <InputLabel>Dataset</InputLabel>\r\n                    <StyledSelect\r\n                        value={datasetType}\r\n                        onChange={handleDatasetChange}\r\n                    >\r\n                        <MenuItem value=\"Gaussian2\">2 Gaussian</MenuItem>\r\n                        <MenuItem value=\"Gaussian3\">3 Gaussian</MenuItem>\r\n                        <MenuItem value=\"XOR\">XOR</MenuItem>\r\n                    </StyledSelect>\r\n                </StyledFormControl>\r\n                <StyledInfoButton title=\"Dataset Tooltip\" onClick={setInfoPanelWrapper} infoPanel={<DatasetInfoPanel {...config} />}>\r\n                    <React.Fragment>\r\n                        <Typography color=\"inherit\">Datasets</Typography>\r\n                        <Typography variant=\"body2\">Defines the shape of the dataset we want our neural network to solve.</Typography><br />\r\n                        <u>Click the icon to get more information</u>\r\n                    </React.Fragment>\r\n                </StyledInfoButton>\r\n                <Divider orientation=\"vertical\" flexItem />\r\n                <LabeledSlider\r\n                    label=\"Dataset Size\"\r\n                    min={10}\r\n                    step={10}\r\n                    max={500}\r\n                    defaultValue={numSamples}\r\n                    onChange={handleNumSamplesChange}\r\n                    appendValueToLabel={true}\r\n                />\r\n                <StyledInfoButton title=\"Sample Size Tooltip\">\r\n                    <React.Fragment>\r\n                        {/* <Typography color=\"inherit\">Noise</Typography> */}\r\n                        <Typography variant=\"body2\">Changes the number of samples in the dataset. <br />(Training is done using 80% of the samples and the remaining 20% are used as the test dataset. </Typography>\r\n                    </React.Fragment>\r\n                </StyledInfoButton>\r\n                <Divider orientation=\"vertical\" flexItem />\r\n                <LabeledSlider\r\n                    label=\"Noise\"\r\n                    min={0}\r\n                    step={0.1}\r\n                    max={1}\r\n                    defaultValue={noise}\r\n                    onChange={handleNoiseChange}\r\n                    appendValueToLabel={true}\r\n                />\r\n                <StyledInfoButton title=\"Noise Tooltip\">\r\n                    <React.Fragment>\r\n                        <Typography color=\"inherit\">Noise</Typography>\r\n                        <Typography variant=\"body2\">This sets the noise in the generated data set. The more noise the greater the variance in the generated data.</Typography>\r\n                    </React.Fragment>\r\n                </StyledInfoButton>\r\n                <Divider orientation=\"vertical\" flexItem />\r\n                <LabeledSlider\r\n                    label={\"Batch Size\"}\r\n                    min={1}\r\n                    step={1}\r\n                    max={10}\r\n                    defaultValue={config.batchSize}\r\n                    onChange={handleBatchSizeChange}\r\n                    appendValueToLabel={true}\r\n                />\r\n                <StyledInfoButton title=\"Batch Size Tooltip\">\r\n                    <React.Fragment>\r\n                        {/* <Typography color=\"inherit\">Noise</Typography> */}\r\n                        {/* Could create an info panel for Stochastic Gradient Decent*/}\r\n                        <Typography variant=\"body2\">Specifies the number of training samples used in each epoch of <a href=\"https://www.google.com/search?q=mini+batch+gradient+descent\" target=\"_blank\">Mini-Batch Gradient Decent</a>.<br />(When batch size = 1, this is equivalent to <a href=\"https://www.google.com/search?q=stochastic+gradient+descent\" target=\"_blank\">Stochastic Gradient Decent</a>) </Typography>\r\n                    </React.Fragment>\r\n                </StyledInfoButton>\r\n            </ConfigBar>\r\n            <ControlPanel>\r\n                <StyledButton variant={\"contained\"} onClick={() => step(1)}> Step 1</StyledButton>\r\n                <StyledButton variant={\"contained\"} onClick={() => toggleAutoTrain()}> Auto Train: <b>{training ? \"On\" : \"Off\"}</b></StyledButton>\r\n                <StyledButton variant={\"contained\"} onClick={toggleDiscreetOutput}> Toggle Discreet Boundary </StyledButton>\r\n                <StyledButton variant={\"contained\"} color={\"primary\"} onClick={handleRegenerateDataset}> Regenerate Dataset </StyledButton>\r\n                <StyledButton variant={\"contained\"} color={\"secondary\"} onClick={reset}> Reset </StyledButton>\r\n                <StyledButton variant={\"contained\"} onClick={saveCurrentState}> Save Current Network State </StyledButton>\r\n                <StyledButton variant={\"contained\"} onClick={loadSavedState} disabled={!compareMode}> Load Network State </StyledButton>\r\n                <StyledButton variant={\"contained\"} onClick={clearNetworkState}> Clear Network State </StyledButton>\r\n            </ControlPanel>\r\n\r\n            <GraphPanel>\r\n                <div style={{ display: \"flex\", marginLeft: \"25px\" }}>\r\n                    <Typography variant=\"h6\">Output</Typography>\r\n                    <StyledInfoButton title=\"Output Tooltip\" marginLeft={5} fontSize=\"small\" onClick={setInfoPanelWrapper} infoPanel={<LossInfoPanel {...config} />}>\r\n                        <React.Fragment>\r\n                            <Typography color=\"inherit\">Output</Typography>\r\n                            <Typography variant=\"body2\">This graph shows the final output of the neural network in the domain (-8, +8) for both the <DefinedTerm definition={DefX1()}>X<sub>1</sub></DefinedTerm> and <DefinedTerm definition={DefX2()}>X<sub>2</sub></DefinedTerm> features.<br /> The samples in the data sets used only have 2 classes (-1 and +1); the neural network defines a decision boundary so that points that are in<br /> {minColourName} <ColouredBox colour={minColour} /> sections of the graph are classified as class -1 and points that are in <br /> {maxColourName} <ColouredBox colour={maxColour} /> sections of the graph are classified as class +1.</Typography><br />\r\n                        </React.Fragment>\r\n                    </StyledInfoButton>\r\n                    <ColourScale\r\n                        width={150}\r\n                        height={15}\r\n                        maxColour={maxColour}\r\n                        minColour={minColour}\r\n                        midColour={midColour}\r\n                        maxValue={1}\r\n                        minValue={-1}\r\n                        midValue={0}\r\n                        numShades={100}\r\n                        horizontal={true}\r\n                    />\r\n                </div>\r\n                {dataset && network && <NNGraph\r\n                    dataset={dataset}\r\n                    density={25}\r\n                    canvasWidth={250}\r\n                    marginLeft={35}\r\n                    marginRight={20}\r\n                    marginTop={20}\r\n                    marginBottom={40}\r\n                    numCells={props.numCells}\r\n                    xDomain={props.xDomain}\r\n                    yDomain={props.yDomain}\r\n                    decisionBoundary={decisionBoundary}\r\n                    discreetBoundary={discreetBoundary}\r\n                />}\r\n                <div style={{ marginLeft: \"10px\" }}>\r\n                    <p style={{ marginTop: \"0px\", marginBottom:\"0px\" }}> Epochs: {epochs} </p>\r\n                    <div style={{ display: \"flex\", justifyContent: \"flex-start\" }}>\r\n                        <p style={{ marginTop: \"0px\", marginBottom: \"0px\" }}> Loss: {loss.toFixed(3)} </p>\r\n                        <StyledInfoButton title=\"Loss Tooltip\" marginLeft={5} fontSize=\"small\" onClick={setInfoPanelWrapper} infoPanel={<LossInfoPanel {...config} />}>\r\n                            <React.Fragment>\r\n                                <Typography color=\"inherit\">Loss</Typography>\r\n                                <Typography variant=\"body2\">This is loss calculated using the <a href=\"https://www.google.com/search?q=sum+squared+residuals\" target=\"_blank\">sum of squared residulals</a> between the output of our neural network and the expected output from out training set.</Typography><br />\r\n                                <u>Click the icon to get more information</u>\r\n                            </React.Fragment>\r\n                        </StyledInfoButton>\r\n                    </div>\r\n                    <LossGraph\r\n                        height={60}\r\n                        width={170}\r\n                        margin={5}\r\n                        dataset={lossData}\r\n                        comparisionData={comparisonData?.lossData} />\r\n                </div>\r\n            </GraphPanel>\r\n            <NetworkPanel>\r\n                {dataset && network && <NeuralNetworkVis\r\n                    network={network}\r\n                    decisionBoundaries={decisionBoundaries}\r\n                    discreetBoundary={discreetBoundary}\r\n                    inputs={config.inputs}\r\n                    config={config}\r\n                    networkWidth={650}\r\n                    networkHeight={550}\r\n                    handleOnClick={handleInputNodeClick}\r\n                    addNode={addNode}\r\n                    removeNode={removeNode}\r\n                    addLayer={addLayer}\r\n                    removeLayer={removeLayer}\r\n                    setInfoPanel={setInfoPanelWrapper}\r\n                />}\r\n            </NetworkPanel>\r\n            <StatsBar>\r\n\r\n            </StatsBar>\r\n            <InfoPanel>\r\n                {infoPanel}\r\n                <div style={{ position: \"absolute\", right: \"40px\", top: \"30px\" }}>\r\n                    <IconButton onClick={handleInfoPanelBackward}>\r\n                        <ArrowBackIos />\r\n                    </IconButton>\r\n                    <IconButton onClick={handleInfoPanelHome}>\r\n                        <Home fontSize={\"large\"}/>\r\n                    </IconButton>\r\n                    <IconButton onClick={handleInfoPanelForward}>\r\n                        <ArrowForwardIos />\r\n                    </IconButton>\r\n                </div>\r\n            </InfoPanel>\r\n            <LinksDiv>\r\n                <a href=\"https://git-teaching.cs.bham.ac.uk/mod-ug-proj-2020/bxg796\" target=\"_blank\">\r\n                    <StyledLinkButton>\r\n                        <GitHub color=\"inherit\" />\r\n                    </StyledLinkButton>\r\n                </a>\r\n            </LinksDiv>\r\n        </Container>\r\n    );\r\n}\r\n\r\nexport default MainPage;","import { useRef, useEffect, RefObject } from 'react';\r\n\r\n// From https://github.com/Junscuzzy/useHooks.ts\r\n\r\nfunction useEventListener<T extends HTMLElement = HTMLDivElement>(\r\n  eventName: string,\r\n  handler: (event: Event) => void,\r\n  element?: RefObject<T>,\r\n  useCapture?: boolean,\r\n) {\r\n  // Create a ref that stores handler\r\n  const savedHandler = useRef<(event: Event) => void>()\r\n  useEffect(() => {\r\n    // Define the listening target\r\n    const targetElement: T | Window = element?.current || window;\r\n    const capture = useCapture ? useCapture : false;\r\n    if (!(targetElement && targetElement.addEventListener)) {\r\n      return;\r\n    }\r\n    // Update saved handler if necessary\r\n    if (savedHandler.current !== handler) {\r\n      savedHandler.current = handler;\r\n    }\r\n    // Create event listener that calls handler function stored in ref\r\n    const eventListener = (event: Event) => {\r\n      // eslint-disable-next-line no-extra-boolean-cast\r\n      if (!!savedHandler?.current) {\r\n        savedHandler.current(event);\r\n      }\r\n    }\r\n    targetElement.addEventListener(eventName, eventListener, capture);\r\n    // Remove event listener on cleanup\r\n    return () => {\r\n      targetElement.removeEventListener(eventName, eventListener, capture);\r\n    }\r\n  }, [eventName, element, handler, useCapture]);\r\n}\r\nexport default useEventListener;","import { ThemeContext } from \"./contexts/ThemeContext\";\r\nimport styled from '@emotion/styled';\r\nimport { IconButton } from '@material-ui/core';\r\nimport { ArrowBackIos, ArrowForwardIos } from '@material-ui/icons';\r\nimport React, { createRef, useContext, useEffect, useState } from 'react';\r\nimport './App.css';\r\nimport ComparePage from './components/ComparePage';\r\nimport MainPage, { NetworkState } from './components/MainPage';\r\nimport useEventListener from './components/UseEventListener';\r\nimport { css, Global } from \"@emotion/react\";\r\n\r\n\r\n// export const ThemeContext = createContext<Partial<ThemeProps>>({});\r\n\r\nconst StyledMainPage = styled(MainPage)`\r\n\r\n`\r\n\r\nconst StyledComparePage = styled(ComparePage)`\r\n`\r\n\r\nconst StyledMargin = styled(\"div\")`\r\n    //min-width: 130px;\r\n    //max-width: 100%;\r\n`\r\n\r\nconst Container = styled(\"div\")`\r\n        -webkit-box-sizing: border-box; /* Safari/Chrome, other WebKit */\r\n        -moz-box-sizing: border-box;    /* Firefox, other Gecko */\r\n        box-sizing: border-box; \r\n        position: absolute;\r\n        display: flex;\r\n        /* justify-content: center; */\r\n        margin-top: auto;\r\n        min-height: 100vh;\r\n        width: calc(100vw - (100vw - 100%));\r\n        /* max-width: 100vw; */\r\n        overflow-x: auto;\r\n    \r\n\r\n    &.main {\r\n        margin-right: max(60px,);\r\n        left: 0%;\r\n        transition: all 0.7s ease-in-out;\r\n        &.active {\r\n        left: -100%;\r\n        }\r\n    }\r\n\r\n    &.compare {\r\n        left: 100%;\r\n        transition: all 0.7s ease-in-out;\r\n        &.active {\r\n        left: 0%;\r\n        }\r\n    }\r\n`\r\n\r\n// const MainContainer = styled(Container)`\r\n\r\n// `\r\n\r\nconst AuxContainer = styled(\"div\")`\r\n    position: relative;\r\n    min-width: 100vw;\r\n    height: 100vh;\r\n    /* min-width: 100%; */\r\n    width: auto;\r\n    display: flex;\r\n    overflow-x: hidden;\r\n    left: 0%;\r\n`\r\n\r\nconst TransitionButton = styled(IconButton)`\r\n    position: absolute;\r\n    background: white;\r\n    border-radius: 50%;\r\n    width: 50px;\r\n    height: 50px;\r\n    top: 50%;\r\n    left: 95%;\r\n    z-index: 500;\r\n    transition: all ${(props: {transitioning: boolean}) => props.transitioning ? \"0.7s\" : \"0s\"} ease-in-out;\r\n    &.active {\r\n        left: 5%;\r\n    }\r\n`\r\n\r\ninterface ComparisonData {\r\n    currentState: NetworkState;\r\n    savedState: NetworkState;\r\n}\r\n\r\nfunction App() {\r\n    const {background} = useContext(ThemeContext);\r\n\r\n    const mainContainer = createRef<HTMLDivElement>();\r\n\r\n    const [pageState, setPageState] = useState<string>(\"main\");\r\n    const [marginAdded, setMarginAdded] = useState<boolean>(false);\r\n    const [marginWidth, setMarginWidth] = useState<number>(0);\r\n    const [transitioning, setTransitioning] = useState<boolean>(false);\r\n\r\n    const [comparisonData, setComparisonData] = useState<ComparisonData>();\r\n\r\n    const updateComparisionData = (currentState: NetworkState, savedState: NetworkState) => {\r\n        setComparisonData({currentState: currentState, savedState: savedState});\r\n    }\r\n\r\n    useEffect(() => {\r\n        if(transitioning) {\r\n            updateButtonPosition();\r\n        }\r\n    }, [transitioning])\r\n\r\n    useEffect(() => {\r\n        setTimeout(function() {\r\n            console.log(pageState);\r\n            setTransitioning(false);\r\n            updateContainerSize();\r\n            // updateButtonPosition();\r\n        }, 700);\r\n    }, [pageState]);\r\n\r\n    useEffect(() => {\r\n        updateButtonPosition();\r\n    }, [marginAdded]);\r\n\r\n    const handleTransitionButton = () => {\r\n        setPageState(pageState === \"main\" ? \"compare\" : \"main\");\r\n        setTransitioning(true);\r\n        let containers = document.querySelectorAll(\".animated\");\r\n        containers.forEach((container: Element) => container.classList.toggle(\"active\"));\r\n    }\r\n\r\n    const updateContainerSize = () => {\r\n        console.log(\"Updating container size\");\r\n\r\n        const maxMarginSize = 140;\r\n        if (pageState === \"main\") {\r\n\r\n            let container = document.getElementById(\"main-container\");\r\n            let mainPage = document.getElementById(\"main-page\");\r\n            let margin = document.getElementById(\"dynamic-margin-main\");\r\n\r\n            if (!container || !mainPage || !margin) return;\r\n\r\n            console.log(\"Conatainer width: \" + container.offsetWidth);\r\n            console.log(\"Page width: \" + mainPage.offsetWidth);\r\n\r\n            console.log(\"Margin width: \" + marginWidth);\r\n\r\n            if ((container.offsetWidth - marginWidth) < (mainPage.offsetWidth + maxMarginSize)) {\r\n                let newMarginWidth = Math.min((mainPage.offsetWidth + maxMarginSize) - container.offsetWidth, maxMarginSize);\r\n                margin.style.minWidth = `${newMarginWidth}px`;\r\n                setMarginAdded(true);\r\n                setMarginWidth(newMarginWidth);\r\n                console.log(\"Margin added\");\r\n            } else {\r\n                margin.style.minWidth = \"0px\";\r\n                setMarginAdded(false);\r\n                setMarginWidth(0);\r\n                console.log(\"Margin removed\");\r\n            }\r\n        }\r\n\r\n        if (pageState === \"compare\") {\r\n\r\n            let container = document.getElementById(\"compare-container\");\r\n            let comparePage = document.getElementById(\"compare-page\");\r\n            let margin = document.getElementById(\"dynamic-margin-compare\");\r\n\r\n            if (!container || !comparePage || !margin) return;\r\n\r\n            console.log(\"Conatainer width: \" + container.offsetWidth);\r\n            console.log(\"Page width: \" + comparePage.offsetWidth);\r\n\r\n            console.log(\"Margin width: \" + marginWidth);\r\n\r\n            if ((container.offsetWidth - marginWidth) < (comparePage.offsetWidth + maxMarginSize)) {\r\n                let newMarginWidth = Math.min((comparePage.offsetWidth + maxMarginSize) - container.offsetWidth, maxMarginSize);\r\n                margin.style.minWidth = `${newMarginWidth}px`;\r\n                setMarginAdded(true);\r\n                setMarginWidth(newMarginWidth);\r\n                console.log(\"Margin added\");\r\n            } else {\r\n                margin.style.minWidth = \"0px\";\r\n                setMarginAdded(false);\r\n                setMarginWidth(0);\r\n                console.log(\"Margin removed\");\r\n            }\r\n\r\n        }\r\n    }\r\n\r\n    // Maybe convert to refs for better design. (Note: can't ref mainPage)\r\n    const updateButtonPosition = () => {\r\n        console.log(\"Updating button position\");\r\n\r\n        let button = document.getElementById(\"transition-button\");\r\n\r\n        if(!button) return;\r\n\r\n\r\n        console.log(\"Margin added: \" + marginAdded);\r\n        console.log(\"Transitioning: \" + transitioning);\r\n        console.log(\"Pagestate: \" + pageState);\r\n\r\n        if(transitioning) {\r\n            button.style.left = pageState === \"compare\" ? \"5%\" : \"95%\";\r\n            return;\r\n        }\r\n        if (marginAdded) {\r\n            // setTransitioning(false);\r\n            if (pageState === \"main\") {\r\n\r\n                let container = document.getElementById(\"main-container\");\r\n                let mainPage = document.getElementById(\"main-page\");\r\n\r\n                if (!container || !mainPage) return;\r\n\r\n                let containerRect = container.getBoundingClientRect();\r\n                let pageRect = mainPage.getBoundingClientRect();\r\n\r\n                if ((pageRect.right + 70) >= containerRect.width) {\r\n                    // button.style.left = \"100%\";\r\n                    button.style.left = `${pageRect.right + 20}px`;\r\n                } else {\r\n                    button.style.left = `min(95%, calc(${pageRect.x + pageRect.width}px + 2%))`;\r\n                    console.log(\"here\");\r\n\r\n                }\r\n                console.log(pageRect);\r\n                console.log(containerRect);\r\n            }\r\n\r\n            if (pageState === \"compare\") {\r\n\r\n                let container = document.getElementById(\"compare-container\");\r\n                let comparePage = document.getElementById(\"compare-page\");\r\n\r\n                if (!container || !comparePage) return;\r\n\r\n                let containerRect = container.getBoundingClientRect();\r\n                let pageRect = comparePage.getBoundingClientRect();\r\n\r\n                if ((pageRect.left - 60) <= containerRect.width) {\r\n                    // button.style.left = \"100%\";\r\n                    button.style.right = \"100%\";\r\n                } else {\r\n                    button.style.left = `min(95%, calc(${pageRect.x + pageRect.width}px + 2%))`;\r\n                    console.log(\"here\");\r\n\r\n                }\r\n                console.log(pageRect);\r\n                console.log(containerRect);\r\n            }\r\n        } else {\r\n            console.log(\"heer\");\r\n            button.style.left = pageState === \"main\" ? \"95%\" : \"5%\";\r\n        }\r\n    }\r\n\r\n    useEventListener(\"resize\", () => {\r\n        updateContainerSize();\r\n        updateButtonPosition();\r\n    });\r\n    \r\n    useEventListener(\"scroll\",  updateButtonPosition, mainContainer);\r\n\r\n    return (\r\n        // <ThemeContext.Consumer>\r\n        <AuxContainer>\r\n        <Global\r\n          styles={css`\r\n            body {\r\n              background: ${background}\r\n            }`}/>\r\n            <Container id=\"main-container\" className=\"animated main\" ref={mainContainer}>\r\n                {/* <StyledMargin/> */}\r\n                <StyledMainPage\r\n                    xDomain={[-8, 8]}\r\n                    yDomain={[-8, 8]}\r\n                    numCells={100}\r\n                    updateComparisionData={updateComparisionData}\r\n                />\r\n                <StyledMargin id=\"dynamic-margin-main\" />\r\n            </Container>\r\n            <TransitionButton transitioning={transitioning} id=\"transition-button\" className=\"animated\" onClick={handleTransitionButton}>\r\n                {pageState === \"main\" && <ArrowForwardIos />}\r\n                {pageState === \"compare\" && <ArrowBackIos />}\r\n            </TransitionButton>\r\n            <Container id=\"compare-container\" className=\"animated compare\">\r\n                <StyledMargin id=\"dynamic-margin-compare\" />\r\n                <StyledComparePage currentState={comparisonData?.currentState} savedState={comparisonData?.savedState}/>\r\n            </Container>\r\n        </AuxContainer>\r\n        // </ThemeContext.Consumer>\r\n    );\r\n}\r\n\r\nexport default App;\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport './index.css';\r\nimport App from './App';\r\nimport { StylesProvider } from '@material-ui/core';\r\nimport { ThemeProvider } from './contexts/ThemeContext';\r\n//import reportWebVitals from './reportWebVitals';\r\n\r\n\r\n\r\nReactDOM.render(\r\n    <React.StrictMode>\r\n        <StylesProvider injectFirst>\r\n            <ThemeProvider>\r\n                <App />\r\n            </ThemeProvider>\r\n        </StylesProvider>\r\n    </React.StrictMode>,\r\n    document.getElementById('root')\r\n);\r\n\r\n// If you want to start measuring performance in your app, pass a function\r\n// to log results (for example: reportWebVitals(console.log))\r\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\r\n//reportWebVitals();\r\n"],"sourceRoot":""}